<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <title>Secure Payment Confirmation</title>
  <meta content="w3c/ED" name="w3c-status">
  <meta content="Bikeshed version 82ce88815, updated Thu Sep 7 16:33:55 2023 -0700" name="generator">
  <link href="https://www.w3.org/TR/secure-payment-confirmation/" rel="canonical">
  <meta content="45d443217368403f4b6f6889d4cd072b48885ecc" name="document-revision">
<style>/* Boilerplate: style-autolinks */
.css.css, .property.property, .descriptor.descriptor {
    color: var(--a-normal-text);
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}

@media (prefers-color-scheme: dark) {
    :root {
        --selflink-text: black;
        --selflink-bg: silver;
        --selflink-hover-text: white;
    }
}
</style>
<style>/* Boilerplate: style-colors */

/* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
:root {
    color-scheme: light dark;

    --text: black;
    --bg: white;

    --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

    --logo-bg: #1a5e9a;
    --logo-active-bg: #c00;
    --logo-text: white;

    --tocnav-normal-text: #707070;
    --tocnav-normal-bg: var(--bg);
    --tocnav-hover-text: var(--tocnav-normal-text);
    --tocnav-hover-bg: #f8f8f8;
    --tocnav-active-text: #c00;
    --tocnav-active-bg: var(--tocnav-normal-bg);

    --tocsidebar-text: var(--text);
    --tocsidebar-bg: #f7f8f9;
    --tocsidebar-shadow: rgba(0,0,0,.1);
    --tocsidebar-heading-text: hsla(203,20%,40%,.7);

    --toclink-text: var(--text);
    --toclink-underline: #3980b5;
    --toclink-visited-text: var(--toclink-text);
    --toclink-visited-underline: #054572;

    --heading-text: #005a9c;

    --hr-text: var(--text);

    --algo-border: #def;

    --del-text: red;
    --del-bg: transparent;
    --ins-text: #080;
    --ins-bg: transparent;

    --a-normal-text: #034575;
    --a-normal-underline: #bbb;
    --a-visited-text: var(--a-normal-text);
    --a-visited-underline: #707070;
    --a-hover-bg: rgba(75%, 75%, 75%, .25);
    --a-active-text: #c00;
    --a-active-underline: #c00;

    --blockquote-border: silver;
    --blockquote-bg: transparent;
    --blockquote-text: currentcolor;

    --issue-border: #e05252;
    --issue-bg: #fbe9e9;
    --issue-text: var(--text);
    --issueheading-text: #831616;

    --example-border: #e0cb52;
    --example-bg: #fcfaee;
    --example-text: var(--text);
    --exampleheading-text: #574b0f;

    --note-border: #52e052;
    --note-bg: #e9fbe9;
    --note-text: var(--text);
    --noteheading-text: hsl(120, 70%, 30%);
    --notesummary-underline: silver;

    --assertion-border: #aaa;
    --assertion-bg: #eee;
    --assertion-text: black;

    --advisement-border: orange;
    --advisement-bg: #fec;
    --advisement-text: var(--text);
    --advisementheading-text: #b35f00;

    --warning-border: red;
    --warning-bg: hsla(40,100%,50%,0.95);
    --warning-text: var(--text);

    --amendment-border: #330099;
    --amendment-bg: #F5F0FF;
    --amendment-text: var(--text);
    --amendmentheading-text: #220066;

    --def-border: #8ccbf2;
    --def-bg: #def;
    --def-text: var(--text);
    --defrow-border: #bbd7e9;

    --datacell-border: silver;

    --indexinfo-text: #707070;

    --indextable-hover-text: black;
    --indextable-hover-bg: #f7f8f9;

    --outdatedspec-bg: rgba(0, 0, 0, .5);
    --outdatedspec-text: black;
    --outdated-bg: maroon;
    --outdated-text: white;
    --outdated-shadow: red;

    --editedrec-bg: darkorange;
}

@media (prefers-color-scheme: dark) {
    :root {
        --text: #ddd;
        --bg: black;

        --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

        --logo-bg: #1a5e9a;
        --logo-active-bg: #c00;
        --logo-text: white;

        --tocnav-normal-text: #999;
        --tocnav-normal-bg: var(--bg);
        --tocnav-hover-text: var(--tocnav-normal-text);
        --tocnav-hover-bg: #080808;
        --tocnav-active-text: #f44;
        --tocnav-active-bg: var(--tocnav-normal-bg);

        --tocsidebar-text: var(--text);
        --tocsidebar-bg: #080808;
        --tocsidebar-shadow: rgba(255,255,255,.1);
        --tocsidebar-heading-text: hsla(203,20%,40%,.7);

        --toclink-text: var(--text);
        --toclink-underline: #6af;
        --toclink-visited-text: var(--toclink-text);
        --toclink-visited-underline: #054572;

        --heading-text: #8af;

        --hr-text: var(--text);

        --algo-border: #456;

        --del-text: #f44;
        --del-bg: transparent;
        --ins-text: #4a4;
        --ins-bg: transparent;

        --a-normal-text: #6af;
        --a-normal-underline: #555;
        --a-visited-text: var(--a-normal-text);
        --a-visited-underline: var(--a-normal-underline);
        --a-hover-bg: rgba(25%, 25%, 25%, .2);
        --a-active-text: #f44;
        --a-active-underline: var(--a-active-text);

        --borderedblock-bg: rgba(255, 255, 255, .05);

        --blockquote-border: silver;
        --blockquote-bg: var(--borderedblock-bg);
        --blockquote-text: currentcolor;

        --issue-border: #e05252;
        --issue-bg: var(--borderedblock-bg);
        --issue-text: var(--text);
        --issueheading-text: hsl(0deg, 70%, 70%);

        --example-border: hsl(50deg, 90%, 60%);
        --example-bg: var(--borderedblock-bg);
        --example-text: var(--text);
        --exampleheading-text: hsl(50deg, 70%, 70%);

        --note-border: hsl(120deg, 100%, 35%);
        --note-bg: var(--borderedblock-bg);
        --note-text: var(--text);
        --noteheading-text: hsl(120, 70%, 70%);
        --notesummary-underline: silver;

        --assertion-border: #444;
        --assertion-bg: var(--borderedblock-bg);
        --assertion-text: var(--text);

        --advisement-border: orange;
        --advisement-bg: #222218;
        --advisement-text: var(--text);
        --advisementheading-text: #f84;

        --warning-border: red;
        --warning-bg: hsla(40,100%,20%,0.95);
        --warning-text: var(--text);

        --amendment-border: #330099;
        --amendment-bg: #080010;
        --amendment-text: var(--text);
        --amendmentheading-text: #cc00ff;

        --def-border: #8ccbf2;
        --def-bg: #080818;
        --def-text: var(--text);
        --defrow-border: #136;

        --datacell-border: silver;

        --indexinfo-text: #aaa;

        --indextable-hover-text: var(--text);
        --indextable-hover-bg: #181818;

        --outdatedspec-bg: rgba(255, 255, 255, .5);
        --outdatedspec-text: black;
        --outdated-bg: maroon;
        --outdated-text: white;
        --outdated-shadow: red;

        --editedrec-bg: darkorange;
    }
    /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
    img { background: white; }
}
</style>
<style>/* Boilerplate: style-counters */
body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}
</style>
<style>/* Boilerplate: style-dfn-panel */
:root {
    --dfnpanel-bg: #ddd;
    --dfnpanel-text: var(--text);
}
@media (prefers-color-scheme: dark) {
    :root {
        --dfnpanel-bg: #222;
        --dfnpanel-text: var(--text);
    }
}
.dfn-panel {
    position: absolute;
    z-index: 35;
    width: 20em;
    width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.75em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--dfnpanel-bg);
    color: var(--dfnpanel-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}
.dfn-panel:not(.on) { display: none; }
.dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
.dfn-panel > b { display: block; }
.dfn-panel a { color: var(--dfnpanel-text); }
.dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
.dfn-panel > b + b { margin-top: 0.25em; }
.dfn-panel ul { padding: 0 0 0 1em; list-style: none; }
.dfn-panel li a {
    white-space: pre;
    display: inline-block;
    max-width: calc(300px - 1.5em - 1em);
    overflow: hidden;
    text-overflow: ellipsis;
}

.dfn-panel.activated {
    display: inline-block;
    position: fixed;
    left: .5em;
    bottom: 2em;
    margin: 0 auto;
    max-width: calc(100vw - 1.5em - .4em - .5em);
    max-height: 30vh;
}

.dfn-paneled[role="button"] { cursor: pointer; }
</style>
<style>/* Boilerplate: style-dfn-panel */
:root {
    --dfnpanel-bg: #ddd;
    --dfnpanel-text: var(--text);
}
@media (prefers-color-scheme: dark) {
    :root {
        --dfnpanel-bg: #222;
        --dfnpanel-text: var(--text);
    }
}
.dfn-panel {
    position: absolute;
    z-index: 35;
    width: 20em;
    width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.75em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--dfnpanel-bg);
    color: var(--dfnpanel-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}
.dfn-panel:not(.on) { display: none; }
.dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
.dfn-panel > b { display: block; }
.dfn-panel a { color: var(--dfnpanel-text); }
.dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
.dfn-panel > b + b { margin-top: 0.25em; }
.dfn-panel ul { padding: 0 0 0 1em; list-style: none; }
.dfn-panel li a {
    white-space: pre;
    display: inline-block;
    max-width: calc(300px - 1.5em - 1em);
    overflow: hidden;
    text-overflow: ellipsis;
}

.dfn-panel.activated {
    display: inline-block;
    position: fixed;
    left: .5em;
    bottom: 2em;
    margin: 0 auto;
    max-width: calc(100vw - 1.5em - .4em - .5em);
    max-height: 30vh;
}

.dfn-paneled[role="button"] { cursor: pointer; }
</style>
<style>/* Boilerplate: style-issues */
a[href].issue-return {
    float: right;
    float: inline-end;
    color: var(--issueheading-text);
    font-weight: bold;
    text-decoration: none;
}
</style>
<style>/* Boilerplate: style-md-lists */
/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}
</style>
<style>/* Boilerplate: style-selflinks */

:root {
    --selflink-text: white;
    --selflink-bg: gray;
    --selflink-hover-text: black;
}
.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
.example > a.self-link,
.note > a.self-link,
.issue > a.self-link {
    /* These blocks are overflow:auto, so positioning outside
       doesn't work. */
    left: auto;
    right: 0;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: var(--selflink-bg);
    color: var(--selflink-text);
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: var(--selflink-hover-text);
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }
</style>
<style>/* Boilerplate: style-syntax-highlighting */

            pre.idl.highlight {
                background: var(--borderedblock-bg, var(--def-bg));
            }
            
</style>
<style>/* Boilerplate: style-syntax-highlighting */

code.highlight { padding: .1em; border-radius: .3em; }
pre.highlight, pre > code.highlight { display: block; padding: 1em; margin: .5em 0; overflow: auto; border-radius: 0; }

.highlight:not(.idl) { background: rgba(0, 0, 0, .03); }
c-[a] { color: #990055 } /* Keyword.Declaration */
c-[b] { color: #990055 } /* Keyword.Type */
c-[c] { color: #708090 } /* Comment */
c-[d] { color: #708090 } /* Comment.Multiline */
c-[e] { color: #0077aa } /* Name.Attribute */
c-[f] { color: #669900 } /* Name.Tag */
c-[g] { color: #222222 } /* Name.Variable */
c-[k] { color: #990055 } /* Keyword */
c-[l] { color: #000000 } /* Literal */
c-[m] { color: #000000 } /* Literal.Number */
c-[n] { color: #0077aa } /* Name */
c-[o] { color: #999999 } /* Operator */
c-[p] { color: #999999 } /* Punctuation */
c-[s] { color: #a67f59 } /* Literal.String */
c-[t] { color: #a67f59 } /* Literal.String.Single */
c-[u] { color: #a67f59 } /* Literal.String.Double */
c-[cp] { color: #708090 } /* Comment.Preproc */
c-[c1] { color: #708090 } /* Comment.Single */
c-[cs] { color: #708090 } /* Comment.Special */
c-[kc] { color: #990055 } /* Keyword.Constant */
c-[kn] { color: #990055 } /* Keyword.Namespace */
c-[kp] { color: #990055 } /* Keyword.Pseudo */
c-[kr] { color: #990055 } /* Keyword.Reserved */
c-[ld] { color: #000000 } /* Literal.Date */
c-[nc] { color: #0077aa } /* Name.Class */
c-[no] { color: #0077aa } /* Name.Constant */
c-[nd] { color: #0077aa } /* Name.Decorator */
c-[ni] { color: #0077aa } /* Name.Entity */
c-[ne] { color: #0077aa } /* Name.Exception */
c-[nf] { color: #0077aa } /* Name.Function */
c-[nl] { color: #0077aa } /* Name.Label */
c-[nn] { color: #0077aa } /* Name.Namespace */
c-[py] { color: #0077aa } /* Name.Property */
c-[ow] { color: #999999 } /* Operator.Word */
c-[mb] { color: #000000 } /* Literal.Number.Bin */
c-[mf] { color: #000000 } /* Literal.Number.Float */
c-[mh] { color: #000000 } /* Literal.Number.Hex */
c-[mi] { color: #000000 } /* Literal.Number.Integer */
c-[mo] { color: #000000 } /* Literal.Number.Oct */
c-[sb] { color: #a67f59 } /* Literal.String.Backtick */
c-[sc] { color: #a67f59 } /* Literal.String.Char */
c-[sd] { color: #a67f59 } /* Literal.String.Doc */
c-[se] { color: #a67f59 } /* Literal.String.Escape */
c-[sh] { color: #a67f59 } /* Literal.String.Heredoc */
c-[si] { color: #a67f59 } /* Literal.String.Interpol */
c-[sx] { color: #a67f59 } /* Literal.String.Other */
c-[sr] { color: #a67f59 } /* Literal.String.Regex */
c-[ss] { color: #a67f59 } /* Literal.String.Symbol */
c-[vc] { color: #0077aa } /* Name.Variable.Class */
c-[vg] { color: #0077aa } /* Name.Variable.Global */
c-[vi] { color: #0077aa } /* Name.Variable.Instance */
c-[il] { color: #000000 } /* Literal.Number.Integer.Long */


@media (prefers-color-scheme: dark) {
    .highlight:not(.idl) { background: rgba(255, 255, 255, .05); }

    c-[a] { color: #d33682 } /* Keyword.Declaration */
    c-[b] { color: #d33682 } /* Keyword.Type */
    c-[c] { color: #2aa198 } /* Comment */
    c-[d] { color: #2aa198 } /* Comment.Multiline */
    c-[e] { color: #268bd2 } /* Name.Attribute */
    c-[f] { color: #b58900 } /* Name.Tag */
    c-[g] { color: #cb4b16 } /* Name.Variable */
    c-[k] { color: #d33682 } /* Keyword */
    c-[l] { color: #657b83 } /* Literal */
    c-[m] { color: #657b83 } /* Literal.Number */
    c-[n] { color: #268bd2 } /* Name */
    c-[o] { color: #657b83 } /* Operator */
    c-[p] { color: #657b83 } /* Punctuation */
    c-[s] { color: #6c71c4 } /* Literal.String */
    c-[t] { color: #6c71c4 } /* Literal.String.Single */
    c-[u] { color: #6c71c4 } /* Literal.String.Double */
    c-[ch] { color: #2aa198 } /* Comment.Hashbang */
    c-[cp] { color: #2aa198 } /* Comment.Preproc */
    c-[cpf] { color: #2aa198 } /* Comment.PreprocFile */
    c-[c1] { color: #2aa198 } /* Comment.Single */
    c-[cs] { color: #2aa198 } /* Comment.Special */
    c-[kc] { color: #d33682 } /* Keyword.Constant */
    c-[kn] { color: #d33682 } /* Keyword.Namespace */
    c-[kp] { color: #d33682 } /* Keyword.Pseudo */
    c-[kr] { color: #d33682 } /* Keyword.Reserved */
    c-[ld] { color: #657b83 } /* Literal.Date */
    c-[nc] { color: #268bd2 } /* Name.Class */
    c-[no] { color: #268bd2 } /* Name.Constant */
    c-[nd] { color: #268bd2 } /* Name.Decorator */
    c-[ni] { color: #268bd2 } /* Name.Entity */
    c-[ne] { color: #268bd2 } /* Name.Exception */
    c-[nf] { color: #268bd2 } /* Name.Function */
    c-[nl] { color: #268bd2 } /* Name.Label */
    c-[nn] { color: #268bd2 } /* Name.Namespace */
    c-[py] { color: #268bd2 } /* Name.Property */
    c-[ow] { color: #657b83 } /* Operator.Word */
    c-[mb] { color: #657b83 } /* Literal.Number.Bin */
    c-[mf] { color: #657b83 } /* Literal.Number.Float */
    c-[mh] { color: #657b83 } /* Literal.Number.Hex */
    c-[mi] { color: #657b83 } /* Literal.Number.Integer */
    c-[mo] { color: #657b83 } /* Literal.Number.Oct */
    c-[sa] { color: #6c71c4 } /* Literal.String.Affix */
    c-[sb] { color: #6c71c4 } /* Literal.String.Backtick */
    c-[sc] { color: #6c71c4 } /* Literal.String.Char */
    c-[dl] { color: #6c71c4 } /* Literal.String.Delimiter */
    c-[sd] { color: #6c71c4 } /* Literal.String.Doc */
    c-[se] { color: #6c71c4 } /* Literal.String.Escape */
    c-[sh] { color: #6c71c4 } /* Literal.String.Heredoc */
    c-[si] { color: #6c71c4 } /* Literal.String.Interpol */
    c-[sx] { color: #6c71c4 } /* Literal.String.Other */
    c-[sr] { color: #6c71c4 } /* Literal.String.Regex */
    c-[ss] { color: #6c71c4 } /* Literal.String.Symbol */
    c-[fm] { color: #268bd2 } /* Name.Function.Magic */
    c-[vc] { color: #cb4b16 } /* Name.Variable.Class */
    c-[vg] { color: #cb4b16 } /* Name.Variable.Global */
    c-[vi] { color: #cb4b16 } /* Name.Variable.Instance */
    c-[vm] { color: #cb4b16 } /* Name.Variable.Magic */
    c-[il] { color: #657b83 } /* Literal.Number.Integer.Long */
}
</style>
<style>/* Boilerplate: style-wpt */
:root {
    --wpt-border: hsl(0, 0%, 60%);
    --wpt-bg: hsl(0, 0%, 95%);
    --wpt-text: var(--text);
    --wptheading-text: hsl(0, 0%, 30%);
}
@media (prefers-color-scheme: dark) {
    :root {
        --wpt-border: hsl(0, 0%, 30%);
        --wpt-bg: var(--borderedblock-bg);
        --wpt-text: var(--text);
        --wptheading-text: hsl(0, 0%, 60%);
    }
}
.wpt-tests-block {
    list-style: none;
    border-left: .5em solid var(--wpt-border);
    background: var(--wpt-bg);
    color: var(--wpt-text);
    margin: 1em auto;
    padding: .5em;
}
.wpt-tests-block summary {
    color: var(--wptheading-text);
    font-weight: normal;
    text-transform: uppercase;
}
.wpt-tests-block summary::marker{
    color: var(--wpt-border);
}
.wpt-tests-block summary:hover::marker{
    color: var(--wpt-text);
}
/*
   The only content  of a wpt test block in its closed state is the <summary>,
   which contains the word TESTS,
   and that is absolutely positioned.
   In that closed state, wpt test blocks are styled
   to have a top margin whose height is exactly equal
   to the height of the absolutely positioned <summary>,
   and no other background/padding/margin/border.
   The wpt test block elements will therefore allow the maring
   of the previous/next block elements
   to collapse through them;
   if this combined margin would be larger than its own top margin,
   it stays as is,
   and therefore the pre-existing vertical rhythm of the document is undisturbed.
   If that combined margin would be smaller, it is grown to that size.
   This means that the wpt test block ensures
   that there's always enough vertical space to insert the summary,
   without adding more than is needed.
*/
.wpt-tests-block:not([open]){
    padding: 0;
    border: none;
    background: none;
    font-size: 0.75em;
    line-height: 1;
    position: relative;
    margin: 1em 0 0;
}
.wpt-tests-block:not([open]) summary {
    position: absolute;
    right: 0;
    bottom: 0;
}
/*
   It is possible that both the last child of a block element
   and the block element itself
   would be annotated with a <wpt> block each.
   If the block element has a padding or a border,
   that's fine, but otherwise
   the bottom margin of the block and of its last child would collapse
   and both <wpt> elements would overlap, being both placed there.
   To avoid that, add 1px of padding to the <wpt> element annotating the last child
   to prevent the bottom margin of the block and of its last child from collapsing
   (and as much negative margin,
   as wel only want to prevent margin collapsing,
   but are not trying to actually take more space).
*/
.wpt-tests-block:not([open]):last-child {
    padding-bottom: 1px;
    margin-bottom: -1px;
}
/*
   Exception to the previous rule:
   don't do that in non-last list items,
   because it's not necessary,
   and would therefore consume more space than strictly needed.
   Lists must have list items as children, not <wpt> elements,
   so a <wpt> element cannot be a sibling of a list item,
   and the collision that the previous rule avoids cannot happen.
*/
li:not(:last-child) > .wpt-tests-block:not([open]):last-child,
dd:not(:last-child) > .wpt-tests-block:not([open]):last-child {
    padding-bottom: 0;
    margin-bottom: 0;
}
.wpt-tests-block:not([open]):not(:hover){
    opacity: 0.5;
}
.wpt-tests-list {
    list-style: none;
    display: grid;
    margin: 0;
    padding: 0;
    grid-template-columns: 1fr max-content auto auto;
    grid-column-gap: .5em;
}
.wpt-tests-block hr:last-child {
    display: none;
}
.wpt-test {
    display: contents;
}
.wpt-test > a {
    text-decoration: underline;
    border: none;
}
.wpt-test > .wpt-name { grid-column: 1; }
.wpt-test > .wpt-results { grid-column: 2; }
.wpt-test > .wpt-live { grid-column: 3; }
.wpt-test > .wpt-source { grid-column: 4; }

.wpt-test > .wpt-results {
    display: flex;
    gap: .1em;
}
.wpt-test .wpt-result {
    display: inline-block;
    height: 1em;
    width: 1em;
    border-radius: 50%;
    position: relative;
}
</style>
  <link href="https://www.w3.org/StyleSheets/TR/2021/W3C-ED" rel="stylesheet">
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/"> <img alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72"> </a> </p>
   <h1 class="p-name no-ref" id="title">Secure Payment Confirmation</h1>
   <p id="w3c-state"><a href="https://www.w3.org/standards/types#ED">Editor’s Draft</a>, <time class="dt-updated" datetime="2023-12-13">13 December 2023</time></p>
   <details open>
    <summary>More details about this document</summary>
    <div data-fill-with="spec-metadata">
     <dl>
      <dt>This version:
      <dd><a class="u-url" href="https://w3c.github.io/secure-payment-confirmation/">https://w3c.github.io/secure-payment-confirmation/</a>
      <dt>Latest published version:
      <dd><a href="https://www.w3.org/TR/secure-payment-confirmation/">https://www.w3.org/TR/secure-payment-confirmation/</a>
      <dt>Implementation Report:
      <dd><a href="https://wpt.fyi/results/secure-payment-confirmation">https://wpt.fyi/results/secure-payment-confirmation</a>
      <dt>Feedback:
      <dd><a href="https://github.com/w3c/secure-payment-confirmation/issues/">GitHub</a>
      <dt class="editor">Editors:
      <dd class="editor p-author h-card vcard" data-editor-id="83784"><a class="p-name fn u-email email" href="mailto:rouslan@chromium.org">Rouslan Solomakhin</a> (<a class="p-org org" href="https://www.google.com/">Google</a>)
      <dd class="editor p-author h-card vcard" data-editor-id="96463"><a class="p-name fn u-email email" href="mailto:smcgruer@chromium.org">Stephen McGruer</a> (<a class="p-org org" href="https://www.google.com/">Google</a>)
      <dt>Contributors:
      <dd><a href="mailto:ij@w3.org">Ian Jacobs</a> (<a href="https://w3.org">W3C</a>)
      <dd><a href="mailto:nburris@chromium.org">Nick Burris</a> (<a href="https://www.google.com">Google</a>)
      <dt>Test Suite:
      <dd class="wpt-overview"><a href="https://wpt.fyi/results/secure-payment-confirmation/">https://wpt.fyi/results/secure-payment-confirmation/</a>
     </dl>
    </div>
   </details>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="https://www.w3.org/policies/#copyright">Copyright</a> © 2023 <a href="https://www.w3.org/">World Wide Web Consortium</a>. <abbr title="World Wide Web Consortium">W3C</abbr><sup>®</sup> <a href="https://www.w3.org/policies/#Legal_Disclaimer">liability</a>, <a href="https://www.w3.org/policies/#W3C_Trademarks">trademark</a> and <a href="https://www.w3.org/copyright/software-license/" rel="license" title="W3C Software and Document License">permissive document license</a> rules apply. </p>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>Secure Payment Confirmation (SPC) is a Web API to support streamlined

  authentication during a payment transaction. It is designed to scale authentication
  across merchants, to be used within a wide range of authentication protocols, and
  to produce cryptographic evidence that the user has confirmed transaction details.</p>
  </div>
  <h2 class="no-num no-toc no-ref heading settled" id="sotd"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status">
   <p><em>This section describes the status of this document at the time of its publication. Other documents may supersede this document. A list of current W3C publications and the latest revision of this technical report can be found in the <a href="https://www.w3.org/TR/">W3C technical reports index</a> at https://www.w3.org/TR/.</em></p>
   <p> This document was published by the <a href="https://www.w3.org/Payments/WG/">Web Payments Working Group</a> as an Editors' Draft. This document is intended to become a W3C Recommendation.

    Feedback and comments on this specification are welcome. Please use <a href="https://github.com/w3c/secure-payment-confirmation/issues">Github issues</a>.
    Discussions may also be found in the <a href="https://lists.w3.org/Archives/Public/public-payments-wg/">public-payments-wg@w3.org archives</a>. </p>
   <p> Publication as an Editors' Draft does not imply endorsement by the <abbr title="World Wide Web Consortium">W3C</abbr> Membership. This is a draft document and may
    be updated, replaced or obsoleted by other documents at any time. It is inappropriate to cite
    this document as other than work in progress. </p>
   <p> This document was produced by a group operating under the <a href="https://www.w3.org/Consortium/Patent-Policy-20170801/"> <abbr title="World Wide Web Consortium">W3C</abbr> Patent Policy</a>. <abbr title="World Wide Web Consortium">W3C</abbr> maintains a <a href="https://www.w3.org/groups/wg/payments/ipr" rel="disclosure">public list of any
    patent disclosures</a> made in connection with the deliverables of the group; that page also
    includes instructions for disclosing a patent. An individual who has actual knowledge of a
    patent which the individual believes contains <a href="https://www.w3.org/Consortium/Patent-Policy-20170801/#def-essential">Essential
    Claim(s)</a> must disclose the information in accordance with <a href="https://www.w3.org/Consortium/Patent-Policy-20170801/#sec-Disclosure">section 6 of the <abbr title="World Wide Web Consortium">W3C</abbr> Patent Policy</a>. </p>
   <p> This document is governed by the <a href="https://www.w3.org/2023/Process-20230612/" id="w3c_process_revision">12 June 2023 W3C Process Document</a>. </p>
   <p></p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li>
     <a href="#sctn-intro"><span class="secno">1</span> <span class="content">Introduction</span></a>
     <ol class="toc">
      <li>
       <a href="#sctn-use-cases"><span class="secno">1.1</span> <span class="content">Use Cases</span></a>
       <ol class="toc">
        <li><a href="#sctn-use-case-verifying-payment"><span class="secno">1.1.1</span> <span class="content">Cryptographic evidence of transaction confirmation</span></a>
        <li><a href="#sctn-use-case-iframe-registration"><span class="secno">1.1.2</span> <span class="content">Registration in a third-party iframe</span></a>
        <li><a href="#sctn-use-case-merchant-authentication"><span class="secno">1.1.3</span> <span class="content">Merchant control of authentication</span></a>
       </ol>
      <li>
       <a href="#sctn-sample-scenarios"><span class="secno">1.2</span> <span class="content">Sample API Usage Scenarios</span></a>
       <ol class="toc">
        <li><a href="#sctn-sample-registration"><span class="secno">1.2.1</span> <span class="content">Registration during a checkout</span></a>
        <li><a href="#sctn-sample-authentication"><span class="secno">1.2.2</span> <span class="content">Authentication on merchant site</span></a>
       </ol>
     </ol>
    <li><a href="#sctn-terminology"><span class="secno">2</span> <span class="content">Terminology</span></a>
    <li><a href="#sctn-registration"><span class="secno">3</span> <span class="content">Registration</span></a>
    <li>
     <a href="#sctn-authentication"><span class="secno">4</span> <span class="content">Authentication</span></a>
     <ol class="toc">
      <li>
       <a href="#sctn-payment-method-spc"><span class="secno">4.1</span> <span class="content">Payment Method: Secure Payment Confirmation</span></a>
       <ol class="toc">
        <li><a href="#sctn-payment-method-identifier"><span class="secno">4.1.1</span> <span class="content">Payment Method Identifier</span></a>
        <li><a href="#sctn-registration-in-payment-method-id"><span class="secno">4.1.2</span> <span class="content">Registration in <span title="Payment Method Identifiers">[payment-method-id]</span></span></a>
        <li><a href="#sctn-modify-payment-request-constructor"><span class="secno">4.1.3</span> <span class="content">Modification of Payment Request constructor</span></a>
        <li><a href="#sctn-modify-user-activation-requirement"><span class="secno">4.1.4</span> <span class="content">Modification of user activation requirement</span></a>
        <li><a href="#sctn-securepaymentconfirmationrequest-dictionary"><span class="secno">4.1.5</span> <span class="content"><span><code>SecurePaymentConfirmationRequest</code></span> Dictionary</span></a>
        <li><a href="#sctn-payment-method-additional-data-type"><span class="secno">4.1.6</span> <span class="content">Payment Method additional data type</span></a>
        <li><a href="#sctn-secure-payment-confirmation-available-api"><span class="secno">4.1.7</span> <span class="content">Checking if Secure Payment Confirmation is available</span></a>
        <li><a href="#sctn-steps-to-validate-payment-method-data"><span class="secno">4.1.8</span> <span class="content">Steps to validate payment method data</span></a>
        <li><a href="#sctn-steps-to-check-if-a-payment-can-be-made"><span class="secno">4.1.9</span> <span class="content">Steps to check if a payment can be made</span></a>
        <li><a href="#sctn-transaction-confirmation-ux"><span class="secno">4.1.10</span> <span class="content">Displaying a transaction confirmation UX</span></a>
        <li><a href="#sctn-steps-to-respond-to-a-payment-request"><span class="secno">4.1.11</span> <span class="content">Steps to respond to a payment request</span></a>
       </ol>
     </ol>
    <li>
     <a href="#sctn-payment-extension-registration"><span class="secno">5</span> <span class="content">WebAuthn Extension - "<code>payment</code>"</span></a>
     <ol class="toc">
      <li><a href="#sctn-collectedclientpaymentdata-dictionary"><span class="secno">5.1</span> <span class="content"><span><code>CollectedClientPaymentData</code></span> Dictionary</span></a>
      <li><a href="#sctn-collectedclientadditionalpaymentdata-dictionary"><span class="secno">5.2</span> <span class="content"><span><code>CollectedClientAdditionalPaymentData</code></span> Dictionary</span></a>
     </ol>
    <li>
     <a href="#sctn-common-data-structures"><span class="secno">6</span> <span class="content">Common Data Structures</span></a>
     <ol class="toc">
      <li><a href="#sctn-paymentcredentialinstrument-dictionary"><span class="secno">6.1</span> <span class="content"><span><code>PaymentCredentialInstrument</code></span> Dictionary</span></a>
     </ol>
    <li><a href="#sctn-permissions-policy"><span class="secno">7</span> <span class="content">Permissions Policy integration</span></a>
    <li>
     <a href="#sctn-relying-party-operations"><span class="secno">8</span> <span class="content">SPC Relying Party Operations</span></a>
     <ol class="toc">
      <li><a href="#sctn-verifying-assertion"><span class="secno">8.1</span> <span class="content">Verifying an Authentication Assertion</span></a>
     </ol>
    <li>
     <a href="#sctn-automation"><span class="secno">9</span> <span class="content">User Agent Automation</span></a>
     <ol class="toc">
      <li><a href="#sctn-automation-set-spc-transaction-mode"><span class="secno">9.1</span> <span class="content"><span>Set SPC Transaction Mode</span></span></a>
     </ol>
    <li>
     <a href="#sctn-security-considerations"><span class="secno">10</span> <span class="content">Security Considerations</span></a>
     <ol class="toc">
      <li>
       <a href="#sctn-security-cross-origin-auth"><span class="secno">10.1</span> <span class="content">Cross-origin authentication ceremony</span></a>
       <ol class="toc">
        <li><a href="#sctn-security-login-attack"><span class="secno">10.1.1</span> <span class="content">Login Attack</span></a>
        <li><a href="#sctn-security-payment-attack"><span class="secno">10.1.2</span> <span class="content">Payment Attack</span></a>
       </ol>
      <li><a href="#sctn-security-merchant-data"><span class="secno">10.2</span> <span class="content">Merchant-supplied authentication data</span></a>
      <li><a href="#sctn-security-user-activation-requirement"><span class="secno">10.3</span> <span class="content">Lack of user activation requirement</span></a>
     </ol>
    <li>
     <a href="#sctn-privacy-considerations"><span class="secno">11</span> <span class="content">Privacy Considerations</span></a>
     <ol class="toc">
      <li><a href="#sctn-security-cross-origin-registration"><span class="secno">11.1</span> <span class="content">Registration in a Cross-Origin iframe</span></a>
      <li><a href="#sctn-privacy-probing-credential-ids"><span class="secno">11.2</span> <span class="content">Probing for credential ids</span></a>
      <li><a href="#sctn-privacy-joining-payment-instruments"><span class="secno">11.3</span> <span class="content">Joining different payment instruments</span></a>
      <li><a href="#sctn-privacy-credential-id-tracking-vector"><span class="secno">11.4</span> <span class="content">Credential ID(s) as a tracking vector</span></a>
      <li><a href="#sctn-user-opt-out"><span class="secno">11.5</span> <span class="content">User opt out</span></a>
     </ol>
    <li><a href="#sctn-accessibility-considerations"><span class="secno">12</span> <span class="content">Accessibility Considerations</span></a>
    <li><a href="#sctn-i18n-considerations"><span class="secno">13</span> <span class="content">Internationalization Considerations</span></a>
    <li><a href="#sctn-iana-considerations"><span class="secno">14</span> <span class="content">IANA Considerations</span></a>
    <li>
     <a href="#w3c-conformance"><span class="secno"></span> <span class="content">Conformance</span></a>
     <ol class="toc">
      <li><a href="#w3c-conventions"><span class="secno"></span> <span class="content">Document conventions</span></a>
      <li><a href="#w3c-conformant-algorithms"><span class="secno"></span> <span class="content">Conformant Algorithms</span></a>
     </ol>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
      <li><a href="#informative"><span class="secno"></span> <span class="content">Informative References</span></a>
     </ol>
    <li><a href="#idl-index"><span class="secno"></span> <span class="content">IDL Index</span></a>
   </ol>
  </nav>
  <main>
   <div class="non-normative">
    <h2 class="heading settled" data-level="1" id="sctn-intro"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#sctn-intro"></a></h2>
    <p><em>This section and its sub-sections are non-normative.</em></p>
    <p>This specification defines an API that enables the use of strong authentication
methods in payment flows on the web. It aims to provide the same authentication
benefits and user privacy focus as <a data-link-type="biblio" href="#biblio-webauthn-3" title="Web Authentication: An API for accessing Public Key Credentials - Level 3">[webauthn-3]</a> with enhancements to meet the
needs of payment processing.</p>
    <p>Similarly to <a data-link-type="biblio" href="#biblio-webauthn-3" title="Web Authentication: An API for accessing Public Key Credentials - Level 3">[webauthn-3]</a>, this specification defines two related processes
involving a user. The first is <a href="#sctn-registration">§ 3 Registration</a> (formerly "enrollment"),
where a relationship is created between the user and the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party">Relying Party</a>. The
second is <a href="#sctn-authentication">§ 4 Authentication</a>, where the user responds to a challenge from
the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party①">Relying Party</a> (possibly via an intermediary payment service provider)
to consent to a specific payment.</p>
    <p>It is a goal of this specification to reduce authentication friction during
checkout, and one aspect of that is to maximize the number of authentications
that the user can perform for a given registration. That is, with consent
from the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party②">Relying Party</a>, ideally the user could "register once" and
authenticate on any merchant origin (and via payment service provider),
not just the merchant origin where the user first registered.</p>
    <p>To that end, an important feature of Secure Payment Confirmation is
that the merchant (or another entity) may initiate the authentication
ceremony on the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party③">Relying Party’s</a> behalf. The <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party④">Relying Party</a> must
opt-in to allowing this behavior during credential creation.</p>
    <p>Functionally, this specification defines a new <a data-link-type="dfn" href="https://w3c.github.io/payment-request/#dfn-payment-method" id="ref-for-dfn-payment-method">payment method</a> for the <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/payment-request/#dom-paymentrequest" id="ref-for-dom-paymentrequest">PaymentRequest</a></code> API, and adds a <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#webauthn-extensions" id="ref-for-webauthn-extensions">WebAuthn Extension</a> to extend <a data-link-type="biblio" href="#biblio-webauthn-3" title="Web Authentication: An API for accessing Public Key Credentials - Level 3">[webauthn-3]</a> with payment-specific datastructures and to relax assumptions to
allow the API to be called in payment contexts.</p>
    <h3 class="heading settled" data-level="1.1" id="sctn-use-cases"><span class="secno">1.1. </span><span class="content">Use Cases</span><a class="self-link" href="#sctn-use-cases"></a></h3>
    <p>Although <a data-link-type="biblio" href="#biblio-webauthn-3" title="Web Authentication: An API for accessing Public Key Credentials - Level 3">[webauthn-3]</a> provides general authentication capabilities for the
Web, the following use cases illustrate the value of the payment-specific
extension defined in this specification.</p>
    <p>We presume that the general use case of cryptographic-based authentication for
online transactions is well established.</p>
    <h4 class="heading settled" data-level="1.1.1" id="sctn-use-case-verifying-payment"><span class="secno">1.1.1. </span><span class="content">Cryptographic evidence of transaction confirmation</span><a class="self-link" href="#sctn-use-case-verifying-payment"></a></h4>
    <p>In many online payment systems, it is common for the entity (e.g., bank) that
issues a payment instrument to seek to reduce fraud through authentication. <a data-link-type="biblio" href="#biblio-webauthn-3" title="Web Authentication: An API for accessing Public Key Credentials - Level 3">[webauthn-3]</a> and this specification make it possible to use authenticators to
cryptographically sign important payment-specific information such as the
origin of the merchant and the transaction amount and currency. The bank, as
the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party⑤">Relying Party</a>, can then verify the signed payment-specific information
as part of the decision to authorize the payment.</p>
    <p>If the bank uses plain <a data-link-type="biblio" href="#biblio-webauthn-3" title="Web Authentication: An API for accessing Public Key Credentials - Level 3">[webauthn-3]</a>, the payment-specific information to be
verified must be stored in the WebAuthn <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dom-publickeycredentialrequestoptions-challenge" id="ref-for-dom-publickeycredentialrequestoptions-challenge">challenge</a></code>. This raises several issues:</p>
    <ol>
     <li data-md>
      <p>It is a misuse of the <code>challenge</code> field (which is intended to defeat replay
attacks).</p>
     <li data-md>
      <p>There is no specification for this, so each bank is likely to have
to devise its own format for how payment-specific information should be
formatted and encoded in the challenge, complicating deployment and
increasing fragmentation.</p>
     <li data-md>
      <p>Regulations may require evidence that the user was shown and agreed to the
payment-specific information. Plain <a data-link-type="biblio" href="#biblio-webauthn-3" title="Web Authentication: An API for accessing Public Key Credentials - Level 3">[webauthn-3]</a> does not provide for
this display: there is no specified UX associated with information stored
in the <code>challenge</code> field.</p>
    </ol>
    <p>These limitations motivate the following Secure Payment Confirmation behaviors:</p>
    <ol>
     <li data-md>
      <p>The <code>challenge</code> field is only used to defeat replay attacks, as with plain <a data-link-type="biblio" href="#biblio-webauthn-3" title="Web Authentication: An API for accessing Public Key Credentials - Level 3">[webauthn-3]</a>.</p>
     <li data-md>
      <p>SPC specifies a format for payment-specific information. This will enable
development of generic verification code and test suites.</p>
     <li data-md>
      <p>SPC guarantees that the user agent has presented the payment-specific
information to the user in a way that a malicious website (or maliciously
introduced JavaScript code on a trusted website) cannot bypass.</p>
      <ul>
       <li data-md>
        <p>The payment-specific information is included in the <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dictdef-collectedclientdata" id="ref-for-dictdef-collectedclientdata">CollectedClientData</a></code> dictionary, which cannot be tampered with via
JavaScript.</p>
      </ul>
      <p class="note" role="note"><span class="marker">NOTE:</span> Banks and other stakeholders in the payments ecosystem trust payments
via browsers sufficiently today using TLS, iframes, and other Web features.
The current specification is designed to increase the security and usability
of Web payments.</p>
    </ol>
    <h4 class="heading settled" data-level="1.1.2" id="sctn-use-case-iframe-registration"><span class="secno">1.1.2. </span><span class="content">Registration in a third-party iframe</span><a class="self-link" href="#sctn-use-case-iframe-registration"></a></h4>
    <p>If a bank wishes to use <a data-link-type="biblio" href="#biblio-webauthn-3" title="Web Authentication: An API for accessing Public Key Credentials - Level 3">[webauthn-3]</a> as the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party⑥">Relying Party</a>, that
specification requires the bank to register the user in a first party context.
Registration can happen outside of a transaction while the user is visiting the
bank’s site. It is also useful to be able to register the user during a
transaction, but any registration that interrupts the payment journey creates a
risk of transaction abandonment.</p>
    <p>This limitation motivates the following Secure Payment Confirmation behavior:</p>
    <ol>
     <li data-md>
      <p>SPC supports cross-origin registration from an iframe in a third-party
context. For instance, this registration might take place following some
other identity and verification (<abbr>ID&amp;V</abbr>) flow (e.g., SMS OTP).</p>
    </ol>
    <ul>
     <li data-md>
      <p>See <a href="https://github.com/w3c/webauthn/issues/1656">discussion
on WebAuthn issue 1656</a>.</p>
    </ul>
    <h4 class="heading settled" data-level="1.1.3" id="sctn-use-case-merchant-authentication"><span class="secno">1.1.3. </span><span class="content">Merchant control of authentication</span><a class="self-link" href="#sctn-use-case-merchant-authentication"></a></h4>
    <p>Merchants seek to avoid user drop-off during checkout, in particular by
reducing authentication friction. A <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party⑦">Relying Party</a> (e.g., a bank) that
wishes to use <a data-link-type="biblio" href="#biblio-webauthn-3" title="Web Authentication: An API for accessing Public Key Credentials - Level 3">[webauthn-3]</a> to authenticate the user typically does so from an
iframe. However, merchants would prefer to manage the user experience of
authenticating the user while still enabling the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party⑧">Relying Party</a> to verify
the results of authentication.</p>
    <p>This limitation motivates the following Secure Payment Confirmation behavior:</p>
    <ul>
     <li data-md>
      <p>With SPC, other parties than the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party⑨">Relying Party</a> can use authentication
credentials <em>on behalf of</em> the Relying Party. The Relying Party can then
verify the authentication results.</p>
    </ul>
    <p>An additional benefit of this feature to Relying Parties is that they no longer
need to build their own front-end experiences for authentication. Instead,
payment service providers are likely to build them on behalf of merchants.</p>
    <p class="note" role="note"><span class="marker">NOTE:</span> Relying Parties that wish to provide the authentication user experience
may still do so using SPC from an iframe.</p>
    <h3 class="heading settled" data-level="1.2" id="sctn-sample-scenarios"><span class="secno">1.2. </span><span class="content">Sample API Usage Scenarios</span><a class="self-link" href="#sctn-sample-scenarios"></a></h3>
    <p>In this section, we walk through some scenarios for Secure Payment Confirmation
and the corresponding sample code for using this API. Note that these are
example flows and do not limit the scope of how the API can be used.</p>
    <h4 class="heading settled" data-level="1.2.1" id="sctn-sample-registration"><span class="secno">1.2.1. </span><span class="content">Registration during a checkout</span><a class="self-link" href="#sctn-sample-registration"></a></h4>
    <p>This is a first-time flow, in which a new credential is created and stored by
an issuing bank during a checkout by the user on some merchant.</p>
    <ol>
     <li data-md>
      <p>The user visits <code>merchant.com</code>, selects an item to purchase, and proceeds to
the checkout flow. They enter their payment instrument details, and indicate
that they wish to pay (e.g., by pressing a "Pay" button).</p>
     <li data-md>
      <p>The merchant communicates out-of-band (e.g., using another protocol) with the
bank that issued the payment instrument. The issuing bank requests
verification of the user, and provides a bank-controlled URL for the
merchant to open in an iframe.</p>
     <li data-md>
      <p>The merchant opens an iframe to <code>bank.com</code>, with the <code>allow</code> attribute set to
"<a data-link-type="dfn" href="https://w3c.github.io/payment-request/#dfn-payment" id="ref-for-dfn-payment">payment</a>".</p>
     <li data-md>
      <p>In the iframe, the issuing bank confirms the user’s identity via a
traditional means (e.g., SMS OTP). After confirmation, the bank invites the
user to register in SPC authentication for future payments.</p>
     <li data-md>
      <p>The user consents (e.g., by clicking an "Register" button in the bank UX),
and the bank runs code in the iframe (see example below).</p>
     <li data-md>
      <p>The user goes through a WebAuthn registration flow. A new credential is
created and returned to the issuing bank who stores it in their server-side
database associated with the user and payment instrument(s).</p>
     <li data-md>
      <p>The verification completes; the bank iframe closes and the merchant finishes
the checkout process for the user.</p>
    </ol>
    <p>Sample code for registering the user in this way follows:</p>
<pre class="example highlight" id="registration-example"><a class="self-link" href="#registration-example"></a><c- k>if</c-> <c- p>(</c-><c- o>!</c->window<c- p>.</c->PublicKeyCredential<c- p>)</c-> <c- p>{</c-> <c- d>/* Client not capable. Handle error. */</c-> <c- p>}</c->

<c- a>const</c-> publicKey <c- o>=</c-> <c- p>{</c->
  <c- c1>// The challenge should be created by the bank server and sent to the iframe.</c->
  challenge<c- o>:</c-> <c- ow>new</c-> Uint8Array<c- p>([</c-><c- mf>21</c-><c- p>,</c-><c- mf>31</c-><c- p>,</c-><c- mf>105</c-> <c- d>/* 29 more random bytes generated by the server */</c-><c- p>]),</c->

  <c- c1>// Relying Party:</c->
  rp<c- o>:</c-> <c- p>{</c->
    name<c- o>:</c-> <c- u>"Fancy Bank"</c-><c- p>,</c->
  <c- p>},</c->

  <c- c1>// User:</c->
  user<c- o>:</c-> <c- p>{</c->
    <c- c1>// Part of WebAuthn. This information is not required by SPC</c->
    <c- c1>// but may be used by the bank server to identify this user in</c->
    <c- c1>// future transactions. Inconsistent values for the same user</c->
    <c- c1>// can result in the creation of multiple credentials for the user</c->
    <c- c1>// and thus potential UX friction due to credential selection.</c->
    id<c- o>:</c-> Uint8Array<c- p>.</c-><c- kr>from</c-><c- p>(</c->window<c- p>.</c->atob<c- p>(</c-><c- u>"MIIBkzCCATigAwIBAjCCAZMwggE4oAMCAQIwggGTMII="</c-><c- p>),</c-> c<c- p>=></c->c<c- p>.</c->charCodeAt<c- p>(</c-><c- mf>0</c-><c- p>)),</c->
    name<c- o>:</c-> <c- u>"jane.doe@example.com"</c-><c- p>,</c->
    displayName<c- o>:</c-> <c- u>"Jane Doe"</c-><c- p>,</c->
  <c- p>},</c->

  <c- c1>// In this example the Relying Party accepts either an ES256 or RS256</c->
  <c- c1>// credential, but prefers an ES256 credential.</c->
  pubKeyCredParams<c- o>:</c-> <c- p>[</c->
    <c- p>{</c->
      type<c- o>:</c-> <c- u>"public-key"</c-><c- p>,</c->
      alg<c- o>:</c-> <c- o>-</c-><c- mf>7</c-> <c- c1>// "ES256"</c->
    <c- p>},</c->
    <c- p>{</c->
      type<c- o>:</c-> <c- u>"public-key"</c-><c- p>,</c->
      alg<c- o>:</c-> <c- o>-</c-><c- mf>257</c-> <c- c1>// "RS256"</c->
    <c- p>}</c->
  <c- p>],</c->

  authenticatorSelection<c- o>:</c-> <c- p>{</c->
    userVerification<c- o>:</c-> <c- u>"required"</c-><c- p>,</c->
    residentKey<c- o>:</c-> <c- u>"required"</c-><c- p>,</c->
    authenticatorAttachment<c- o>:</c-> <c- u>"platform"</c-><c- p>,</c->
  <c- p>},</c->

  timeout<c- o>:</c-> <c- mf>360000</c-><c- p>,</c->  <c- c1>// 6 minutes</c->

  <c- c1>// Indicate that this is an SPC credential. This is currently required so</c->
  <c- c1>// that the browser knows this credential relates to SPC. It also enables</c->
  <c- c1>// credential creation in a cross-origin iframe, which is required for this</c->
  <c- c1>// example.</c->
  <c- c1>//</c->
  <c- c1>// A future version of the spec may remove the need for this extension.</c->
  extensions<c- o>:</c-> <c- p>{</c->
    <c- u>"payment"</c-><c- o>:</c-> <c- p>{</c->
      isPayment<c- o>:</c-> <c- kc>true</c-><c- p>,</c->
    <c- p>}</c->
  <c- p>}</c->
<c- p>};</c->

<c- c1>// Note: The following call will cause the authenticator to display UI.</c->
navigator<c- p>.</c->credentials<c- p>.</c->create<c- p>({</c-> publicKey <c- p>})</c->
  <c- p>.</c->then<c- p>(</c-><c- a>function</c-> <c- p>(</c->newCredentialInfo<c- p>)</c-> <c- p>{</c->
    <c- c1>// Send new credential info to server for verification and registration.</c->
  <c- p>}).</c-><c- k>catch</c-><c- p>(</c-><c- a>function</c-> <c- p>(</c->err<c- p>)</c-> <c- p>{</c->
    <c- c1>// No acceptable authenticator or user refused consent. Handle appropriately.</c->
  <c- p>});</c->
</pre>
   </div>
   <h4 class="heading settled" data-level="1.2.2" id="sctn-sample-authentication"><span class="secno">1.2.2. </span><span class="content">Authentication on merchant site</span><a class="self-link" href="#sctn-sample-authentication"></a></h4>
   <p>This is the flow when a user with an already registered credential is
performing a transaction and the issuing bank and merchant wish to use Secure
Payment Confirmation.</p>
   <ol>
    <li data-md>
     <p>The user visits <code>merchant.com</code>, selects an item to purchase, and proceeds
to the checkout flow. They enter their payment instrument details, and
indicate that they wish to pay (e.g., by pressing a "Pay" button).</p>
    <li data-md>
     <p>The merchant communicates out-of-band with the issuing bank of the payment
instrument (e.g., using another protocol). The issuing bank requests
verification of the user, and at the same time informs the merchant that it
accepts SPC by providing the information necessary to use the API. This
information includes a challenge and any credential IDs associated with this
user and payment instrument(s).</p>
    <li data-md>
     <p>The merchant runs the example code shown below.</p>
    <li data-md>
     <p>The user agrees to the payment-specific information displayed in the SPC UX,
and performs a subsequent WebAuthn authentication ceremony. The signed
cryptogram is returned to the merchant.</p>
    <li data-md>
     <p>The merchant communicates the signed cryptogram to the issuing bank
out-of-band. The issuing bank verifies the cryptogram, and knows that the
user is valid, what payment-specific information has been displayed, and
that the user has consented to the transaction. The issuing bank authorizes
the transaction and the merchant finishes the checkout process for the user.</p>
   </ol>
   <p>The sample code for authenticating the user follows. Note that the example code
presumes access to await/async, for easier to read promise handling.</p>
<pre class="example highlight" id="authentication-example"><a class="self-link" href="#authentication-example"></a><c- d>/* isSecurePaymentConfirmationAvailable indicates whether the browser */</c->
<c- d>/* supports SPC. It does not indicate whether the user has a credential */</c->
<c- d>/* ready to go on this device. */</c->
<c- a>const</c-> spcAvailable <c- o>=</c->
  PaymentRequest <c- o>&amp;&amp;</c->
  PaymentRequest<c- p>.</c->isSecurePaymentConfirmationAvailable <c- o>&amp;&amp;</c->
  <c- k>await</c-> PaymentRequest<c- p>.</c->isSecurePaymentConfirmationAvailable<c- p>();</c->
<c- k>if</c-> <c- p>(</c-><c- o>!</c->spcAvailable<c- p>)</c-> <c- p>{</c->
  <c- d>/* Browser does not support SPC; merchant should fallback to traditional flows. */</c->
<c- p>}</c->

<c- a>const</c-> request <c- o>=</c-> <c- ow>new</c-> PaymentRequest<c- p>([{</c->
  supportedMethods<c- o>:</c-> <c- u>"secure-payment-confirmation"</c-><c- p>,</c->
  data<c- o>:</c-> <c- p>{</c->
    <c- c1>// List of credential IDs obtained from the bank.</c->
    credentialIds<c- p>,</c->

    rpId<c- o>:</c-> <c- u>"fancybank.com"</c-><c- p>,</c->

    <c- c1>// The challenge is also obtained from the bank.</c->
    challenge<c- o>:</c-> <c- ow>new</c-> Uint8Array<c- p>([</c-><c- mf>21</c-><c- p>,</c-><c- mf>31</c-><c- p>,</c-><c- mf>105</c-> <c- d>/* 29 more random bytes generated by the bank */</c-><c- p>]),</c->

    instrument<c- o>:</c-> <c- p>{</c->
      displayName<c- o>:</c-> <c- u>"Fancy Card ****1234"</c-><c- p>,</c->
      icon<c- o>:</c-> <c- u>"https://fancybank.com/card-art.png"</c-><c- p>,</c->
    <c- p>},</c->

    payeeName<c- o>:</c-> <c- u>"Merchant Shop"</c-><c- p>,</c->
    payeeOrigin<c- o>:</c-> <c- u>"https://merchant.com"</c-><c- p>,</c->

    <c- c1>// Caller’s requested localized experience</c->
    locale<c- o>:</c-> <c- p>[</c-><c- u>"en"</c-><c- p>],</c-> 

    timeout<c- o>:</c-> <c- mf>360000</c-><c- p>,</c->  <c- c1>// 6 minutes</c->
  <c- p>}],</c-> <c- p>{</c->
    total<c- o>:</c-> <c- p>{</c->
      label<c- o>:</c-> <c- u>"Total"</c-><c- p>,</c->
      amount<c- o>:</c-> <c- p>{</c->
        currency<c- o>:</c-> <c- u>"USD"</c-><c- p>,</c->
        value<c- o>:</c-> <c- u>"5.00"</c-><c- p>,</c->
      <c- p>},</c->
    <c- p>},</c->
  <c- p>});</c->

<c- k>try</c-> <c- p>{</c->
  <c- a>const</c-> response <c- o>=</c-> <c- k>await</c-> request<c- p>.</c->show<c- p>();</c->
  <c- k>await</c-> response<c- p>.</c->complete<c- p>(</c-><c- t>'success'</c-><c- p>);</c->

  <c- c1>// response.data is a PublicKeyCredential, with a clientDataJSON that</c->
  <c- c1>// contains the transaction data for verification by the issuing bank.</c->

  <c- d>/* send response.data to the issuing bank for verification */</c->
<c- p>}</c-> <c- k>catch</c-> <c- p>(</c->err<c- p>)</c-> <c- p>{</c->
  <c- d>/* SPC cannot be used; merchant should fallback to traditional flows */</c->
<c- p>}</c->
</pre>
   <h2 class="heading settled" data-level="2" id="sctn-terminology"><span class="secno">2. </span><span class="content">Terminology</span><a class="self-link" href="#sctn-terminology"></a></h2>
   <dl>
    <dt data-md><dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="spc-credential">SPC Credential</dfn>
    <dd data-md>
     <p>A <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#public-key-credential" id="ref-for-public-key-credential">WebAuthn credential</a> that can be used for the
behaviors defined in this specification. When an SPC Credential is to be
used by a party other than the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party①⓪">Relying Party</a>, the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party①①">Relying Party</a> must
explicitly opt in by declaring the credential for SPC at creation time.</p>
     <p>This specification does not intend to limit how SPC credentials may (or may
not) be used by a <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party①②">Relying Party</a> for other authentication flows (e.g.,
login).</p>
     <p class="note" role="note"><span class="marker">Note:</span> The current version of this specification requires the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party①③">Relying
      Party</a> to explicitly opt in for a credential to be used in
      either a first-party or third-party context. Longer-term, our
      intention is that all <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#public-key-credential" id="ref-for-public-key-credential①">WebAuthn credentials</a> will be usable for SPC in a first-party context (e.g., on the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party①④">Relying Party’s</a> domain) and opt-in will only be required to allow
      a credential to be used by a third-party.</p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="steps-to-silently-determine-if-a-credential-is-spc-enabled">Steps to silently determine if a credential is SPC-enabled</dfn>
    <dd data-md>
     <p>An as-yet undefined process by which a user agent can, given a <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party-identifier" id="ref-for-relying-party-identifier">Relying Party Identifier</a> and a <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#credential-id" id="ref-for-credential-id">credential ID</a>, silently (i.e.,
without user interaction) determine if the credential represented by that ID
is an <a data-link-type="dfn" href="#spc-credential" id="ref-for-spc-credential">SPC Credential</a>.</p>
     <p class="note" role="note"><span class="marker">NOTE:</span> See <a href="https://github.com/w3c/webauthn/issues/1667">WebAuthn
issue 1667</a>.</p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="steps-to-silently-determine-if-a-credential-is-available-for-the-current-device">Steps to silently determine if a credential is available for the current device</dfn>
    <dd data-md>
     <p>An as-yet undefined process by which a user agent can, given a <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party-identifier" id="ref-for-relying-party-identifier①">Relying Party Identifier</a> and a <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#credential-id" id="ref-for-credential-id①">credential ID</a>, silently (i.e.,
without user interaction) determine if the credential represented by that
credential ID is available for the current device (i.e., could be
successfully used as part of a WebAuthn <a href="https://w3c.github.io/webauthn/#sctn-getAssertion">Get</a> call).</p>
     <p>This allows the user agent to only conditionally display <a href="#sctn-transaction-confirmation-ux">the transaction UX</a> to the user if
there is some chance that they can successfully complete the transaction.</p>
     <p class="note" role="note"><span class="marker">NOTE:</span> This property will likely require that <a data-link-type="dfn" href="#spc-credential" id="ref-for-spc-credential①">SPC Credentials</a> be <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#discoverable-credential" id="ref-for-discoverable-credential">discoverable</a>; as such this specification
currently encodes that as a requirement.</p>
     <p class="note" role="note"><span class="marker">NOTE:</span> This property is very similar to that which is required for the <a data-biblio-display="inline" data-link-type="biblio" href="https://github.com/w3c/webauthn/issues/1545"><cite>WebAuthn Conditional UI Proposal</cite></a>. It is likely that both it and SPC could
be supported by the same underlying API.</p>
   </dl>
   <h2 class="heading settled" data-level="3" id="sctn-registration"><span class="secno">3. </span><span class="content">Registration</span><a class="self-link" href="#sctn-registration"></a></h2>
   <p>To register a user for Secure Payment Confirmation, relying parties should call <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webappsec-credential-management/#dom-credentialscontainer-create" id="ref-for-dom-credentialscontainer-create">navigator.credentials.create()</a></code>, with the <code class="idl"><a data-link-type="idl" href="#dom-authenticationextensionsclientinputs-payment" id="ref-for-dom-authenticationextensionsclientinputs-payment">payment</a></code> <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#webauthn-extensions" id="ref-for-webauthn-extensions①">WebAuthn Extension</a> specified.</p>
   <details class="wpt-tests-block" dir="ltr" lang="en">
    <summary>Tests</summary>
    <ul class="wpt-tests-list">
     <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/secure-payment-confirmation/enrollment.https.html" title="secure-payment-confirmation/enrollment.https.html">enrollment.https.html</a> <a class="wpt-live" href="https://wpt.live/secure-payment-confirmation/enrollment.https.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/secure-payment-confirmation/enrollment.https.html"><small>(source)</small></a>
     <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/secure-payment-confirmation/enrollment-in-iframe.sub.https.html" title="secure-payment-confirmation/enrollment-in-iframe.sub.https.html">enrollment-in-iframe.sub.https.html</a> <a class="wpt-live" href="https://wpt.live/secure-payment-confirmation/enrollment-in-iframe.sub.https.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/secure-payment-confirmation/enrollment-in-iframe.sub.https.html"><small>(source)</small></a>
    </ul>
   </details>
   <p class="note" role="note"><span class="marker">Note:</span> In this specification we define an extension in order to allow
      (1) credential creation in a cross-origin iframe (which WebAuthn
      Levels 1 and 2 do not allow, but Level 3 <a href="https://github.com/w3c/webauthn/pull/1801">is expected to
      allow</a>) and (2) the browser to cache SPC credential IDs in the
      absence of <a data-link-type="biblio" href="#biblio-webauthn-conditional-ui" title="WebAuthn Conditional UI Proposal">Conditional UI</a>. If these
      capabilities are available in future versions of WebAuthn, we
      may remove the requirement for the extension from SPC. Note that
      SPC credentials (with the extension) are otherwise full-fledged
      WebAuthn credentials.</p>
   <p class="note" role="note"><span class="marker">Note:</span> At registration time, Web Authentication requires both <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dom-publickeycredentialentity-name" id="ref-for-dom-publickeycredentialentity-name">name</a></code> and <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dom-publickeycredentialuserentity-displayname" id="ref-for-dom-publickeycredentialuserentity-displayname">displayName</a></code>, although per the
      definition of the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#dom-publickeycredentialcreationoptions-user" id="ref-for-dom-publickeycredentialcreationoptions-user">user member</a>, implementations are not
      required to display either of them in subsequent authentication
      ceremonies. Of the two, as of October 2023 <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dom-publickeycredentialentity-name" id="ref-for-dom-publickeycredentialentity-name①">name</a></code> is shown more
      consistently. Developers should continue to monitor
      implementations.</p>
   <h2 class="heading settled" data-level="4" id="sctn-authentication"><span class="secno">4. </span><span class="content">Authentication</span><a class="self-link" href="#sctn-authentication"></a></h2>
   <p>To authenticate a payment via Secure Payment Confirmation, this specification
defines a new <a data-link-type="dfn" href="https://w3c.github.io/payment-request/#dfn-payment-method" id="ref-for-dfn-payment-method①">payment method</a>, "<a data-link-type="dfn" href="#secure-payment-confirmation" id="ref-for-secure-payment-confirmation">secure-payment-confirmation</a>". This
payment method confirms the transaction with the user and then performs an <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#authentication-ceremony" id="ref-for-authentication-ceremony">authentication ceremony</a> to authenticate the user and create a signed blob
representing the authentication ceremony.</p>
   <p>At a high level, authentication for Secure Payment Confirmation is similar to <a data-link-type="biblio" href="#biblio-webauthn-3" title="Web Authentication: An API for accessing Public Key Credentials - Level 3">[webauthn-3]</a>, with one major conceptual shift. Secure Payment Confirmation
allows a third-party (e.g., the merchant) to trigger an authentication ceremony
on behalf of the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party①⑤">Relying Party</a>, passing in credentials that it has obtained
from the Relying Party on some other unspecified channel. See <a href="#sctn-use-case-merchant-authentication">§ 1.1.3 Merchant control of authentication</a>.</p>
   <h3 class="heading settled" data-level="4.1" id="sctn-payment-method-spc"><span class="secno">4.1. </span><span class="content">Payment Method: Secure Payment Confirmation</span><a class="self-link" href="#sctn-payment-method-spc"></a></h3>
   <p>This specification defines a new <a data-link-type="dfn" href="https://w3c.github.io/payment-request/#dfn-payment-handler" id="ref-for-dfn-payment-handler">payment handler</a>, the <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="Secure Payment Confirmation payment handler" data-noexport id="secure-payment-confirmation-payment-handler">Secure Payment
Confirmation payment handler</dfn>, which handles requests to authenticate a
given payment.</p>
   <p class="note" role="note"><span class="marker">NOTE:</span> To quickly support an initial SPC experiment, this API was designed atop
existing implementations of the Payment Request and Payment Handler APIs. There
is now general agreement to explore a design of SPC independent of Payment
Request. We therefore expect (without a concrete timeline) that SPC will move
away from its Payment Request origins. For developers, this should improve
feature detection, invocation, and other aspects of the API.</p>
   <h4 class="heading settled" data-level="4.1.1" id="sctn-payment-method-identifier"><span class="secno">4.1.1. </span><span class="content">Payment Method Identifier</span><a class="self-link" href="#sctn-payment-method-identifier"></a></h4>
   <p>The <a data-link-type="dfn" href="https://w3c.github.io/payment-method-id/#dfn-standardized-payment-method-identifier" id="ref-for-dfn-standardized-payment-method-identifier">standardized payment method identifier</a> for the <a data-link-type="dfn" href="#secure-payment-confirmation-payment-handler" id="ref-for-secure-payment-confirmation-payment-handler">Secure Payment
Confirmation payment handler</a> is "<dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="secure-payment-confirmation">secure-payment-confirmation</dfn>".</p>
   <h4 class="heading settled" data-level="4.1.2" id="sctn-registration-in-payment-method-id"><span class="secno">4.1.2. </span><span class="content">Registration in <a data-link-type="biblio" href="#biblio-payment-method-id" title="Payment Method Identifiers">[payment-method-id]</a></span><a class="self-link" href="#sctn-registration-in-payment-method-id"></a></h4>
   <p>Add the following to the <a data-link-type="dfn" href="https://w3c.github.io/payment-method-id/#registry" id="ref-for-registry">registry of standardized payment methods</a> in <a data-link-type="biblio" href="#biblio-payment-method-id" title="Payment Method Identifiers">[payment-method-id]</a>:</p>
   <dl>
    <dt data-md>"<a data-link-type="dfn" href="#secure-payment-confirmation" id="ref-for-secure-payment-confirmation①">secure-payment-confirmation</a>"
    <dd data-md>
     <p>The <a href="https://w3c.github.io/secure-payment-confirmation/">Secure Payment Confirmation</a> specification.</p>
   </dl>
   <h4 class="heading settled" data-level="4.1.3" id="sctn-modify-payment-request-constructor"><span class="secno">4.1.3. </span><span class="content">Modification of Payment Request constructor</span><a class="self-link" href="#sctn-modify-payment-request-constructor"></a></h4>
   <p>In the steps for the <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/payment-request/#dom-paymentrequest-constructor" id="ref-for-dom-paymentrequest-constructor">PaymentRequest object’s constructor</a></code>,
add a new step after step 4.3:</p>
   <ol start="4">
    <li data-md>
     <p>Process payment methods: <em>[substeps 1-3 elided]</em></p>
     <ol start="4">
      <li data-md>
       <p>If <var>seenPMIs</var> contains "<a data-link-type="dfn" href="#secure-payment-confirmation" id="ref-for-secure-payment-confirmation②">secure-payment-confirmation</a>" and the size
of <var>seenPMIs</var> is greater than 1, throw a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#exceptiondef-rangeerror" id="ref-for-exceptiondef-rangeerror">RangeError</a></code>.</p>
     </ol>
   </ol>
   <h4 class="heading settled" data-level="4.1.4" id="sctn-modify-user-activation-requirement"><span class="secno">4.1.4. </span><span class="content">Modification of user activation requirement</span><a class="self-link" href="#sctn-modify-user-activation-requirement"></a></h4>
   <p>In the steps for the <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/payment-request/#dom-paymentrequest-show" id="ref-for-dom-paymentrequest-show">PaymentRequest.show()</a></code> method,
modify steps 2 and 3:</p>
   <ol start="2">
    <li data-md>
     <p>If the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global" id="ref-for-concept-relevant-global">relevant global object</a> of <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request" id="ref-for-concept-request">request</a> does not have <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/interaction.html#transient-activation" id="ref-for-transient-activation">transient activation</a>, the user agent MAY:</p>
     <ol>
      <li data-md>
       <p>Return <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#a-promise-rejected-with" id="ref-for-a-promise-rejected-with">a promise rejected with</a> with a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#securityerror" id="ref-for-securityerror">"SecurityError"</a></code> <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException">DOMException</a></code>.</p>
     </ol>
    <li data-md>
     <p>Otherwise, <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/interaction.html#consume-user-activation" id="ref-for-consume-user-activation">consume user activation</a> of the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global" id="ref-for-concept-relevant-global①">relevant global object</a>.</p>
   </ol>
   <p class="note" role="note"><span class="marker">NOTE:</span> This allows the user agent to not require user activation, for
      example to support redirect authentication flows where a user activation
      may not be present upon redirect. See <a href="#sctn-security-user-activation-requirement">§ 10.3 Lack of user activation requirement</a> for security considerations.</p>
   <h4 class="heading settled" data-level="4.1.5" id="sctn-securepaymentconfirmationrequest-dictionary"><span class="secno">4.1.5. </span><span class="content"><dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-securepaymentconfirmationrequest"><code>SecurePaymentConfirmationRequest</code></dfn> Dictionary</span><a class="self-link" href="#sctn-securepaymentconfirmationrequest-dictionary"></a></h4>
<pre class="idl highlight def"><c- b>dictionary</c-> <a class="idl-code" data-link-type="dictionary" href="#dictdef-securepaymentconfirmationrequest" id="ref-for-dictdef-securepaymentconfirmationrequest"><c- g>SecurePaymentConfirmationRequest</c-></a> {
    <c- b>required</c-> <a data-link-type="idl-name" href="https://webidl.spec.whatwg.org/#BufferSource" id="ref-for-BufferSource"><c- n>BufferSource</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="BufferSource " href="#dom-securepaymentconfirmationrequest-challenge" id="ref-for-dom-securepaymentconfirmationrequest-challenge"><c- g>challenge</c-></a>;
    <c- b>required</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString" id="ref-for-idl-USVString"><c- b>USVString</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="USVString " href="#dom-securepaymentconfirmationrequest-rpid" id="ref-for-dom-securepaymentconfirmationrequest-rpid"><c- g>rpId</c-></a>;
    <c- b>required</c-> <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-sequence" id="ref-for-idl-sequence"><c- b>sequence</c-></a>&lt;<a data-link-type="idl-name" href="https://webidl.spec.whatwg.org/#BufferSource" id="ref-for-BufferSource①"><c- n>BufferSource</c-></a>> <a class="idl-code" data-link-type="dict-member" data-type="sequence<BufferSource> " href="#dom-securepaymentconfirmationrequest-credentialids" id="ref-for-dom-securepaymentconfirmationrequest-credentialids"><c- g>credentialIds</c-></a>;
    <c- b>required</c-> <a data-link-type="idl-name" href="#dictdef-paymentcredentialinstrument" id="ref-for-dictdef-paymentcredentialinstrument"><c- n>PaymentCredentialInstrument</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="PaymentCredentialInstrument " href="#dom-securepaymentconfirmationrequest-instrument" id="ref-for-dom-securepaymentconfirmationrequest-instrument"><c- g>instrument</c-></a>;
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long" id="ref-for-idl-unsigned-long"><c- b>unsigned</c-> <c- b>long</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="unsigned long " href="#dom-securepaymentconfirmationrequest-timeout" id="ref-for-dom-securepaymentconfirmationrequest-timeout"><c- g>timeout</c-></a>;
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString" id="ref-for-idl-USVString①"><c- b>USVString</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="USVString " href="#dom-securepaymentconfirmationrequest-payeename" id="ref-for-dom-securepaymentconfirmationrequest-payeename"><c- g>payeeName</c-></a>;
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString" id="ref-for-idl-USVString②"><c- b>USVString</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="USVString " href="#dom-securepaymentconfirmationrequest-payeeorigin" id="ref-for-dom-securepaymentconfirmationrequest-payeeorigin"><c- g>payeeOrigin</c-></a>;
    <a data-link-type="idl-name" href="https://w3c.github.io/webauthn/#dictdef-authenticationextensionsclientinputs" id="ref-for-dictdef-authenticationextensionsclientinputs"><c- n>AuthenticationExtensionsClientInputs</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="AuthenticationExtensionsClientInputs " href="#dom-securepaymentconfirmationrequest-extensions" id="ref-for-dom-securepaymentconfirmationrequest-extensions"><c- g>extensions</c-></a>;
    <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-sequence" id="ref-for-idl-sequence①"><c- b>sequence</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString" id="ref-for-idl-USVString③"><c- b>USVString</c-></a>> <a class="idl-code" data-link-type="dict-member" data-type="sequence<USVString> " href="#dom-securepaymentconfirmationrequest-locale" id="ref-for-dom-securepaymentconfirmationrequest-locale"><c- g>locale</c-></a>;
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean" id="ref-for-idl-boolean"><c- b>boolean</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="boolean " href="#dom-securepaymentconfirmationrequest-showoptout" id="ref-for-dom-securepaymentconfirmationrequest-showoptout"><c- g>showOptOut</c-></a>;
};
</pre>
   <p>The <code class="idl"><a data-link-type="idl" href="#dictdef-securepaymentconfirmationrequest" id="ref-for-dictdef-securepaymentconfirmationrequest①">SecurePaymentConfirmationRequest</a></code> dictionary contains the following
members:</p>
   <dl>
    <dt data-md><dfn class="dfn-paneled idl-code" data-dfn-for="SecurePaymentConfirmationRequest" data-dfn-type="dict-member" data-export id="dom-securepaymentconfirmationrequest-challenge"><code>challenge</code></dfn> member, <span> of type <a data-link-type="idl-name" href="https://webidl.spec.whatwg.org/#BufferSource" id="ref-for-BufferSource②">BufferSource</a></span>
    <dd data-md>
     <p>A random challenge that the relying party generates on the server side
to prevent replay attacks.</p>
    <dt data-md><dfn class="dfn-paneled idl-code" data-dfn-for="SecurePaymentConfirmationRequest" data-dfn-type="dict-member" data-export id="dom-securepaymentconfirmationrequest-rpid"><code>rpId</code></dfn> member, <span> of type <a data-link-type="idl-name" href="https://webidl.spec.whatwg.org/#idl-USVString" id="ref-for-idl-USVString④">USVString</a></span>
    <dd data-md>
     <p>The <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party-identifier" id="ref-for-relying-party-identifier②">Relying Party Identifier</a> of the credentials.</p>
    <dt data-md><dfn class="dfn-paneled idl-code" data-dfn-for="SecurePaymentConfirmationRequest" data-dfn-type="dict-member" data-export id="dom-securepaymentconfirmationrequest-credentialids"><code>credentialIds</code></dfn> member, <span> of type sequence&lt;<a data-link-type="idl-name" href="https://webidl.spec.whatwg.org/#BufferSource" id="ref-for-BufferSource③">BufferSource</a>></span>
    <dd data-md>
     <p>The list of credential identifiers for the given instrument.</p>
    <dt data-md><dfn class="dfn-paneled idl-code" data-dfn-for="SecurePaymentConfirmationRequest" data-dfn-type="dict-member" data-export id="dom-securepaymentconfirmationrequest-instrument"><code>instrument</code></dfn> member, <span> of type <a data-link-type="idl-name" href="#dictdef-paymentcredentialinstrument" id="ref-for-dictdef-paymentcredentialinstrument①">PaymentCredentialInstrument</a></span>
    <dd data-md>
     <p>The description of the instrument name and icon to display during
registration and to be signed along with the transaction details.</p>
    <dt data-md><dfn class="dfn-paneled idl-code" data-dfn-for="SecurePaymentConfirmationRequest" data-dfn-type="dict-member" data-export id="dom-securepaymentconfirmationrequest-timeout"><code>timeout</code></dfn> member, <span> of type <a data-link-type="idl-name" href="https://webidl.spec.whatwg.org/#idl-unsigned-long" id="ref-for-idl-unsigned-long①">unsigned long</a></span>
    <dd data-md>
     <p>The number of milliseconds before the request to sign the transaction
details times out. At most 1 hour. Default values and the range of
allowed values is defined by the user agent. Web Authentication
provides <a href="https://w3c.github.io/webauthn/#sctn-createCredential">additional timeout guidance</a>.</p>
    <dt data-md><dfn class="dfn-paneled idl-code" data-dfn-for="SecurePaymentConfirmationRequest" data-dfn-type="dict-member" data-export id="dom-securepaymentconfirmationrequest-payeename"><code>payeeName</code></dfn> member, <span> of type <a data-link-type="idl-name" href="https://webidl.spec.whatwg.org/#idl-USVString" id="ref-for-idl-USVString⑤">USVString</a></span>
    <dd data-md>
     <p>The display name of the payee that this SPC call is for (e.g., the
merchant). Optional, may be provided alongside or instead of <code class="idl"><a data-link-type="idl" href="#dom-securepaymentconfirmationrequest-payeeorigin" id="ref-for-dom-securepaymentconfirmationrequest-payeeorigin①">payeeOrigin</a></code>.</p>
    <dt data-md><dfn class="dfn-paneled idl-code" data-dfn-for="SecurePaymentConfirmationRequest" data-dfn-type="dict-member" data-export id="dom-securepaymentconfirmationrequest-payeeorigin"><code>payeeOrigin</code></dfn> member, <span> of type <a data-link-type="idl-name" href="https://webidl.spec.whatwg.org/#idl-USVString" id="ref-for-idl-USVString⑥">USVString</a></span>
    <dd data-md>
     <p>The <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin" id="ref-for-concept-origin">origin</a> of the payee that this SPC call is for (e.g., the
merchant). Optional, may be provided alongside or instead of <code class="idl"><a data-link-type="idl" href="#dom-securepaymentconfirmationrequest-payeename" id="ref-for-dom-securepaymentconfirmationrequest-payeename①">payeeName</a></code>.</p>
    <dt data-md><dfn class="dfn-paneled idl-code" data-dfn-for="SecurePaymentConfirmationRequest" data-dfn-type="dict-member" data-export id="dom-securepaymentconfirmationrequest-extensions"><code>extensions</code></dfn> member, <span> of type <a data-link-type="idl-name" href="https://w3c.github.io/webauthn/#dictdef-authenticationextensionsclientinputs" id="ref-for-dictdef-authenticationextensionsclientinputs①">AuthenticationExtensionsClientInputs</a></span>
    <dd data-md>
     <p>Any <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#webauthn-extensions" id="ref-for-webauthn-extensions②">WebAuthn extensions</a> that should be used for the passed
credential(s). The caller does not need to specify the <a href="#sctn-payment-extension-registration"> payment extension</a>; it is added
automatically.</p>
    <dt data-md><dfn class="dfn-paneled idl-code" data-dfn-for="SecurePaymentConfirmationRequest" data-dfn-type="dict-member" data-export id="dom-securepaymentconfirmationrequest-locale"><code>locale</code></dfn> member, <span> of type sequence&lt;<a data-link-type="idl-name" href="https://webidl.spec.whatwg.org/#idl-USVString" id="ref-for-idl-USVString⑦">USVString</a>></span>
    <dd data-md>
     <p>An optional list of well-formed <a data-link-type="biblio" href="#biblio-bcp47" title="Tags for Identifying Languages">[BCP47]</a> language tags, in descending
order of priority, that identify the <a data-link-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-locale" id="ref-for-dfn-locale">locale</a> preferences of the
website, i.e. a <a data-link-type="dfn" href="https://w3c.github.io/i18n-glossary/#dfn-language-priority-list" id="ref-for-dfn-language-priority-list">language priority list</a> <a data-link-type="biblio" href="#biblio-rfc4647" title="Matching of Language Tags">[RFC4647]</a>, which the user
agent can use to perform <a data-link-type="dfn" href="https://w3c.github.io/i18n-glossary/#dfn-language-negotiation" id="ref-for-dfn-language-negotiation">language negotiation</a> and locale-affected
formatting with the caller.</p>
     <p class="note" role="note"><span class="marker">NOTE:</span> The <code class="idl"><a data-link-type="idl" href="#dom-securepaymentconfirmationrequest-locale" id="ref-for-dom-securepaymentconfirmationrequest-locale①">locale</a></code> is distinct from
      language or direction metadata associated with specific input
      members, in that it represents the caller’s requested localized
      experience rather than assertion about a specific string value.
      See <a href="#sctn-i18n-considerations">§ 13 Internationalization Considerations</a> for more discussion.</p>
    <dt data-md><dfn class="dfn-paneled idl-code" data-dfn-for="SecurePaymentConfirmationRequest" data-dfn-type="dict-member" data-export id="dom-securepaymentconfirmationrequest-showoptout"><code>showOptOut</code></dfn> member, <span> of type <a data-link-type="idl-name" href="https://webidl.spec.whatwg.org/#idl-boolean" id="ref-for-idl-boolean①">boolean</a></span>
    <dd data-md>
     <p>Whether the user should be given a chance to opt-out during the <a href="#sctn-transaction-confirmation-ux">transaction confirmation UX</a>.
Optional, default false.</p>
   </dl>
   <h4 class="heading settled" data-level="4.1.6" id="sctn-payment-method-additional-data-type"><span class="secno">4.1.6. </span><span class="content">Payment Method additional data type</span><a class="self-link" href="#sctn-payment-method-additional-data-type"></a></h4>
   <p>The <a data-link-type="dfn" href="https://w3c.github.io/payment-request/#dfn-additional-data-type" id="ref-for-dfn-additional-data-type">payment method additional data type</a> for this payment method is <code class="idl"><a data-link-type="idl" href="#dictdef-securepaymentconfirmationrequest" id="ref-for-dictdef-securepaymentconfirmationrequest②">SecurePaymentConfirmationRequest</a></code>.</p>
   <h4 class="heading settled" data-level="4.1.7" id="sctn-secure-payment-confirmation-available-api"><span class="secno">4.1.7. </span><span class="content">Checking if Secure Payment Confirmation is available</span><a class="self-link" href="#sctn-secure-payment-confirmation-available-api"></a></h4>
   <p>A static API is added to <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/payment-request/#dom-paymentrequest" id="ref-for-dom-paymentrequest①">PaymentRequest</a></code> in order to provide developers a
simplified method of checking whether Secure Payment Confirmation is available.</p>
<pre class="idl highlight def"><c- b>partial</c-> <c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="https://w3c.github.io/payment-request/#dom-paymentrequest" id="ref-for-dom-paymentrequest②"><c- g>PaymentRequest</c-></a> {
    <c- b>static</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean" id="ref-for-idl-boolean②"><c- b>boolean</c-></a>> <dfn class="dfn-paneled idl-code" data-dfn-for="PaymentRequest" data-dfn-type="method" data-export data-lt="isSecurePaymentConfirmationAvailable()" id="dom-paymentrequest-issecurepaymentconfirmationavailable"><code><c- g>isSecurePaymentConfirmationAvailable</c-></code></dfn>();
};
</pre>
   <dl>
    <dt data-md><code class="idl"><a data-link-type="idl" href="#dom-paymentrequest-issecurepaymentconfirmationavailable" id="ref-for-dom-paymentrequest-issecurepaymentconfirmationavailable">isSecurePaymentConfirmationAvailable()</a></code>
    <dd data-md>
     <p>Upon invocation, a promise is returned that resolves with a value of <code>true</code> if the Secure Payment Confirmation feature is available, or <code>false</code> otherwise.</p>
   </dl>
   <p>This allows a developer to perform the following check when deciding whether to
initiate a SPC flow:</p>
<pre class="example highlight" id="available-example"><a class="self-link" href="#available-example"></a><c- a>const</c-> spcAvailable <c- o>=</c->
    PaymentRequest <c- o>&amp;&amp;</c->
    PaymentRequest<c- p>.</c->isSecurePaymentConfirmationAvailable <c- o>&amp;&amp;</c->
    <c- k>await</c-> PaymentRequest<c- p>.</c->isSecurePaymentConfirmationAvailable<c- p>();</c->
</pre>
   <p class="note" role="note"><span class="marker">NOTE:</span> The use of the static <code class="idl"><a data-link-type="idl" href="#dom-paymentrequest-issecurepaymentconfirmationavailable" id="ref-for-dom-paymentrequest-issecurepaymentconfirmationavailable①">isSecurePaymentConfirmationAvailable</a></code> method is recommended for
      SPC feature detection, instead of calling <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/payment-request/#dom-paymentrequest-canmakepayment" id="ref-for-dom-paymentrequest-canmakepayment">canMakePayment</a></code> on an already-constructed
      PaymentRequest object.</p>
   <h4 class="heading settled" data-level="4.1.8" id="sctn-steps-to-validate-payment-method-data"><span class="secno">4.1.8. </span><span class="content">Steps to validate payment method data</span><a class="self-link" href="#sctn-steps-to-validate-payment-method-data"></a></h4>
   <p>The <a data-link-type="dfn" href="https://w3c.github.io/payment-request/#dfn-steps-to-validate-payment-method-data" id="ref-for-dfn-steps-to-validate-payment-method-data">steps to validate payment method data</a> for this payment method, for an
input <code class="idl"><a data-link-type="idl" href="#dictdef-securepaymentconfirmationrequest" id="ref-for-dictdef-securepaymentconfirmationrequest③">SecurePaymentConfirmationRequest</a></code> <var>data</var>, are:</p>
   <details class="wpt-tests-block" dir="ltr" lang="en">
    <summary>Tests</summary>
    <ul class="wpt-tests-list">
     <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/secure-payment-confirmation/constructor.https.html" title="secure-payment-confirmation/constructor.https.html">constructor.https.html</a> <a class="wpt-live" href="https://wpt.live/secure-payment-confirmation/constructor.https.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/secure-payment-confirmation/constructor.https.html"><small>(source)</small></a>
     <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/secure-payment-confirmation/constructor-validate-payment-method-data.https.html" title="secure-payment-confirmation/constructor-validate-payment-method-data.https.html">constructor-validate-payment-method-data.https.html</a> <a class="wpt-live" href="https://wpt.live/secure-payment-confirmation/constructor-validate-payment-method-data.https.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/secure-payment-confirmation/constructor-validate-payment-method-data.https.html"><small>(source)</small></a>
    </ul>
   </details>
   <ol>
    <li data-md>
     <p>If <var>data</var>["<code class="idl"><a data-link-type="idl" href="#dom-securepaymentconfirmationrequest-credentialids" id="ref-for-dom-securepaymentconfirmationrequest-credentialids①">credentialIds</a></code>"] is empty,
throw a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#exceptiondef-rangeerror" id="ref-for-exceptiondef-rangeerror①">RangeError</a></code>.</p>
    <li data-md>
     <p>For each <var>id</var> in <var>data</var>["<code class="idl"><a data-link-type="idl" href="#dom-securepaymentconfirmationrequest-credentialids" id="ref-for-dom-securepaymentconfirmationrequest-credentialids②">credentialIds</a></code>"]:</p>
     <ol>
      <li data-md>
       <p>If <var>id</var> is empty, throw a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#exceptiondef-rangeerror" id="ref-for-exceptiondef-rangeerror②">RangeError</a></code>.</p>
     </ol>
    <li data-md>
     <p>If <var>data</var>["<code class="idl"><a data-link-type="idl" href="#dom-securepaymentconfirmationrequest-challenge" id="ref-for-dom-securepaymentconfirmationrequest-challenge①">challenge</a></code>"] is null or
empty, throw a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#exceptiondef-typeerror" id="ref-for-exceptiondef-typeerror">TypeError</a></code>.</p>
    <li data-md>
     <p>If <var>data</var>["<code class="idl"><a data-link-type="idl" href="#dom-securepaymentconfirmationrequest-instrument" id="ref-for-dom-securepaymentconfirmationrequest-instrument①">instrument</a></code>"]["<code class="idl"><a data-link-type="idl" href="#dom-paymentcredentialinstrument-displayname" id="ref-for-dom-paymentcredentialinstrument-displayname">displayName</a></code>"]
is empty, throw a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#exceptiondef-typeerror" id="ref-for-exceptiondef-typeerror①">TypeError</a></code>.</p>
    <li data-md>
     <p>If <var>data</var>["<code class="idl"><a data-link-type="idl" href="#dom-securepaymentconfirmationrequest-instrument" id="ref-for-dom-securepaymentconfirmationrequest-instrument②">instrument</a></code>"]["<code class="idl"><a data-link-type="idl" href="#dom-paymentcredentialinstrument-icon" id="ref-for-dom-paymentcredentialinstrument-icon">icon</a></code>"]
is empty, throw a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#exceptiondef-typeerror" id="ref-for-exceptiondef-typeerror②">TypeError</a></code>.</p>
    <li data-md>
     <p>Run the URL parser on data["<code class="idl"><a data-link-type="idl" href="#dom-securepaymentconfirmationrequest-instrument" id="ref-for-dom-securepaymentconfirmationrequest-instrument③">instrument</a></code>"]
["<code class="idl"><a data-link-type="idl" href="#dom-paymentcredentialinstrument-icon" id="ref-for-dom-paymentcredentialinstrument-icon①">icon</a></code>"]. If this returns failure, throw a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#exceptiondef-typeerror" id="ref-for-exceptiondef-typeerror③">TypeError</a></code>.</p>
    <li data-md>
     <p>If <var>data</var>["<code class="idl"><a data-link-type="idl" href="#dom-securepaymentconfirmationrequest-rpid" id="ref-for-dom-securepaymentconfirmationrequest-rpid①">rpId</a></code>"] is not a <a data-link-type="dfn" href="https://url.spec.whatwg.org/#valid-domain" id="ref-for-valid-domain">valid domain</a>, throw a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#exceptiondef-typeerror" id="ref-for-exceptiondef-typeerror④">TypeError</a></code>.</p>
    <li data-md>
     <p>If both <var>data</var>["<code class="idl"><a data-link-type="idl" href="#dom-securepaymentconfirmationrequest-payeename" id="ref-for-dom-securepaymentconfirmationrequest-payeename②">payeeName</a></code>"] and <var>data</var>["<code class="idl"><a data-link-type="idl" href="#dom-securepaymentconfirmationrequest-payeeorigin" id="ref-for-dom-securepaymentconfirmationrequest-payeeorigin②">payeeOrigin</a></code>"] are omitted,
throw a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#exceptiondef-typeerror" id="ref-for-exceptiondef-typeerror⑤">TypeError</a></code>.</p>
    <li data-md>
     <p>If either of <var>data</var>["<code class="idl"><a data-link-type="idl" href="#dom-securepaymentconfirmationrequest-payeename" id="ref-for-dom-securepaymentconfirmationrequest-payeename③">payeeName</a></code>"] or <var>data</var>["<code class="idl"><a data-link-type="idl" href="#dom-securepaymentconfirmationrequest-payeeorigin" id="ref-for-dom-securepaymentconfirmationrequest-payeeorigin③">payeeOrigin</a></code>"] is present and
empty, throw a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#exceptiondef-typeerror" id="ref-for-exceptiondef-typeerror⑥">TypeError</a></code>.</p>
    <li data-md>
     <p>If <var>data</var>["<code class="idl"><a data-link-type="idl" href="#dom-securepaymentconfirmationrequest-payeeorigin" id="ref-for-dom-securepaymentconfirmationrequest-payeeorigin④">payeeOrigin</a></code>"] is present:</p>
     <ol>
      <li data-md>
       <p>Let <var>parsedURL</var> be the result of running the <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-parser" id="ref-for-concept-url-parser">URL parser</a> on <var>data</var>["<code class="idl"><a data-link-type="idl" href="#dom-securepaymentconfirmationrequest-payeeorigin" id="ref-for-dom-securepaymentconfirmationrequest-payeeorigin⑤">payeeOrigin</a></code>"].</p>
      <li data-md>
       <p>If <var>parsedURL</var> is failure, then throw a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#exceptiondef-typeerror" id="ref-for-exceptiondef-typeerror⑦">TypeError</a></code>.</p>
      <li data-md>
       <p>If <var>parsedURL</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-scheme" id="ref-for-concept-url-scheme">scheme</a> is not "<code>https</code>", then throw a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#exceptiondef-typeerror" id="ref-for-exceptiondef-typeerror⑧">TypeError</a></code>.</p>
     </ol>
   </ol>
   <h4 class="heading settled" data-level="4.1.9" id="sctn-steps-to-check-if-a-payment-can-be-made"><span class="secno">4.1.9. </span><span class="content">Steps to check if a payment can be made</span><a class="self-link" href="#sctn-steps-to-check-if-a-payment-can-be-made"></a></h4>
   <p>The <a data-link-type="dfn" href="https://w3c.github.io/payment-request/#dfn-steps-to-check-if-a-payment-can-be-made" id="ref-for-dfn-steps-to-check-if-a-payment-can-be-made">steps to check if a payment can be made</a> for this payment method, for an
input <code class="idl"><a data-link-type="idl" href="#dictdef-securepaymentconfirmationrequest" id="ref-for-dictdef-securepaymentconfirmationrequest④">SecurePaymentConfirmationRequest</a></code> <var>data</var>, are:</p>
   <details class="wpt-tests-block" dir="ltr" lang="en">
    <summary>Tests</summary>
    <ul class="wpt-tests-list">
     <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/secure-payment-confirmation/constructor.https.html" title="secure-payment-confirmation/constructor.https.html">constructor.https.html</a> <a class="wpt-live" href="https://wpt.live/secure-payment-confirmation/constructor.https.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/secure-payment-confirmation/constructor.https.html"><small>(source)</small></a>
     <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/secure-payment-confirmation/authentication-invalid-icon.https.html" title="secure-payment-confirmation/authentication-invalid-icon.https.html">authentication-invalid-icon.https.html</a> <a class="wpt-live" href="https://wpt.live/secure-payment-confirmation/authentication-invalid-icon.https.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/secure-payment-confirmation/authentication-invalid-icon.https.html"><small>(source)</small></a>
     <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/secure-payment-confirmation/authentication-icon-data-url.https.html" title="secure-payment-confirmation/authentication-icon-data-url.https.html">authentication-icon-data-url.https.html</a> <a class="wpt-live" href="https://wpt.live/secure-payment-confirmation/authentication-icon-data-url.https.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/secure-payment-confirmation/authentication-icon-data-url.https.html"><small>(source)</small></a>
     <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/secure-payment-confirmation/authentication-rejected.https.html" title="secure-payment-confirmation/authentication-rejected.https.html">authentication-rejected.https.html</a> <a class="wpt-live" href="https://wpt.live/secure-payment-confirmation/authentication-rejected.https.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/secure-payment-confirmation/authentication-rejected.https.html"><small>(source)</small></a>
    </ul>
   </details>
   <ol>
    <li data-md>
     <p>If <var>data</var>["<code class="idl"><a data-link-type="idl" href="#dom-securepaymentconfirmationrequest-payeeorigin" id="ref-for-dom-securepaymentconfirmationrequest-payeeorigin⑥">payeeOrigin</a></code>"] is present:</p>
     <ol>
      <li data-md>
       <p>Let <var>parsedURL</var> be the result of running the <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-parser" id="ref-for-concept-url-parser①">URL parser</a> on <var>data</var>["<code class="idl"><a data-link-type="idl" href="#dom-securepaymentconfirmationrequest-payeeorigin" id="ref-for-dom-securepaymentconfirmationrequest-payeeorigin⑦">payeeOrigin</a></code>"].</p>
      <li data-md>
       <p>Assert that <var>parsedURL</var> is not failure.</p>
      <li data-md>
       <p>Assert that <var>parsedURL</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-scheme" id="ref-for-concept-url-scheme①">scheme</a> is "<code>https</code>".</p>
     </ol>
     <p class="note" role="note"><span class="marker">NOTE:</span> These pre-conditions were previously checked in the <a href="#sctn-steps-to-validate-payment-method-data">steps to validate payment
   method data</a>.</p>
     <ol>
      <li data-md>
       <p>Set <var>data</var>["<code class="idl"><a data-link-type="idl" href="#dom-securepaymentconfirmationrequest-payeeorigin" id="ref-for-dom-securepaymentconfirmationrequest-payeeorigin⑧">payeeOrigin</a></code>"] to the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#ascii-serialisation-of-an-origin" id="ref-for-ascii-serialisation-of-an-origin">serialization of</a> <var>parsedURL</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-origin" id="ref-for-concept-url-origin">origin</a>.</p>
     </ol>
    <li data-md>
     <p><a data-link-type="dfn" href="https://w3c.github.io/image-resource/#dfn-fetching-an-image-resource" id="ref-for-dfn-fetching-an-image-resource">Fetch the image resource</a> for the icon, passing «["<code class="idl"><a data-link-type="idl" href="https://w3c.github.io/image-resource/#dom-imageresource-src" id="ref-for-dom-imageresource-src">src</a></code>" → <var>data</var>["<code class="idl"><a data-link-type="idl" href="#dom-securepaymentconfirmationrequest-instrument" id="ref-for-dom-securepaymentconfirmationrequest-instrument④">instrument</a></code>"]["<code class="idl"><a data-link-type="idl" href="#dom-paymentcredentialinstrument-icon" id="ref-for-dom-paymentcredentialinstrument-icon②">icon</a></code>"]]»
for <em>image</em>. If this fails:</p>
     <ol>
      <li data-md>
       <p>If <var>data</var>["<code class="idl"><a data-link-type="idl" href="#dom-securepaymentconfirmationrequest-instrument" id="ref-for-dom-securepaymentconfirmationrequest-instrument⑤">instrument</a></code>"]["<code class="idl"><a data-link-type="idl" href="#dom-paymentcredentialinstrument-iconmustbeshown" id="ref-for-dom-paymentcredentialinstrument-iconmustbeshown">iconMustBeShown</a></code>"]
is <code>true</code>, then return <code>false</code>.</p>
      <li data-md>
       <p>Otherwise, set <var>data</var>["<code class="idl"><a data-link-type="idl" href="#dom-securepaymentconfirmationrequest-instrument" id="ref-for-dom-securepaymentconfirmationrequest-instrument⑥">instrument</a></code>"]["<code class="idl"><a data-link-type="idl" href="#dom-paymentcredentialinstrument-icon" id="ref-for-dom-paymentcredentialinstrument-icon③">icon</a></code>"]
to an empty string.</p>
       <p class="note" role="note"><span class="marker">Note:</span> This lets the RP know that the specified icon was not shown, as the output <code class="idl"><a data-link-type="idl" href="#dom-collectedclientadditionalpaymentdata-instrument" id="ref-for-dom-collectedclientadditionalpaymentdata-instrument">instrument</a></code> will have an empty icon
string.</p>
     </ol>
     <p class="note" role="note"><span class="marker">Note:</span> The image resource must be fetched whether or not any credential
matches, to defeat attempts to <a href="#sctn-privacy-probing-credential-ids">probe
for credential existence</a>.</p>
    <li data-md>
     <p>For each <var>id</var> in <var>data</var>["<code class="idl"><a data-link-type="idl" href="#dom-securepaymentconfirmationrequest-credentialids" id="ref-for-dom-securepaymentconfirmationrequest-credentialids③">credentialIds</a></code>"]:</p>
     <ol>
      <li data-md>
       <p>Run the <a data-link-type="dfn" href="#steps-to-silently-determine-if-a-credential-is-available-for-the-current-device" id="ref-for-steps-to-silently-determine-if-a-credential-is-available-for-the-current-device">steps to silently determine if a credential is available for
the current device</a> and the <a data-link-type="dfn" href="#steps-to-silently-determine-if-a-credential-is-spc-enabled" id="ref-for-steps-to-silently-determine-if-a-credential-is-spc-enabled">steps to silently determine if a
credential is SPC-enabled</a>, passing in <var>data</var>["<code class="idl"><a data-link-type="idl" href="#dom-securepaymentconfirmationrequest-rpid" id="ref-for-dom-securepaymentconfirmationrequest-rpid②">rpId</a></code>"] and <var>id</var>. If the
result of either of these is <code>false</code>, remove <var>id</var> from <var>data</var>["<code class="idl"><a data-link-type="idl" href="#dom-securepaymentconfirmationrequest-credentialids" id="ref-for-dom-securepaymentconfirmationrequest-credentialids④">credentialIds</a></code>"].</p>
     </ol>
    <li data-md>
     <p>If <var>data</var>["<code class="idl"><a data-link-type="idl" href="#dom-securepaymentconfirmationrequest-credentialids" id="ref-for-dom-securepaymentconfirmationrequest-credentialids⑤">credentialIds</a></code>"] is now empty,
return <code>false</code>. The user agent must maintain <a href="#sctn-privacy-probing-credential-ids">authentication ceremony privacy</a> and not leak this lack of matching credentials to the caller, by:</p>
     <ol>
      <li data-md>
       <p>Not allowing the caller to perform a timing attack on this outcome versus
the user declining to authenticate on the <a href="#sctn-transaction-confirmation-ux">transaction confirmation UX</a>, e.g.,
by presenting an alternative interstitial that the user must interact
with.</p>
      <li data-md>
       <p>Rejecting the <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/payment-request/#dom-paymentrequest-show" id="ref-for-dom-paymentrequest-show①">show()</a></code> promise with a
"<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#notallowederror" id="ref-for-notallowederror">NotAllowedError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException①">DOMException</a></code>.</p>
     </ol>
    <li data-md>
     <p>Return <code>true</code>.</p>
   </ol>
   <h4 class="heading settled" data-level="4.1.10" id="sctn-transaction-confirmation-ux"><span class="secno">4.1.10. </span><span class="content">Displaying a transaction confirmation UX</span><a class="self-link" href="#sctn-transaction-confirmation-ux"></a></h4>
   <p>To avoid restricting User Agent implementation choice, this specification does
not require a User Agent to display a particular user interface when <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/payment-request/#dom-paymentrequest-show" id="ref-for-dom-paymentrequest-show②">PaymentRequest.show()</a></code> is called and the <a data-link-type="dfn" href="#secure-payment-confirmation-payment-handler" id="ref-for-secure-payment-confirmation-payment-handler①">Secure
Payment Confirmation payment handler</a> is selected. However, so that a <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party①⑥">Relying Party</a> can trust the information included in <code class="idl"><a data-link-type="idl" href="#dictdef-collectedclientpaymentdata" id="ref-for-dictdef-collectedclientpaymentdata">CollectedClientPaymentData</a></code>, the User Agent MUST ensure that the following
is communicated to the user and that the user’s consent is collected for the
authentication:</p>
   <ul>
    <li data-md>
     <p>The <code class="idl"><a data-link-type="idl" href="#dom-collectedclientadditionalpaymentdata-payeename" id="ref-for-dom-collectedclientadditionalpaymentdata-payeename">payeeName</a></code> if it is present.</p>
    <li data-md>
     <p>The <code class="idl"><a data-link-type="idl" href="#dom-collectedclientadditionalpaymentdata-payeeorigin" id="ref-for-dom-collectedclientadditionalpaymentdata-payeeorigin">payeeOrigin</a></code> if it is present.</p>
    <li data-md>
     <p>The <code class="idl"><a data-link-type="idl" href="#dom-collectedclientadditionalpaymentdata-total" id="ref-for-dom-collectedclientadditionalpaymentdata-total">total</a></code>, that is the <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/payment-request/#dom-paymentcurrencyamount-currency" id="ref-for-dom-paymentcurrencyamount-currency">currency</a></code> and <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/payment-request/#dom-paymentcurrencyamount-value" id="ref-for-dom-paymentcurrencyamount-value">value</a></code> of the
transaction.</p>
    <li data-md>
     <p>The <code class="idl"><a data-link-type="idl" href="#dom-collectedclientadditionalpaymentdata-instrument" id="ref-for-dom-collectedclientadditionalpaymentdata-instrument①">instrument</a></code> details, that is the
payment instrument <code class="idl"><a data-link-type="idl" href="#dom-paymentcredentialinstrument-displayname" id="ref-for-dom-paymentcredentialinstrument-displayname①">displayName</a></code> and <code class="idl"><a data-link-type="idl" href="#dom-paymentcredentialinstrument-icon" id="ref-for-dom-paymentcredentialinstrument-icon④">icon</a></code>. If an image resource could not be
fetched or decoded from the input <code class="idl"><a data-link-type="idl" href="#dom-paymentcredentialinstrument-icon" id="ref-for-dom-paymentcredentialinstrument-icon⑤">icon</a></code>,
then the User Agent may show no icon or a generic payment instrument
icon in its place.</p>
     <p class="note" role="note"><span class="marker">NOTE:</span> If the specified icon could not be fetched or decoded, then <code class="idl"><a data-link-type="idl" href="#dom-paymentcredentialinstrument-iconmustbeshown" id="ref-for-dom-paymentcredentialinstrument-iconmustbeshown①">iconMustBeShown</a></code> must be <code>false</code> here as
otherwise the <a href="#sctn-steps-to-check-if-a-payment-can-be-made">the steps
to check if a payment can be made</a> would have failed previously.</p>
   </ul>
   <p>The user agent MAY utilize the information in <code class="idl"><a data-link-type="idl" href="#dom-securepaymentconfirmationrequest-locale" id="ref-for-dom-securepaymentconfirmationrequest-locale②">locale</a></code>, if any, to display a UX localized
into a language and using locale-based formatting consistent with that of the
website.</p>
   <p>If <code class="idl"><a data-link-type="idl" href="#dom-securepaymentconfirmationrequest-showoptout" id="ref-for-dom-securepaymentconfirmationrequest-showoptout①">showOptOut</a></code> is <code>true</code>, the user agent
MUST give the user the opportunity to indicate that they want to opt out of the
process for the <code class="idl"><a data-link-type="idl" href="#dom-securepaymentconfirmationrequest-rpid" id="ref-for-dom-securepaymentconfirmationrequest-rpid③">given relying party</a></code>.
If the user indicates that they wish to opt-out, then the user agent must reject
the <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/payment-request/#dom-paymentrequest-show" id="ref-for-dom-paymentrequest-show③">show()</a></code> promise with an
"<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#optouterror" id="ref-for-optouterror">OptOutError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException②">DOMException</a></code>. See <a href="#sctn-user-opt-out">§ 11.5 User opt out</a>.</p>
   <details class="wpt-tests-block" dir="ltr" lang="en">
    <summary>Tests</summary>
    <ul class="wpt-tests-list">
     <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/secure-payment-confirmation/authentication-optout.https.html" title="secure-payment-confirmation/authentication-optout.https.html">authentication-optout.https.html</a> <a class="wpt-live" href="https://wpt.live/secure-payment-confirmation/authentication-optout.https.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/secure-payment-confirmation/authentication-optout.https.html"><small>(source)</small></a>
    </ul>
   </details>
   <p>If the <a data-link-type="dfn" href="#current-transaction-automation-mode" id="ref-for-current-transaction-automation-mode">current transaction automation mode</a> is not "<code>none</code>", the user agent
should first verify that it is in an automation context (see <a href="https://w3c.github.io/webdriver/#security">WebDriver’s Security considerations</a>). The user agent
should then bypass the above communication of information and gathering of user
consent, and instead do the following based on the value of the <a data-link-type="dfn" href="#current-transaction-automation-mode" id="ref-for-current-transaction-automation-mode①">current
transaction automation mode</a>:</p>
   <dl>
    <dt data-md>"<code>autoAccept</code>"
    <dd data-md>
     <p>Act as if the user has seen the transaction details and accepted
the authentication.</p>
    <dt data-md>"<code>autoReject</code>"
    <dd data-md>
     <p>Act as if the user has seen the transaction details and rejected
the authentication.</p>
    <dt data-md>"<code>autoOptOut</code>"
    <dd data-md>
     <p>Act as if the user has seen the transaction details and indicated
they want to opt out.</p>
   </dl>
   <h4 class="heading settled" data-level="4.1.11" id="sctn-steps-to-respond-to-a-payment-request"><span class="secno">4.1.11. </span><span class="content">Steps to respond to a payment request</span><a class="self-link" href="#sctn-steps-to-respond-to-a-payment-request"></a></h4>
   <p>The <a data-link-type="dfn" href="https://w3c.github.io/payment-request/#dfn-steps-to-respond-to-a-payment-request" id="ref-for-dfn-steps-to-respond-to-a-payment-request">steps to respond to a payment request</a> for this payment method, for a given <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/payment-request/#dom-paymentrequest" id="ref-for-dom-paymentrequest③">PaymentRequest</a></code> <var>request</var> and <code class="idl"><a data-link-type="idl" href="#dictdef-securepaymentconfirmationrequest" id="ref-for-dictdef-securepaymentconfirmationrequest⑤">SecurePaymentConfirmationRequest</a></code> <var>data</var>, are:</p>
   <ol>
    <li data-md>
     <p>Let <var>topOrigin</var> be the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-top-level-origin" id="ref-for-concept-environment-top-level-origin">top-level origin</a> of the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object">relevant settings object</a> of <var>request</var>.</p>
    <li data-md>
     <p>Let <var>payment</var> be a new a <code class="idl"><a data-link-type="idl" href="#dictdef-authenticationextensionspaymentinputs" id="ref-for-dictdef-authenticationextensionspaymentinputs">AuthenticationExtensionsPaymentInputs</a></code> dictionary,
whose fields are:</p>
     <dl>
      <dt data-md><code class="idl"><a data-link-type="idl" href="#dom-authenticationextensionspaymentinputs-ispayment" id="ref-for-dom-authenticationextensionspaymentinputs-ispayment">isPayment</a></code>
      <dd data-md>
       <p>The boolean value <code>true</code>.</p>
      <dt data-md><code class="idl"><a data-link-type="idl" href="#dom-authenticationextensionspaymentinputs-rpid" id="ref-for-dom-authenticationextensionspaymentinputs-rpid">rpId</a></code>
      <dd data-md>
       <p><var>data</var>["<code class="idl"><a data-link-type="idl" href="#dom-securepaymentconfirmationrequest-rpid" id="ref-for-dom-securepaymentconfirmationrequest-rpid④">rpId</a></code>"]</p>
      <dt data-md><code class="idl"><a data-link-type="idl" href="#dom-authenticationextensionspaymentinputs-toporigin" id="ref-for-dom-authenticationextensionspaymentinputs-toporigin">topOrigin</a></code>
      <dd data-md>
       <p><var>topOrigin</var></p>
      <dt data-md><code class="idl"><a data-link-type="idl" href="#dom-authenticationextensionspaymentinputs-payeename" id="ref-for-dom-authenticationextensionspaymentinputs-payeename">payeeName</a></code>
      <dd data-md>
       <p><var>data</var>["<code class="idl"><a data-link-type="idl" href="#dom-securepaymentconfirmationrequest-payeename" id="ref-for-dom-securepaymentconfirmationrequest-payeename④">payeeName</a></code>"] if it is
present, otherwise omitted.</p>
      <dt data-md><code class="idl"><a data-link-type="idl" href="#dom-authenticationextensionspaymentinputs-payeeorigin" id="ref-for-dom-authenticationextensionspaymentinputs-payeeorigin">payeeOrigin</a></code>
      <dd data-md>
       <p><var>data</var>["<code class="idl"><a data-link-type="idl" href="#dom-securepaymentconfirmationrequest-payeeorigin" id="ref-for-dom-securepaymentconfirmationrequest-payeeorigin⑨">payeeOrigin</a></code>"] if it is
present, otherwise omitted.</p>
      <dt data-md><code class="idl"><a data-link-type="idl" href="#dom-authenticationextensionspaymentinputs-total" id="ref-for-dom-authenticationextensionspaymentinputs-total">total</a></code>
      <dd data-md>
       <p><var>request</var>.<a data-link-type="dfn" href="https://w3c.github.io/payment-request/#dfn-details" id="ref-for-dfn-details">[[details]]</a>["<code class="idl"><a data-link-type="idl" href="https://w3c.github.io/payment-request/#dom-paymentdetailsinit-total" id="ref-for-dom-paymentdetailsinit-total">total</a></code>"]</p>
      <dt data-md><code class="idl"><a data-link-type="idl" href="#dom-authenticationextensionspaymentinputs-instrument" id="ref-for-dom-authenticationextensionspaymentinputs-instrument">instrument</a></code>
      <dd data-md>
       <p><var>data</var>["<code class="idl"><a data-link-type="idl" href="#dom-securepaymentconfirmationrequest-instrument" id="ref-for-dom-securepaymentconfirmationrequest-instrument⑦">instrument</a></code>"]</p>
     </dl>
    <li data-md>
     <p>Let <var>extensions</var> be a new <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dictdef-authenticationextensionsclientinputs" id="ref-for-dictdef-authenticationextensionsclientinputs②">AuthenticationExtensionsClientInputs</a></code> dictionary
whose <code class="idl"><a data-link-type="idl" href="#dom-authenticationextensionsclientinputs-payment" id="ref-for-dom-authenticationextensionsclientinputs-payment①">payment</a></code> member is set to <var>payment</var>, and whose other members are set from <var>data</var>["<code class="idl"><a data-link-type="idl" href="#dom-securepaymentconfirmationrequest-extensions" id="ref-for-dom-securepaymentconfirmationrequest-extensions①">extensions</a></code>"].</p>
    <li data-md>
     <p>Let <var>publicKeyOpts</var> be a new <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dictdef-publickeycredentialrequestoptions" id="ref-for-dictdef-publickeycredentialrequestoptions">PublicKeyCredentialRequestOptions</a></code> dictionary, whose fields are:</p>
     <dl>
      <dt data-md><code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dom-publickeycredentialrequestoptions-challenge" id="ref-for-dom-publickeycredentialrequestoptions-challenge①">challenge</a></code>
      <dd data-md>
       <p><var>data</var>["<code class="idl"><a data-link-type="idl" href="#dom-securepaymentconfirmationrequest-challenge" id="ref-for-dom-securepaymentconfirmationrequest-challenge②">challenge</a></code>"]</p>
      <dt data-md><code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dom-publickeycredentialrequestoptions-timeout" id="ref-for-dom-publickeycredentialrequestoptions-timeout">timeout</a></code>
      <dd data-md>
       <p><var>data</var>["<code class="idl"><a data-link-type="idl" href="#dom-securepaymentconfirmationrequest-timeout" id="ref-for-dom-securepaymentconfirmationrequest-timeout①">timeout</a></code>"]</p>
      <dt data-md><code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dom-publickeycredentialrequestoptions-rpid" id="ref-for-dom-publickeycredentialrequestoptions-rpid">rpId</a></code>
      <dd data-md>
       <p><var>data</var>["<code class="idl"><a data-link-type="idl" href="#dom-securepaymentconfirmationrequest-rpid" id="ref-for-dom-securepaymentconfirmationrequest-rpid⑤">rpId</a></code>"]</p>
      <dt data-md><code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dom-publickeycredentialrequestoptions-userverification" id="ref-for-dom-publickeycredentialrequestoptions-userverification">userVerification</a></code>
      <dd data-md>
       <p><code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dom-userverificationrequirement-required" id="ref-for-dom-userverificationrequirement-required">required</a></code></p>
      <dt data-md><code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dom-publickeycredentialrequestoptions-extensions" id="ref-for-dom-publickeycredentialrequestoptions-extensions">extensions</a></code>
      <dd data-md>
       <p><var>extensions</var></p>
     </dl>
     <p class="note" role="note"><span class="marker">Note:</span> This algorithm hard-codes "required" as the value for <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dom-publickeycredentialrequestoptions-userverification" id="ref-for-dom-publickeycredentialrequestoptions-userverification①">userVerification</a></code>, because that is what Chrome’s initial implementation supports. The current limitations may change. The Working Group invites implementers to share use cases that would benefit from support for other values (e.g., "preferred" or "discouraged").</p>
    <li data-md>
     <p>For each <var>id</var> in <var>data</var>["<code class="idl"><a data-link-type="idl" href="#dom-securepaymentconfirmationrequest-credentialids" id="ref-for-dom-securepaymentconfirmationrequest-credentialids⑥">credentialIds</a></code>"]:</p>
     <ol>
      <li data-md>
       <p>Let <var>descriptor</var> be a new <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dictdef-publickeycredentialdescriptor" id="ref-for-dictdef-publickeycredentialdescriptor">PublicKeyCredentialDescriptor</a></code> dictionary,
whose fields are:</p>
       <dl>
        <dt data-md><code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dom-publickeycredentialdescriptor-type" id="ref-for-dom-publickeycredentialdescriptor-type">type</a></code>
        <dd data-md>
         <p><code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dom-publickeycredentialtype-public-key" id="ref-for-dom-publickeycredentialtype-public-key">public-key</a></code></p>
        <dt data-md><code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dom-publickeycredentialdescriptor-id" id="ref-for-dom-publickeycredentialdescriptor-id">id</a></code>
        <dd data-md>
         <p><var>id</var></p>
        <dt data-md><code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dom-publickeycredentialdescriptor-transports" id="ref-for-dom-publickeycredentialdescriptor-transports">transports</a></code>
        <dd data-md>
         <p>A sequence of length 1 whose only member is <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dom-authenticatortransport-internal" id="ref-for-dom-authenticatortransport-internal">internal</a></code>.</p>
       </dl>
      <li data-md>
       <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-append" id="ref-for-list-append">Append</a> <var>descriptor</var> to <var>publicKeyOpts</var>["<code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dom-publickeycredentialrequestoptions-allowcredentials" id="ref-for-dom-publickeycredentialrequestoptions-allowcredentials">allowCredentials</a></code>"].</p>
     </ol>
    <li data-md>
     <p>Let <var>outputCredential</var> be the result of running the algorithm to <a data-link-type="dfn" href="https://w3c.github.io/webappsec-credential-management/#abstract-opdef-request-a-credential" id="ref-for-abstract-opdef-request-a-credential">Request a Credential</a>, passing «["<code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dom-credentialrequestoptions-publickey" id="ref-for-dom-credentialrequestoptions-publickey">publicKey</a></code>"
→ <var>publicKeyOpts</var>]».</p>
     <p class="note" role="note"><span class="marker">Note:</span> Chrome’s initial implementation does not pass the full <code>data.credentialIds</code> list to <a data-link-type="dfn" href="https://w3c.github.io/webappsec-credential-management/#abstract-opdef-request-a-credential" id="ref-for-abstract-opdef-request-a-credential①">Request a Credential</a>. Instead, it chooses one credential in the list that matches the current device and passes only that in.</p>
     <p class="note" role="note"><span class="marker">Note:</span> This triggers <a data-link-type="biblio" href="#biblio-webauthn-3" title="Web Authentication: An API for accessing Public Key Credentials - Level 3">[webauthn-3]</a>'s <a href="https://w3c.github.io/webauthn/#sctn-getAssertion">Get</a> behavior</p>
    <li data-md>
     <p>Return <var>outputCredential</var>.</p>
   </ol>
   <h2 class="heading settled" data-level="5" id="sctn-payment-extension-registration"><span class="secno">5. </span><span class="content">WebAuthn Extension - "<code>payment</code>"</span><a class="self-link" href="#sctn-payment-extension-registration"></a></h2>
   <p>This <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#client-extension" id="ref-for-client-extension">client</a> <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#registration-extension" id="ref-for-registration-extension">registration extension</a> and <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#authentication-extension" id="ref-for-authentication-extension">authentication extension</a> indicates that a credential is either being
created for or used for Secure Payment Confirmation, respectively.</p>
   <p>For registration, this extension relaxes the WebAuthn requirements to allow
credential creation in a cross-origin iframe, and also allows the browser to
identify and cache Secure Payment Confirmation credential IDs. For
authentication, this extension allows a third-party to perform an
authentication ceremony on behalf of the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party①⑦">Relying Party</a>, and also adds
transaction information to the signed cryptogram.</p>
   <p>Notably, a website should not call <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webappsec-credential-management/#dom-credentialscontainer-get" id="ref-for-dom-credentialscontainer-get">navigator.credentials.get()</a></code> with this extension
directly; for authentication the extension can only be accessed via <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/payment-request/#dom-paymentrequest" id="ref-for-dom-paymentrequest④">PaymentRequest</a></code> with a "<a data-link-type="dfn" href="#secure-payment-confirmation" id="ref-for-secure-payment-confirmation③">secure-payment-confirmation</a>" payment method.</p>
   <details class="wpt-tests-block" dir="ltr" lang="en">
    <summary>Tests</summary>
    <p>This test does not directly correspond to a spec line, but instead
            tests that authentication can be triggered from inside a
            cross-origin iframe. That behavior is specified by the lack of any
            line forbidding it.</p>
    <ul class="wpt-tests-list">
     <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/secure-payment-confirmation/authentication-in-iframe.sub.https.html" title="secure-payment-confirmation/authentication-in-iframe.sub.https.html">authentication-in-iframe.sub.https.html</a> <a class="wpt-live" href="https://wpt.live/secure-payment-confirmation/authentication-in-iframe.sub.https.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/secure-payment-confirmation/authentication-in-iframe.sub.https.html"><small>(source)</small></a>
    </ul>
    <hr>
   </details>
   <dl>
    <dt data-md>Extension identifier
    <dd data-md>
     <p><code>payment</code></p>
    <dt data-md>Operation applicability
    <dd data-md>
     <p><a data-link-type="dfn" href="https://w3c.github.io/webauthn/#registration-extension" id="ref-for-registration-extension①">Registration</a> and <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#authentication-extension" id="ref-for-authentication-extension①">authentication</a></p>
    <dt data-md>Client extension input
    <dd data-md>
<pre class="idl highlight def"><c- b>partial</c-> <c- b>dictionary</c-> <a class="idl-code" data-link-type="dictionary" href="https://w3c.github.io/webauthn/#dictdef-authenticationextensionsclientinputs" id="ref-for-dictdef-authenticationextensionsclientinputs③"><c- g>AuthenticationExtensionsClientInputs</c-></a> {
  <a data-link-type="idl-name" href="#dictdef-authenticationextensionspaymentinputs" id="ref-for-dictdef-authenticationextensionspaymentinputs①"><c- n>AuthenticationExtensionsPaymentInputs</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="AuthenticationExtensionsClientInputs" data-dfn-type="dict-member" data-export data-type="AuthenticationExtensionsPaymentInputs " id="dom-authenticationextensionsclientinputs-payment"><code><c- g>payment</c-></code></dfn>;
};

<c- b>dictionary</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-authenticationextensionspaymentinputs"><code><c- g>AuthenticationExtensionsPaymentInputs</c-></code></dfn> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean" id="ref-for-idl-boolean③"><c- b>boolean</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="boolean " href="#dom-authenticationextensionspaymentinputs-ispayment" id="ref-for-dom-authenticationextensionspaymentinputs-ispayment①"><c- g>isPayment</c-></a>;

  // Only used for authentication.
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString" id="ref-for-idl-USVString⑧"><c- b>USVString</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="USVString " href="#dom-authenticationextensionspaymentinputs-rpid" id="ref-for-dom-authenticationextensionspaymentinputs-rpid①"><c- g>rpId</c-></a>;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString" id="ref-for-idl-USVString⑨"><c- b>USVString</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="USVString " href="#dom-authenticationextensionspaymentinputs-toporigin" id="ref-for-dom-authenticationextensionspaymentinputs-toporigin①"><c- g>topOrigin</c-></a>;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString" id="ref-for-idl-USVString①⓪"><c- b>USVString</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="USVString " href="#dom-authenticationextensionspaymentinputs-payeename" id="ref-for-dom-authenticationextensionspaymentinputs-payeename①"><c- g>payeeName</c-></a>;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString" id="ref-for-idl-USVString①①"><c- b>USVString</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="USVString " href="#dom-authenticationextensionspaymentinputs-payeeorigin" id="ref-for-dom-authenticationextensionspaymentinputs-payeeorigin①"><c- g>payeeOrigin</c-></a>;
  <a data-link-type="idl-name" href="https://w3c.github.io/payment-request/#dom-paymentcurrencyamount" id="ref-for-dom-paymentcurrencyamount"><c- n>PaymentCurrencyAmount</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="PaymentCurrencyAmount " href="#dom-authenticationextensionspaymentinputs-total" id="ref-for-dom-authenticationextensionspaymentinputs-total①"><c- g>total</c-></a>;
  <a data-link-type="idl-name" href="#dictdef-paymentcredentialinstrument" id="ref-for-dictdef-paymentcredentialinstrument②"><c- n>PaymentCredentialInstrument</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="PaymentCredentialInstrument " href="#dom-authenticationextensionspaymentinputs-instrument" id="ref-for-dom-authenticationextensionspaymentinputs-instrument①"><c- g>instrument</c-></a>;
};
</pre>
     <dl>
      <dt data-md><dfn class="dfn-paneled idl-code" data-dfn-for="AuthenticationExtensionsPaymentInputs" data-dfn-type="dict-member" data-export id="dom-authenticationextensionspaymentinputs-ispayment"><code>isPayment</code></dfn> member, <span> of type <a data-link-type="idl-name" href="https://webidl.spec.whatwg.org/#idl-boolean" id="ref-for-idl-boolean④">boolean</a></span>
      <dd data-md>
       <p>Indicates that the extension is active.</p>
      <dt data-md><dfn class="dfn-paneled idl-code" data-dfn-for="AuthenticationExtensionsPaymentInputs" data-dfn-type="dict-member" data-export id="dom-authenticationextensionspaymentinputs-rpid"><code>rpId</code></dfn> member, <span> of type <a data-link-type="idl-name" href="https://webidl.spec.whatwg.org/#idl-USVString" id="ref-for-idl-USVString①②">USVString</a></span>
      <dd data-md>
       <p>The <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party①⑧">Relying Party</a> id of the credential(s) being used. Only used at authentication time; not registration.</p>
      <dt data-md><dfn class="dfn-paneled idl-code" data-dfn-for="AuthenticationExtensionsPaymentInputs" data-dfn-type="dict-member" data-export id="dom-authenticationextensionspaymentinputs-toporigin"><code>topOrigin</code></dfn> member, <span> of type <a data-link-type="idl-name" href="https://webidl.spec.whatwg.org/#idl-USVString" id="ref-for-idl-USVString①③">USVString</a></span>
      <dd data-md>
       <p>The origin of the top-level frame. Only used at authentication time; not registration.</p>
      <dt data-md><dfn class="dfn-paneled idl-code" data-dfn-for="AuthenticationExtensionsPaymentInputs" data-dfn-type="dict-member" data-export id="dom-authenticationextensionspaymentinputs-payeename"><code>payeeName</code></dfn> member, <span> of type <a data-link-type="idl-name" href="https://webidl.spec.whatwg.org/#idl-USVString" id="ref-for-idl-USVString①④">USVString</a></span>
      <dd data-md>
       <p>The payee name, if present, that was displayed to the user. Only used at authentication time; not registration.</p>
      <dt data-md><dfn class="dfn-paneled idl-code" data-dfn-for="AuthenticationExtensionsPaymentInputs" data-dfn-type="dict-member" data-export id="dom-authenticationextensionspaymentinputs-payeeorigin"><code>payeeOrigin</code></dfn> member, <span> of type <a data-link-type="idl-name" href="https://webidl.spec.whatwg.org/#idl-USVString" id="ref-for-idl-USVString①⑤">USVString</a></span>
      <dd data-md>
       <p>The payee origin, if present, that was displayed to the user. Only used at authentication time; not registration.</p>
      <dt data-md><dfn class="dfn-paneled idl-code" data-dfn-for="AuthenticationExtensionsPaymentInputs" data-dfn-type="dict-member" data-export id="dom-authenticationextensionspaymentinputs-total"><code>total</code></dfn> member, <span> of type <a data-link-type="idl-name" href="https://w3c.github.io/payment-request/#dom-paymentcurrencyamount" id="ref-for-dom-paymentcurrencyamount①">PaymentCurrencyAmount</a></span>
      <dd data-md>
       <p>The transaction amount that was displayed to the user. Only used at authentication time; not registration.</p>
      <dt data-md><dfn class="dfn-paneled idl-code" data-dfn-for="AuthenticationExtensionsPaymentInputs" data-dfn-type="dict-member" data-export id="dom-authenticationextensionspaymentinputs-instrument"><code>instrument</code></dfn> member, <span> of type <a data-link-type="idl-name" href="#dictdef-paymentcredentialinstrument" id="ref-for-dictdef-paymentcredentialinstrument③">PaymentCredentialInstrument</a></span>
      <dd data-md>
       <p>The instrument details that were displayed to the user. Only used at authentication time; not registration.</p>
     </dl>
    <dt data-md><dfn data-dfn-type="dfn" data-export id="client-extension-processing-registration">Client extension processing (<a data-link-type="dfn" href="https://w3c.github.io/webauthn/#registration-extension" id="ref-for-registration-extension②">registration</a>)<a class="self-link" href="#client-extension-processing-registration"></a></dfn>
    <dd data-md>
     <p>When <a href="https://w3c.github.io/webauthn/#sctn-createCredential">creating a new credential</a>:</p>
     <ol>
      <li data-md>
       <p>Modify step 2 (the check for <em>sameOriginWithAncestors</em>) as follows:</p>
       <ul>
        <li data-md>
         <p>If <em>sameOriginWithAncestors</em> is <code>false</code>:</p>
         <ul>
          <li data-md>
           <p>If the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global" id="ref-for-concept-relevant-global②">relevant global object</a>, as determined by the calling <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webappsec-credential-management/#dom-credentialscontainer-create" id="ref-for-dom-credentialscontainer-create①">create()</a></code> implementation, does not have <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/interaction.html#transient-activation" id="ref-for-transient-activation①">transient activation</a>:</p>
           <ul>
            <li data-md>
             <p>Return a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException③">DOMException</a></code> whose name is "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#securityerror" id="ref-for-securityerror①">SecurityError</a></code>", and
terminate this algorithm.</p>
           </ul>
          <li data-md>
           <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/interaction.html#consume-user-activation" id="ref-for-consume-user-activation①">Consume user activation</a> of the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global" id="ref-for-concept-relevant-global③">relevant global object</a>.</p>
         </ul>
         <details class="wpt-tests-block" dir="ltr" lang="en">
          <summary>Tests</summary>
          <ul class="wpt-tests-list">
           <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/secure-payment-confirmation/enrollment-in-iframe.sub.https.html" title="secure-payment-confirmation/enrollment-in-iframe.sub.https.html">enrollment-in-iframe.sub.https.html</a> <a class="wpt-live" href="https://wpt.live/secure-payment-confirmation/enrollment-in-iframe.sub.https.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/secure-payment-confirmation/enrollment-in-iframe.sub.https.html"><small>(source)</small></a>
          </ul>
         </details>
       </ul>
       <p class="note" role="note"><span class="marker">Note:</span> This allows for creating SPC credentials in a cross-origin
 iframe, as long as the correct permission policy is set
 (see <a href="#sctn-permissions-policy">§ 7 Permissions Policy integration</a>). A <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/interaction.html#transient-activation" id="ref-for-transient-activation②">transient activation</a> is
 also required in this case to mitigate privacy risks; see <a href="#sctn-security-cross-origin-registration">§ 11.1 Registration in a Cross-Origin iframe</a>.</p>
      <li data-md>
       <p>After step 3, insert the following step:</p>
       <ul>
        <li data-md>
         <p>If any of the following are true:</p>
         <ul>
          <li data-md>
           <p><em>options</em>["<code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dom-publickeycredentialcreationoptions-authenticatorselection" id="ref-for-dom-publickeycredentialcreationoptions-authenticatorselection">authenticatorSelection</a></code>"]["<code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dom-authenticatorselectioncriteria-authenticatorattachment" id="ref-for-dom-authenticatorselectioncriteria-authenticatorattachment">authenticatorAttachment</a></code>"] is not "<code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dom-authenticatorattachment-platform" id="ref-for-dom-authenticatorattachment-platform">platform</a></code>".</p>
          <li data-md>
           <p><em>options</em>["<code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dom-publickeycredentialcreationoptions-authenticatorselection" id="ref-for-dom-publickeycredentialcreationoptions-authenticatorselection①">authenticatorSelection</a></code>"]["<code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dom-authenticatorselectioncriteria-residentkey" id="ref-for-dom-authenticatorselectioncriteria-residentkey">residentKey</a></code>"] is not "<code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dom-residentkeyrequirement-required" id="ref-for-dom-residentkeyrequirement-required">required</a></code>" or "<code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dom-residentkeyrequirement-preferred" id="ref-for-dom-residentkeyrequirement-preferred">preferred</a></code>".</p>
          <li data-md>
           <p><em>options</em>["<code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dom-publickeycredentialcreationoptions-authenticatorselection" id="ref-for-dom-publickeycredentialcreationoptions-authenticatorselection②">authenticatorSelection</a></code>"]["<code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dom-authenticatorselectioncriteria-userverification" id="ref-for-dom-authenticatorselectioncriteria-userverification">userVerification</a></code>"] is not "<code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dom-userverificationrequirement-required" id="ref-for-dom-userverificationrequirement-required①">required</a></code>".</p>
         </ul>
         <p>then return a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#exceptiondef-typeerror" id="ref-for-exceptiondef-typeerror⑨">TypeError</a></code>.</p>
         <p class="note" role="note"><span class="marker">Note:</span> These values are hard-coded as that is what Chrome’s initial implementation
supports. The current limitations may change. The Working Group invites implementers
to share use cases that would benefit from support for other values.</p>
         <details class="wpt-tests-block" dir="ltr" lang="en">
          <summary>Tests</summary>
          <ul class="wpt-tests-list">
           <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/secure-payment-confirmation/enrollment.https.html" title="secure-payment-confirmation/enrollment.https.html">enrollment.https.html</a> <a class="wpt-live" href="https://wpt.live/secure-payment-confirmation/enrollment.https.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/secure-payment-confirmation/enrollment.https.html"><small>(source)</small></a>
          </ul>
         </details>
       </ul>
     </ol>
    <dt data-md><dfn data-dfn-type="dfn" data-export id="client-extension-processing-authentication">Client extension processing (<a data-link-type="dfn" href="https://w3c.github.io/webauthn/#authentication-extension" id="ref-for-authentication-extension②">authentication</a>)<a class="self-link" href="#client-extension-processing-authentication"></a></dfn>
    <dd data-md>
     <p>When <a href="https://w3c.github.io/webauthn/#sctn-getAssertion">making an assertion</a> with a <code class="idl"><a data-link-type="idl" href="#dictdef-authenticationextensionspaymentinputs" id="ref-for-dictdef-authenticationextensionspaymentinputs②">AuthenticationExtensionsPaymentInputs</a></code> <var>extension_inputs</var>:</p>
     <ol>
      <li data-md>
       <p>If not in a "<a data-link-type="dfn" href="#secure-payment-confirmation" id="ref-for-secure-payment-confirmation④">secure-payment-confirmation</a>" payment handler, return a
"<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#notallowederror" id="ref-for-notallowederror①">NotAllowedError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException④">DOMException</a></code>.</p>
       <details class="wpt-tests-block" dir="ltr" lang="en">
        <summary>Tests</summary>
        <ul class="wpt-tests-list">
         <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/secure-payment-confirmation/authentication-cannot-bypass-spc.https.html" title="secure-payment-confirmation/authentication-cannot-bypass-spc.https.html">authentication-cannot-bypass-spc.https.html</a> <a class="wpt-live" href="https://wpt.live/secure-payment-confirmation/authentication-cannot-bypass-spc.https.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/secure-payment-confirmation/authentication-cannot-bypass-spc.https.html"><small>(source)</small></a>
        </ul>
       </details>
       <p class="note" role="note"><span class="marker">Note:</span> This guards against websites trying to access the extended powers of
SPC without going through <a href="#sctn-transaction-confirmation-ux">the
transaction UX</a>.</p>
      <li data-md>
       <p>During <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dom-publickeycredential-discoverfromexternalsource-slot" id="ref-for-dom-publickeycredential-discoverfromexternalsource-slot">[[DiscoverFromExternalSource]](origin, options, sameOriginWithAncestors)</a></code>:</p>
       <ol>
        <li data-md>
         <p>Skip step 6.1, which compares <em>options.rpId</em> to <em>effectiveDomain</em></p>
       </ol>
       <details class="wpt-tests-block" dir="ltr" lang="en">
        <summary>Tests</summary>
        <ul class="wpt-tests-list">
         <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/secure-payment-confirmation/authentication-cross-origin.sub.https.html" title="secure-payment-confirmation/authentication-cross-origin.sub.https.html">authentication-cross-origin.sub.https.html</a> <a class="wpt-live" href="https://wpt.live/secure-payment-confirmation/authentication-cross-origin.sub.https.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/secure-payment-confirmation/authentication-cross-origin.sub.https.html"><small>(source)</small></a>
        </ul>
       </details>
       <p class="note" role="note"><span class="marker">Note:</span> This enables cross-domain authentication ceremonies; see <a href="#sctn-use-case-merchant-authentication">§ 1.1.3 Merchant control of authentication</a>.</p>
       <ol>
        <li data-md>
         <p>In step 9, instead of creating a <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dictdef-collectedclientdata" id="ref-for-dictdef-collectedclientdata①">CollectedClientData</a></code>, instead
create a <code class="idl"><a data-link-type="idl" href="#dictdef-collectedclientpaymentdata" id="ref-for-dictdef-collectedclientpaymentdata①">CollectedClientPaymentData</a></code> with:</p>
         <ol>
          <li data-md>
           <p><code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dom-collectedclientdata-type" id="ref-for-dom-collectedclientdata-type">type</a></code> set to "<code>payment.get</code>"</p>
          <li data-md>
           <p><code class="idl"><a data-link-type="idl" href="#dom-collectedclientpaymentdata-payment" id="ref-for-dom-collectedclientpaymentdata-payment">payment</a></code> set to a new <code class="idl"><a data-link-type="idl" href="#dictdef-collectedclientadditionalpaymentdata" id="ref-for-dictdef-collectedclientadditionalpaymentdata">CollectedClientAdditionalPaymentData</a></code> whose fields are:</p>
           <dl>
            <dt data-md><code class="idl"><a data-link-type="idl" href="#dom-collectedclientadditionalpaymentdata-rpid" id="ref-for-dom-collectedclientadditionalpaymentdata-rpid">rpId</a></code>
            <dd data-md>
             <p><var>extension_inputs</var>["<code class="idl"><a data-link-type="idl" href="#dom-authenticationextensionspaymentinputs-rpid" id="ref-for-dom-authenticationextensionspaymentinputs-rpid②">rpId</a></code>"]</p>
            <dt data-md><code class="idl"><a data-link-type="idl" href="#dom-collectedclientadditionalpaymentdata-toporigin" id="ref-for-dom-collectedclientadditionalpaymentdata-toporigin">topOrigin</a></code>
            <dd data-md>
             <p><var>extension_inputs</var>["<code class="idl"><a data-link-type="idl" href="#dom-authenticationextensionspaymentinputs-toporigin" id="ref-for-dom-authenticationextensionspaymentinputs-toporigin②">topOrigin</a></code>"]</p>
            <dt data-md><code class="idl"><a data-link-type="idl" href="#dom-collectedclientadditionalpaymentdata-payeename" id="ref-for-dom-collectedclientadditionalpaymentdata-payeename①">payeeName</a></code>
            <dd data-md>
             <p><var>extension_inputs</var>["<code class="idl"><a data-link-type="idl" href="#dom-authenticationextensionspaymentinputs-payeename" id="ref-for-dom-authenticationextensionspaymentinputs-payeename②">payeeName</a></code>"]
if it is present, otherwise omitted.</p>
            <dt data-md><code class="idl"><a data-link-type="idl" href="#dom-collectedclientadditionalpaymentdata-payeeorigin" id="ref-for-dom-collectedclientadditionalpaymentdata-payeeorigin①">payeeOrigin</a></code>
            <dd data-md>
             <p><var>extension_inputs</var>["<code class="idl"><a data-link-type="idl" href="#dom-authenticationextensionspaymentinputs-payeeorigin" id="ref-for-dom-authenticationextensionspaymentinputs-payeeorigin②">payeeOrigin</a></code>"]
if it is present, otherwise omitted.</p>
            <dt data-md><code class="idl"><a data-link-type="idl" href="#dom-collectedclientadditionalpaymentdata-total" id="ref-for-dom-collectedclientadditionalpaymentdata-total①">total</a></code>
            <dd data-md>
             <p><var>extension_inputs</var>["<code class="idl"><a data-link-type="idl" href="#dom-authenticationextensionspaymentinputs-total" id="ref-for-dom-authenticationextensionspaymentinputs-total②">total</a></code>"]</p>
            <dt data-md><code class="idl"><a data-link-type="idl" href="#dom-collectedclientadditionalpaymentdata-instrument" id="ref-for-dom-collectedclientadditionalpaymentdata-instrument②">instrument</a></code>
            <dd data-md>
             <p><var>extension_inputs</var>["<code class="idl"><a data-link-type="idl" href="#dom-authenticationextensionspaymentinputs-instrument" id="ref-for-dom-authenticationextensionspaymentinputs-instrument②">instrument</a></code>"]</p>
           </dl>
          <li data-md>
           <p>All other fields set as per the original step 9.</p>
         </ol>
         <details class="wpt-tests-block" dir="ltr" lang="en">
          <summary>Tests</summary>
          <ul class="wpt-tests-list">
           <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/secure-payment-confirmation/authentication-accepted.https.html" title="secure-payment-confirmation/authentication-accepted.https.html">authentication-accepted.https.html</a> <a class="wpt-live" href="https://wpt.live/secure-payment-confirmation/authentication-accepted.https.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/secure-payment-confirmation/authentication-accepted.https.html"><small>(source)</small></a>
          </ul>
         </details>
       </ol>
     </ol>
    <dt data-md>Client extension output
    <dd data-md>
     <p>None</p>
    <dt data-md>Authenticator extension processing
    <dd data-md>
     <p>None</p>
   </dl>
   <h3 class="heading settled" data-level="5.1" id="sctn-collectedclientpaymentdata-dictionary"><span class="secno">5.1. </span><span class="content"><dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-collectedclientpaymentdata"><code>CollectedClientPaymentData</code></dfn> Dictionary</span><a class="self-link" href="#sctn-collectedclientpaymentdata-dictionary"></a></h3>
<pre class="idl highlight def"><c- b>dictionary</c-> <a class="idl-code" data-link-type="dictionary" href="#dictdef-collectedclientpaymentdata" id="ref-for-dictdef-collectedclientpaymentdata②"><c- g>CollectedClientPaymentData</c-></a> : <a data-link-type="idl-name" href="https://w3c.github.io/webauthn/#dictdef-collectedclientdata" id="ref-for-dictdef-collectedclientdata②"><c- n>CollectedClientData</c-></a> {
    <c- b>required</c-> <a data-link-type="idl-name" href="#dictdef-collectedclientadditionalpaymentdata" id="ref-for-dictdef-collectedclientadditionalpaymentdata①"><c- n>CollectedClientAdditionalPaymentData</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="CollectedClientAdditionalPaymentData " href="#dom-collectedclientpaymentdata-payment" id="ref-for-dom-collectedclientpaymentdata-payment①"><c- g>payment</c-></a>;
};
</pre>
   <p>The <code class="idl"><a data-link-type="idl" href="#dictdef-collectedclientpaymentdata" id="ref-for-dictdef-collectedclientpaymentdata③">CollectedClientPaymentData</a></code> dictionary inherits from <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dictdef-collectedclientdata" id="ref-for-dictdef-collectedclientdata③">CollectedClientData</a></code>. It contains the following additional field:</p>
   <dl>
    <dt data-md><dfn class="dfn-paneled idl-code" data-dfn-for="CollectedClientPaymentData" data-dfn-type="dict-member" data-export id="dom-collectedclientpaymentdata-payment"><code>payment</code></dfn> member, <span> of type <a data-link-type="idl-name" href="#dictdef-collectedclientadditionalpaymentdata" id="ref-for-dictdef-collectedclientadditionalpaymentdata②">CollectedClientAdditionalPaymentData</a></span>
    <dd data-md>
     <p>The additional payment information to sign.</p>
   </dl>
   <h3 class="heading settled" data-level="5.2" id="sctn-collectedclientadditionalpaymentdata-dictionary"><span class="secno">5.2. </span><span class="content"><dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-collectedclientadditionalpaymentdata"><code>CollectedClientAdditionalPaymentData</code></dfn> Dictionary</span><a class="self-link" href="#sctn-collectedclientadditionalpaymentdata-dictionary"></a></h3>
<pre class="idl highlight def"><c- b>dictionary</c-> <a class="idl-code" data-link-type="dictionary" href="#dictdef-collectedclientadditionalpaymentdata" id="ref-for-dictdef-collectedclientadditionalpaymentdata③"><c- g>CollectedClientAdditionalPaymentData</c-></a> {
    <c- b>required</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString" id="ref-for-idl-USVString①⑥"><c- b>USVString</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="USVString " href="#dom-collectedclientadditionalpaymentdata-rpid" id="ref-for-dom-collectedclientadditionalpaymentdata-rpid①"><c- g>rpId</c-></a>;
    <c- b>required</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString" id="ref-for-idl-USVString①⑦"><c- b>USVString</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="USVString " href="#dom-collectedclientadditionalpaymentdata-toporigin" id="ref-for-dom-collectedclientadditionalpaymentdata-toporigin①"><c- g>topOrigin</c-></a>;
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString" id="ref-for-idl-USVString①⑧"><c- b>USVString</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="USVString " href="#dom-collectedclientadditionalpaymentdata-payeename" id="ref-for-dom-collectedclientadditionalpaymentdata-payeename②"><c- g>payeeName</c-></a>;
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString" id="ref-for-idl-USVString①⑨"><c- b>USVString</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="USVString " href="#dom-collectedclientadditionalpaymentdata-payeeorigin" id="ref-for-dom-collectedclientadditionalpaymentdata-payeeorigin②"><c- g>payeeOrigin</c-></a>;
    <c- b>required</c-> <a data-link-type="idl-name" href="https://w3c.github.io/payment-request/#dom-paymentcurrencyamount" id="ref-for-dom-paymentcurrencyamount②"><c- n>PaymentCurrencyAmount</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="PaymentCurrencyAmount " href="#dom-collectedclientadditionalpaymentdata-total" id="ref-for-dom-collectedclientadditionalpaymentdata-total②"><c- g>total</c-></a>;
    <c- b>required</c-> <a data-link-type="idl-name" href="#dictdef-paymentcredentialinstrument" id="ref-for-dictdef-paymentcredentialinstrument④"><c- n>PaymentCredentialInstrument</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="PaymentCredentialInstrument " href="#dom-collectedclientadditionalpaymentdata-instrument" id="ref-for-dom-collectedclientadditionalpaymentdata-instrument③"><c- g>instrument</c-></a>;
};
</pre>
   <p>The <code class="idl"><a data-link-type="idl" href="#dictdef-collectedclientadditionalpaymentdata" id="ref-for-dictdef-collectedclientadditionalpaymentdata④">CollectedClientAdditionalPaymentData</a></code> dictionary contains the following
fields:</p>
   <dl>
    <dt data-md><dfn class="dfn-paneled idl-code" data-dfn-for="CollectedClientAdditionalPaymentData" data-dfn-type="dict-member" data-export id="dom-collectedclientadditionalpaymentdata-rpid"><code>rpId</code></dfn> member, <span> of type <a data-link-type="idl-name" href="https://webidl.spec.whatwg.org/#idl-USVString" id="ref-for-idl-USVString②⓪">USVString</a></span>
    <dd data-md>
     <p>The id of the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party①⑨">Relying Party</a> that created the credential.</p>
     <p class="note" role="note"><span class="marker">NOTE:</span> For historical reasons, some implementations may additionally
         include this parameter with the name <code>rp</code>. The values of <code>rp</code> and <code>rpId</code> must be the same if both are present.</p>
    <dt data-md><dfn class="dfn-paneled idl-code" data-dfn-for="CollectedClientAdditionalPaymentData" data-dfn-type="dict-member" data-export id="dom-collectedclientadditionalpaymentdata-toporigin"><code>topOrigin</code></dfn> member, <span> of type <a data-link-type="idl-name" href="https://webidl.spec.whatwg.org/#idl-USVString" id="ref-for-idl-USVString②①">USVString</a></span>
    <dd data-md>
     <p>The origin of the top level context that requested to sign the transaction details.</p>
    <dt data-md><dfn class="dfn-paneled idl-code" data-dfn-for="CollectedClientAdditionalPaymentData" data-dfn-type="dict-member" data-export id="dom-collectedclientadditionalpaymentdata-payeename"><code>payeeName</code></dfn> member, <span> of type <a data-link-type="idl-name" href="https://webidl.spec.whatwg.org/#idl-USVString" id="ref-for-idl-USVString②②">USVString</a></span>
    <dd data-md>
     <p>The name of the payee, if present, that was displayed to the user.</p>
    <dt data-md><dfn class="dfn-paneled idl-code" data-dfn-for="CollectedClientAdditionalPaymentData" data-dfn-type="dict-member" data-export id="dom-collectedclientadditionalpaymentdata-payeeorigin"><code>payeeOrigin</code></dfn> member, <span> of type <a data-link-type="idl-name" href="https://webidl.spec.whatwg.org/#idl-USVString" id="ref-for-idl-USVString②③">USVString</a></span>
    <dd data-md>
     <p>The origin of the payee, if present, that was displayed to the user.</p>
    <dt data-md><dfn class="dfn-paneled idl-code" data-dfn-for="CollectedClientAdditionalPaymentData" data-dfn-type="dict-member" data-export id="dom-collectedclientadditionalpaymentdata-total"><code>total</code></dfn> member, <span> of type <a data-link-type="idl-name" href="https://w3c.github.io/payment-request/#dom-paymentcurrencyamount" id="ref-for-dom-paymentcurrencyamount③">PaymentCurrencyAmount</a></span>
    <dd data-md>
     <p>The <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/payment-request/#dom-paymentcurrencyamount" id="ref-for-dom-paymentcurrencyamount④">PaymentCurrencyAmount</a></code> of the <a data-link-type="biblio" href="#biblio-payment-request" title="Payment Request API">[payment-request]</a> <code>total</code> field.</p>
    <dt data-md><dfn class="dfn-paneled idl-code" data-dfn-for="CollectedClientAdditionalPaymentData" data-dfn-type="dict-member" data-export id="dom-collectedclientadditionalpaymentdata-instrument"><code>instrument</code></dfn> member, <span> of type <a data-link-type="idl-name" href="#dictdef-paymentcredentialinstrument" id="ref-for-dictdef-paymentcredentialinstrument⑤">PaymentCredentialInstrument</a></span>
    <dd data-md>
     <p>The instrument information that was displayed to the user.</p>
   </dl>
   <p>Note that there is no <code>paymentRequestOrigin</code> field in <code class="idl"><a data-link-type="idl" href="#dictdef-collectedclientadditionalpaymentdata" id="ref-for-dictdef-collectedclientadditionalpaymentdata⑤">CollectedClientAdditionalPaymentData</a></code>, because the origin of the calling
frame is already included in <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dictdef-collectedclientdata" id="ref-for-dictdef-collectedclientdata④">CollectedClientData</a></code> of <a data-link-type="biblio" href="#biblio-webauthn-3" title="Web Authentication: An API for accessing Public Key Credentials - Level 3">[webauthn-3]</a>.</p>
   <h2 class="heading settled" data-level="6" id="sctn-common-data-structures"><span class="secno">6. </span><span class="content">Common Data Structures</span><a class="self-link" href="#sctn-common-data-structures"></a></h2>
   <p>The following data structures are shared between registration and authentication.</p>
   <h3 class="heading settled" data-level="6.1" id="sctn-paymentcredentialinstrument-dictionary"><span class="secno">6.1. </span><span class="content"><dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-paymentcredentialinstrument"><code>PaymentCredentialInstrument</code></dfn> Dictionary</span><a class="self-link" href="#sctn-paymentcredentialinstrument-dictionary"></a></h3>
<pre class="idl highlight def"><c- b>dictionary</c-> <a class="idl-code" data-link-type="dictionary" href="#dictdef-paymentcredentialinstrument" id="ref-for-dictdef-paymentcredentialinstrument⑥"><c- g>PaymentCredentialInstrument</c-></a> {
    <c- b>required</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString" id="ref-for-idl-USVString②④"><c- b>USVString</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="USVString " href="#dom-paymentcredentialinstrument-displayname" id="ref-for-dom-paymentcredentialinstrument-displayname②"><c- g>displayName</c-></a>;
    <c- b>required</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString" id="ref-for-idl-USVString②⑤"><c- b>USVString</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="USVString " href="#dom-paymentcredentialinstrument-icon" id="ref-for-dom-paymentcredentialinstrument-icon⑥"><c- g>icon</c-></a>;
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean" id="ref-for-idl-boolean⑤"><c- b>boolean</c-></a> <a class="idl-code" data-default="true" data-link-type="dict-member" data-type="boolean " href="#dom-paymentcredentialinstrument-iconmustbeshown" id="ref-for-dom-paymentcredentialinstrument-iconmustbeshown②"><c- g>iconMustBeShown</c-></a> = <c- b>true</c->;
};
</pre>
   <p>The <code class="idl"><a data-link-type="idl" href="#dictdef-paymentcredentialinstrument" id="ref-for-dictdef-paymentcredentialinstrument⑦">PaymentCredentialInstrument</a></code> dictionary contains the information to be
displayed to the user and signed together with the transaction details. It
contains the following members:</p>
   <dl>
    <dt data-md><dfn class="dfn-paneled idl-code" data-dfn-for="PaymentCredentialInstrument" data-dfn-type="dict-member" data-export id="dom-paymentcredentialinstrument-displayname"><code>displayName</code></dfn> member, <span> of type <a data-link-type="idl-name" href="https://webidl.spec.whatwg.org/#idl-USVString" id="ref-for-idl-USVString②⑥">USVString</a></span>
    <dd data-md>
     <p>The name of the payment instrument to be displayed to the user.</p>
     <p class="note" role="note"><span class="marker">NOTE:</span> See <a href="#sctn-i18n-considerations">§ 13 Internationalization Considerations</a> for discussion about
 internationalization of the <code class="idl"><a data-link-type="idl" href="#dom-paymentcredentialinstrument-displayname" id="ref-for-dom-paymentcredentialinstrument-displayname③">displayName</a></code>.</p>
    <dt data-md><dfn class="dfn-paneled idl-code" data-dfn-for="PaymentCredentialInstrument" data-dfn-type="dict-member" data-export id="dom-paymentcredentialinstrument-icon"><code>icon</code></dfn> member, <span> of type <a data-link-type="idl-name" href="https://webidl.spec.whatwg.org/#idl-USVString" id="ref-for-idl-USVString②⑦">USVString</a></span>
    <dd data-md>
     <p>The URL of the icon of the payment instrument.</p>
     <p class="note" role="note"><span class="marker">NOTE:</span> The <code class="idl"><a data-link-type="idl" href="#dom-paymentcredentialinstrument-icon" id="ref-for-dom-paymentcredentialinstrument-icon⑦">icon</a></code> URL may either identify
 an image on an internet-accessible server (e.g., <code>https://bank.com/card.png</code>),
 or directly encode the icon data via a Data URL <a data-link-type="biblio" href="#biblio-rfc2397" title="The &quot;data&quot; URL scheme">[RFC2397]</a>. Between
 the two types of URLs, Data URLs offer several benefits to the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party②⓪">Relying Party</a>. They can improve reliability (e.g., in the case that
 the icon hosting server may be unavailable). They can also enhance
 validation because the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party②①">Relying Party</a> has cryptographic evidence of
 what the browser displayed to the user: the icon URL is signed as part
 of the <code class="idl"><a data-link-type="idl" href="#dictdef-collectedclientadditionalpaymentdata" id="ref-for-dictdef-collectedclientadditionalpaymentdata⑥">CollectedClientAdditionalPaymentData</a></code> structure.</p>
     <p class="note" role="note"><span class="marker">NOTE:</span> See related <a href="#sctn-accessibility-considerations">accessibility considerations</a>.</p>
    <dt data-md><dfn class="dfn-paneled idl-code" data-dfn-for="PaymentCredentialInstrument" data-dfn-type="dict-member" data-export id="dom-paymentcredentialinstrument-iconmustbeshown"><code>iconMustBeShown</code></dfn> member, <span> of type <a data-link-type="idl-name" href="https://webidl.spec.whatwg.org/#idl-boolean" id="ref-for-idl-boolean⑥">boolean</a>, defaulting to <code>true</code></span>
    <dd data-md>
     <p>Indicates whether the specified icon must be successfully fetched and shown for the
request to succeed.</p>
   </dl>
   <h2 class="heading settled" data-level="7" id="sctn-permissions-policy"><span class="secno">7. </span><span class="content">Permissions Policy integration</span><a class="self-link" href="#sctn-permissions-policy"></a></h2>
   <p>This specification uses the "<a data-link-type="dfn" href="https://w3c.github.io/payment-request/#dfn-payment" id="ref-for-dfn-payment①">payment</a>"
policy-identifier string from <a data-link-type="biblio" href="#biblio-payment-request" title="Payment Request API">[payment-request]</a> to control access to <strong>both</strong> registration and authentication. This extends the <a href="https://w3c.github.io/webauthn/#sctn-permissions-policy">WebAuthn Permission Policy</a>.</p>
   <details class="wpt-tests-block" dir="ltr" lang="en">
    <summary>Tests</summary>
    <ul class="wpt-tests-list">
     <li class="wpt-test"><a class="wpt-name" href="https://wpt.fyi/results/secure-payment-confirmation/enrollment-in-iframe.sub.https.html" title="secure-payment-confirmation/enrollment-in-iframe.sub.https.html">enrollment-in-iframe.sub.https.html</a> <a class="wpt-live" href="https://wpt.live/secure-payment-confirmation/enrollment-in-iframe.sub.https.html"><small>(live test)</small></a> <a class="wpt-source" href="https://github.com/web-platform-tests/wpt/blob/master/secure-payment-confirmation/enrollment-in-iframe.sub.https.html"><small>(source)</small></a>
    </ul>
   </details>
   <p class="note" role="note"><span class="marker">Note:</span> Algorithms specified in <a data-link-type="biblio" href="#biblio-credential-management-1" title="Credential Management Level 1">[CREDENTIAL-MANAGEMENT-1]</a> perform the actual
permissions policy evaluation. This is because such policy evaluation needs to
occur when there is access to the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#current-settings-object" id="ref-for-current-settings-object">current settings object</a>. The <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dom-publickeycredential-create-slot" id="ref-for-dom-publickeycredential-create-slot">[[Create]](origin, options, sameOriginWithAncestors)</a></code> and <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dom-publickeycredential-discoverfromexternalsource-slot" id="ref-for-dom-publickeycredential-discoverfromexternalsource-slot①">[[DiscoverFromExternalSource]](origin, options,
sameOriginWithAncestors)</a></code> <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-object-internal-methods-and-internal-slots" id="ref-for-sec-object-internal-methods-and-internal-slots">internal methods</a> do not have such access since
they are invoked <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel">in parallel</a> (by algorithms specified in <a data-link-type="biblio" href="#biblio-credential-management-1" title="Credential Management Level 1">[CREDENTIAL-MANAGEMENT-1]</a>).</p>
   <h2 class="heading settled" data-level="8" id="sctn-relying-party-operations"><span class="secno">8. </span><span class="content">SPC Relying Party Operations</span><a class="self-link" href="#sctn-relying-party-operations"></a></h2>
   <h3 class="heading settled" data-level="8.1" id="sctn-verifying-assertion"><span class="secno">8.1. </span><span class="content">Verifying an Authentication Assertion</span><a class="self-link" href="#sctn-verifying-assertion"></a></h3>
   <p>In order to perform an <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#authentication-ceremony" id="ref-for-authentication-ceremony①">authentication ceremony</a> for Secure Payment
Confirmation, the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party②②">Relying Party</a> MUST proceed as follows:</p>
   <ol>
    <li data-md>
     <p>Let <var>credential</var> be a <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#publickeycredential" id="ref-for-publickeycredential">PublicKeyCredential</a></code> returned from a successful
invocation of the <a data-link-type="dfn" href="#secure-payment-confirmation-payment-handler" id="ref-for-secure-payment-confirmation-payment-handler②">Secure Payment Confirmation payment handler</a> by the <var>SPC caller</var>.</p>
     <p class="note" role="note"><span class="marker">Note:</span> As SPC is designed to enable <a href="#sctn-use-case-merchant-authentication">merchant
control of authentication</a>, the entity that invokes SPC may not be the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party②③">Relying Party</a>. This first step presumes that the SPC caller has returned
a credential obtained via SPC to the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party②④">Relying Party</a>.</p>
    <li data-md>
     <p>Perform steps 3-21 <a href="https://w3c.github.io/webauthn/#sctn-verifying-assertion"> as specified in
WebAuthn</a>, with the following changes:</p>
     <ol>
      <li data-md>
       <p>In step 5, verify that <var>credential</var>.<code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webappsec-credential-management/#dom-credential-id" id="ref-for-dom-credential-id">id</a></code> identifies one of
the public key credentials provided to the <var>SPC caller</var> by the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party②⑤">Relying Party</a>.</p>
      <li data-md>
       <p>In step 11, verify that the value of <var>C</var>["<code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dom-collectedclientdata-type" id="ref-for-dom-collectedclientdata-type①">type</a></code>"]
is the string <code>payment.get</code>.</p>
      <li data-md>
       <p>In step 12, verify that the value of <var>C</var>["<code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dom-collectedclientdata-challenge" id="ref-for-dom-collectedclientdata-challenge">challenge</a></code>"]
equals the base64url encoding of the challenge provided to the <var>SPC caller</var> by the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party②⑥">Relying Party</a>.</p>
      <li data-md>
       <p>In step 13, verify that the value of <var>C</var>["<code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dom-collectedclientdata-origin" id="ref-for-dom-collectedclientdata-origin">origin</a></code>"]
matches the origin that the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party②⑦">Relying Party</a> expects SPC to have been
called from.</p>
      <li data-md>
       <p>After step 13, insert the following steps:</p>
       <ul>
        <li data-md>
         <p>Verify that the value of <var>C</var>["<code class="idl"><a data-link-type="idl" href="#dom-collectedclientpaymentdata-payment" id="ref-for-dom-collectedclientpaymentdata-payment②">payment</a></code>"]["<code class="idl"><a data-link-type="idl" href="#dom-collectedclientadditionalpaymentdata-rpid" id="ref-for-dom-collectedclientadditionalpaymentdata-rpid②">rpId</a></code>"]
matches the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party②⑧">Relying Party</a>'s origin.</p>
        <li data-md>
         <p>Verify that the value of <var>C</var>["<code class="idl"><a data-link-type="idl" href="#dom-collectedclientpaymentdata-payment" id="ref-for-dom-collectedclientpaymentdata-payment③">payment</a></code>"]["<code class="idl"><a data-link-type="idl" href="#dom-collectedclientadditionalpaymentdata-toporigin" id="ref-for-dom-collectedclientadditionalpaymentdata-toporigin②">topOrigin</a></code>"]
matches the top-level origin that the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party②⑨">Relying Party</a> expects.</p>
        <li data-md>
         <p>Verify that the value of <var>C</var>["<code class="idl"><a data-link-type="idl" href="#dom-collectedclientpaymentdata-payment" id="ref-for-dom-collectedclientpaymentdata-payment④">payment</a></code>"]["<code class="idl"><a data-link-type="idl" href="#dom-collectedclientadditionalpaymentdata-payeename" id="ref-for-dom-collectedclientadditionalpaymentdata-payeename③">payeeName</a></code>"]
matches the name of the payee that should have been displayed to the user, if any.</p>
        <li data-md>
         <p>Verify that the value of <var>C</var>["<code class="idl"><a data-link-type="idl" href="#dom-collectedclientpaymentdata-payment" id="ref-for-dom-collectedclientpaymentdata-payment⑤">payment</a></code>"]["<code class="idl"><a data-link-type="idl" href="#dom-collectedclientadditionalpaymentdata-payeeorigin" id="ref-for-dom-collectedclientadditionalpaymentdata-payeeorigin③">payeeOrigin</a></code>"]
matches the origin of the payee that should have been displayed to the user, if any.</p>
        <li data-md>
         <p>Verify that the value of <var>C</var>["<code class="idl"><a data-link-type="idl" href="#dom-collectedclientpaymentdata-payment" id="ref-for-dom-collectedclientpaymentdata-payment⑥">payment</a></code>"]["<code class="idl"><a data-link-type="idl" href="#dom-collectedclientadditionalpaymentdata-total" id="ref-for-dom-collectedclientadditionalpaymentdata-total③">total</a></code>"]
matches the transaction amount that should have been displayed to the user.</p>
        <li data-md>
         <p>Verify that the value of <var>C</var>["<code class="idl"><a data-link-type="idl" href="#dom-collectedclientpaymentdata-payment" id="ref-for-dom-collectedclientpaymentdata-payment⑦">payment</a></code>"]["<code class="idl"><a data-link-type="idl" href="#dom-collectedclientadditionalpaymentdata-instrument" id="ref-for-dom-collectedclientadditionalpaymentdata-instrument④">instrument</a></code>"]
matches the payment instrument details that should have been displayed to the user.</p>
       </ul>
     </ol>
   </ol>
   <h2 class="heading settled" data-level="9" id="sctn-automation"><span class="secno">9. </span><span class="content">User Agent Automation</span><a class="self-link" href="#sctn-automation"></a></h2>
   <p>For the purposes of user agent automation and website testing, this document
defines the below <a data-link-type="biblio" href="#biblio-webdriver2" title="WebDriver">[WebDriver2]</a> <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-extension-commands" id="ref-for-dfn-extension-commands">extension commands</a>. Interested parties
should also consult the <a href="https://w3c.github.io/webauthn/#sctn-automation">equivalent automation
section</a> in <a data-link-type="biblio" href="#biblio-webauthn-3" title="Web Authentication: An API for accessing Public Key Credentials - Level 3">[webauthn-3]</a>.</p>
   <h3 class="heading settled" data-level="9.1" id="sctn-automation-set-spc-transaction-mode"><span class="secno">9.1. </span><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="set-spc-transaction-mode">Set SPC Transaction Mode</dfn></span><a class="self-link" href="#sctn-automation-set-spc-transaction-mode"></a></h3>
   <p>The <a data-link-type="dfn" href="#set-spc-transaction-mode" id="ref-for-set-spc-transaction-mode">Set SPC Transaction Mode</a> WebDriver <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-extension-commands" id="ref-for-dfn-extension-commands①">extension command</a> instructs the
user agent to place Secure Payment Confirmation into a mode where it will
automatically simulate a user either accepting or rejecting the <a href="#sctn-transaction-confirmation-ux">transaction confirmation UX</a>.</p>
   <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="current-transaction-automation-mode">current transaction automation mode</dfn> tracks what automation mode
is currently active for SPC. It defaults to "<code>none</code>".</p>
   <figure class="table" id="table-setSPCTransactionMode">
    <table class="data">
     <thead>
      <tr>
       <th>HTTP Method
       <th>URI Template
     <tbody>
      <tr>
       <td>POST
       <td><code>/session/{session id}/secure-payment-confirmation/set-mode</code>
    </table>
   </figure>
   <p>The <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-remote-end-steps" id="ref-for-dfn-remote-end-steps">remote end steps</a> are:</p>
   <ol>
    <li data-md>
     <p>If <var>parameters</var> is not a JSON <a href="https://tc39.es/ecma262/multipage/structured-data.html#sec-json-object">Object</a>, return a <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-error" id="ref-for-dfn-error">WebDriver error</a> with <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-error-code" id="ref-for-dfn-error-code">WebDriver error code</a> <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-invalid-argument" id="ref-for-dfn-invalid-argument">invalid argument</a>.</p>
    <li data-md>
     <p>Let <var>mode</var> be the result of <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-getting-properties" id="ref-for-dfn-getting-properties">getting a property</a> named <code>"mode"</code> from <var>parameters</var>.</p>
    <li data-md>
     <p>If <var>mode</var> is <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-undefined" id="ref-for-dfn-undefined">undefined</a> or is not one of "<code>autoAccept</code>", "<code>autoReject</code>",
or "<code>autoOptOut</code>", return a <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-error" id="ref-for-dfn-error①">WebDriver error</a> with <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-error-code" id="ref-for-dfn-error-code①">WebDriver error
code</a> <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-invalid-argument" id="ref-for-dfn-invalid-argument①">invalid argument</a>.</p>
    <li data-md>
     <p>Set the <a data-link-type="dfn" href="#current-transaction-automation-mode" id="ref-for-current-transaction-automation-mode②">current transaction automation mode</a> to <var>mode</var>.</p>
    <li data-md>
     <p>Return <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-success" id="ref-for-dfn-success">success</a> with data <code>null</code>.</p>
   </ol>
   <h2 class="heading settled" data-level="10" id="sctn-security-considerations"><span class="secno">10. </span><span class="content">Security Considerations</span><a class="self-link" href="#sctn-security-considerations"></a></h2>
   <p>As this specification builds on top of WebAuthn, the <a href="https://w3c.github.io/webauthn/#sctn-security-considerations">WebAuthn Security Considerations</a> are applicable. The below subsections comprise the current Secure Payment
Confirmation-specific security considerations, where this specification
diverges from WebAuthn.</p>
   <h3 class="heading settled" data-level="10.1" id="sctn-security-cross-origin-auth"><span class="secno">10.1. </span><span class="content">Cross-origin authentication ceremony</span><a class="self-link" href="#sctn-security-cross-origin-auth"></a></h3>
   <p>A significant departure that Secure Payment Confirmation makes from WebAuthn is
in allowing a third-party to initiate an authentication ceremony using
credentials for a different <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party③⓪">Relying Party</a>, and returning the assertion to
the third party. This feature can expose <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party③①">Relying Parties</a> to both login and
payment attacks, which are discussed here.</p>
   <h4 class="heading settled" data-level="10.1.1" id="sctn-security-login-attack"><span class="secno">10.1.1. </span><span class="content">Login Attack</span><a class="self-link" href="#sctn-security-login-attack"></a></h4>
   <p>As credentials created for Secure Payment Confirmation are valid WebAuthn
credentials, it is possible that a <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party③②">Relying Party</a> may wish to use the same
credential for a given user for both login and payment. This allows a potential
attack on the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party③③">Relying Party’s</a> login system, if they do not carefully verify
the assertion they receive.</p>
   <p>The attack is as follows:</p>
   <ol>
    <li data-md>
     <p>The user visits <code>attacker.com</code>, which is or pretends to be a merchant site.</p>
    <li data-md>
     <p><code>attacker.com</code> obtains credentials for the user from <code>relyingparty.com</code>,
 either legitimately or by stealing them from <code>relyingparty.com</code> or another
 party with whom <code>relyingparty.com</code> had shared the credentials.</p>
    <li data-md>
     <p><code>attacker.com</code> initiates SPC authentication, and the user agrees to the
 transaction (which may or may not be legitimate).</p>
    <li data-md>
     <p><code>attacker.com</code> takes the payment assertion that they received from the API
 call, and sends it to the login endpoint for <code>relyingparty.com</code>, e.g. by
 sending a POST to <code>https://relyingparty.com/login</code>.</p>
    <li data-md>
     <p><code>relyingparty.com</code> is employing faulty assertion validation code, which
 checks the signature but fails to validate the necessary fields (see
 below), and believes the login attempt to be legitimate.</p>
    <li data-md>
     <p><code>relyingparty.com</code> returns e.g. a login cookie to <code>attacker.com</code>. The user’s
 account at <code>relyingparty.com</code> has now been compromised.</p>
   </ol>
   <p><a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party③④">Relying Parties</a> can guard against this attack in two ways.</p>
   <p>Firstly, a <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party③⑤">Relying Party</a> must always follow the correct assertion
validation steps either for <a href="https://w3c.github.io/webauthn/#sctn-verifying-assertion">WebAuthn
login</a> or <a href="#sctn-verifying-assertion">SPC payment</a> as appropriate. In
particular, the following fields can all be used to detect an inappropriate use
of a credential:</p>
   <ul>
    <li data-md>
     <p><code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dictdef-collectedclientdata" id="ref-for-dictdef-collectedclientdata⑤">CollectedClientData</a></code>["<code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dom-collectedclientdata-type" id="ref-for-dom-collectedclientdata-type②">type</a></code>"]- "webauthn.get" for
login, "payment.get" for SPC.</p>
    <li data-md>
     <p><code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dictdef-collectedclientdata" id="ref-for-dictdef-collectedclientdata⑥">CollectedClientData</a></code>["<code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dom-collectedclientdata-challenge" id="ref-for-dom-collectedclientdata-challenge①">challenge</a></code>"] - this value should
be provided by the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party③⑥">Relying Party</a> server to the site ahead of any call
to either WebAuthn or SPC, and should be verified as matching an expected,
appropriate, previously-provided value.</p>
    <li data-md>
     <p><code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dictdef-collectedclientdata" id="ref-for-dictdef-collectedclientdata⑦">CollectedClientData</a></code>["<code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dom-collectedclientdata-origin" id="ref-for-dom-collectedclientdata-origin①">origin</a></code>"] - if SPC is being
performed cross-origin, this value will contain the origin of the caller
(e.g. <code>attacker.com</code> in the above example).</p>
   </ul>
   <p>Secondly, a <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party③⑦">Relying Party</a> can consider keeping their payment and login
credentials separate. If doing this, the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party③⑧">Relying Party</a> should only register
credentials for Secure Payment Confirmation on a subdomain (e.g. <code>https//payment.relyingparty.com</code>), and should keep payment credentials and
login credentials separate in their database.</p>
   <div class="note" role="note">
     NOTE: As currently written, the Secure Payment Confirmation specification
      allows any WebAuthn credential to be used in an SPC authentication.
      However this is not true in implementations today, which only allow
      credentials created with the <code class="idl"><a data-link-type="idl" href="#dom-authenticationextensionsclientinputs-payment" id="ref-for-dom-authenticationextensionsclientinputs-payment②">payment</a></code> extension specified to participate in SPC authentication, and the
      specification may be updated to reflect that in the future. 
    <p>In both implementation and specification today, a credential created
      with the <code class="idl"><a data-link-type="idl" href="#dom-authenticationextensionsclientinputs-payment" id="ref-for-dom-authenticationextensionsclientinputs-payment③">payment</a></code> can be used
      for login, if the Relying Party wishes. This is not expected to change.</p>
   </div>
   <h4 class="heading settled" data-level="10.1.2" id="sctn-security-payment-attack"><span class="secno">10.1.2. </span><span class="content">Payment Attack</span><a class="self-link" href="#sctn-security-payment-attack"></a></h4>
   <p>A Secure Payment Confirmation assertion is essentially useless unless
it is part of an ongoing online transaction.</p>
   <p>A variety of mechanisms protect against an attack where a malicious
third-party, instead of attempting to hijack a user account, initiates
an unauthorized payment using Secure Payment Confirmation credentials
(obtained either legitimately or otherwise):</p>
   <ul>
    <li data-md>
     <p>When the attacker initiates SPC, the user will be shown UI by the
User Agent that clearly states the transaction details (including the payee
and amount). The user is very likely to "cancel" in this scenario.</p>
    <li data-md>
     <p>If the user does agree to the transaction, and completes the subsequent
WebAuthn authentication ceremony, the attacker now has a signed SPC
assertion for the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party③⑨">Relying Party</a>.</p>
    <li data-md>
     <p>If the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party④⓪">Relying Party</a> is not expecting a transaction, it will reject the
assertion.</p>
    <li data-md>
     <p>If the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party④①">Relying Party</a> is expecting a transaction, it will detect at least
one of the following and reject the assertion:</p>
     <ul>
      <li data-md>
       <p>An incorrect <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dictdef-collectedclientdata" id="ref-for-dictdef-collectedclientdata⑧">CollectedClientData</a></code>["<code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dom-collectedclientdata-challenge" id="ref-for-dom-collectedclientdata-challenge②">challenge</a></code>"],
if an attacker attempts to race against a valid ongoing payment.</p>
      <li data-md>
       <p>An incorrect <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dictdef-collectedclientdata" id="ref-for-dictdef-collectedclientdata⑨">CollectedClientData</a></code>["<code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dom-collectedclientdata-origin" id="ref-for-dom-collectedclientdata-origin②">origin</a></code>"],
if an attacker attempts to sit between the user and a valid merchant
site and forward the assertion.</p>
     </ul>
   </ul>
   <h3 class="heading settled" data-level="10.2" id="sctn-security-merchant-data"><span class="secno">10.2. </span><span class="content">Merchant-supplied authentication data</span><a class="self-link" href="#sctn-security-merchant-data"></a></h3>
   <p>The bank can and should protect against spoofing by <a href="#sctn-verifying-assertion">verifying the authentication assertion</a> they receive to
ensure it aligns with the transaction details provided by the
merchant.</p>
   <p>That is because a consequence of this specification’s third-party
authentication ceremony is that even in a valid transaction (i.e. one
that the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party④②">Relying Party</a> is expecting), a third-party provides the
transaction details that are shown to the user:</p>
   <ul>
    <li data-md>
     <p>Transaction amount and currency</p>
    <li data-md>
     <p>Payment instrument name and icon</p>
    <li data-md>
     <p>Payee name and origin</p>
   </ul>
   <p>This could lead to a spoofing attack, in which a merchant presents incorrect
data to the user. For example, the merchant could tell the bank (in the
backend) that it is initiating a purchase of $100, but then pass $1 to the SPC
API (and thus show the user a $1 transaction to verify). Or the merchant
could provide the correct transaction details but pass Secure Payment
Confirmation credentials that don’t match what the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party④③">Relying Party</a> expects.</p>
   <p>Secure Payment Confirmation actually makes defeating this kind of attack easier
than it currently is on the web. In online payments today, the bank has to
trust that the merchant showed the user the correct amount in their checkout
flow (and any fraud discoveries are post-payment, when the user checks their
account statement).</p>
   <h3 class="heading settled" data-level="10.3" id="sctn-security-user-activation-requirement"><span class="secno">10.3. </span><span class="content">Lack of user activation requirement</span><a class="self-link" href="#sctn-security-user-activation-requirement"></a></h3>
   <p>If the user agent does not require user activation, as outlined in <a href="#sctn-modify-user-activation-requirement">§ 4.1.4 Modification of user activation requirement</a>, some additional security
mitigations should be considered. Not requiring user activation increases the
risk of spam and click-jacking attacks, by allowing a Secure Payment
Confirmation flow to be initiated without the user interacting with the page
immediately beforehand.</p>
   <p>In order to mitigate spam, the user agent may decide to enforce a user
activation requirement after some threshold, for example after the user has
already been shown a Secure Payment Confirmation flow without a user activation
on the current page. In order to mitigate click-jacking attacks, the user agent
may implement a time threshold in which clicks are ignored immediately after a
dialog is shown.</p>
   <p>Another relevant mitigation exists in <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/payment-request/#dom-paymentrequest-show" id="ref-for-dom-paymentrequest-show④">PaymentRequest.show()</a></code>: the Payment Request API
requires the document to be visible, and thus SPC cannot be triggered from a
background tab, minimized window, or other similar hidden situations.</p>
   <h2 class="heading settled" data-level="11" id="sctn-privacy-considerations"><span class="secno">11. </span><span class="content">Privacy Considerations</span><a class="self-link" href="#sctn-privacy-considerations"></a></h2>
   <p>As this specification builds on top of WebAuthn, the <a href="https://w3c.github.io/webauthn/#sctn-privacy-considerations">WebAuthn Privacy Considerations</a> are
applicable. The below subsections comprise the current Secure Payment
Confirmation-specific privacy considerations, where this specification diverges
from WebAuthn.</p>
   <h3 class="heading settled" data-level="11.1" id="sctn-security-cross-origin-registration"><span class="secno">11.1. </span><span class="content">Registration in a Cross-Origin iframe</span><a class="self-link" href="#sctn-security-cross-origin-registration"></a></h3>
   <p>Unlike WebAuthn, this specification allows the creation of credentials in a
cross-origin iframe (as long as the appropriate <a href="#sctn-permissions-policy">Permission Policy</a> is set on the iframe). That is,
if site A embeds an iframe from site B, with the "<a data-link-type="dfn" href="https://w3c.github.io/payment-request/#dfn-payment" id="ref-for-dfn-payment②">payment</a>" policy set, then site B may initiate a credential creation
for site B within that iframe.</p>
   <p class="note" role="note"><span class="marker">NOTE:</span> Allowing credential creation in cross-origin iframes is currently <a href="https://github.com/w3c/webauthn/issues/1656">under
      discussion</a> in the WebAuthn
      Working Group, and thus may move from this specification to WebAuthn in
      the future.</p>
   <p>Allowing credential creation in a cross-origin iframe presents a risk that an
iframe may attempt to trick a user into registering a credential. That
credential could then be used for tracking (see <a href="https://github.com/w3c/webauthn/issues/1656">WebAuthn issue
1656</a>). To mitigate such an
attack, this specification requires that a call to <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webappsec-credential-management/#dom-credentialscontainer-create" id="ref-for-dom-credentialscontainer-create②">navigator.credentials.create()</a></code> inside a
cross-origin iframe may only be invoked when the iframe has <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/interaction.html#transient-activation" id="ref-for-transient-activation③">transient
activation</a> (e.g., via a click or press from the user).</p>
   <p class="note" role="note"><span class="marker">NOTE:</span> Requiring user activation for WebAuthn APIs in general is under discussion
      in the WebAuthn WG too; see <a href="https://github.com/w3c/webauthn/issues/1293">issue #1293</a>.</p>
   <h3 class="heading settled" data-level="11.2" id="sctn-privacy-probing-credential-ids"><span class="secno">11.2. </span><span class="content">Probing for credential ids</span><a class="self-link" href="#sctn-privacy-probing-credential-ids"></a></h3>
   <p>As per WebAuthn’s section on <a href="https://w3c.github.io/webauthn/#sctn-assertion-privacy">Authentication
Ceremony Privacy</a>, implementors of Secure Payment Confirmation must make sure
not to enable malicious callers (who now may not even be the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party④④">Relying Party</a>)
to distinguish between these cases:</p>
   <ul>
    <li data-md>
     <p>A credential is not available.</p>
    <li data-md>
     <p>A credential is available, but the user does not consent to use it.</p>
   </ul>
   <p>If the above cases are distinguishable, information is leaked by which a
malicious <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party④⑤">Relying Party</a> could identify the user by probing for which <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#public-key-credential" id="ref-for-public-key-credential②">credentials</a> are available.</p>
   <p>Section <a href="#sctn-steps-to-check-if-a-payment-can-be-made">§ 4.1.9 Steps to check if a payment can be made</a> gives normative steps
to mitigate this risk.</p>
   <h3 class="heading settled" data-level="11.3" id="sctn-privacy-joining-payment-instruments"><span class="secno">11.3. </span><span class="content">Joining different payment instruments</span><a class="self-link" href="#sctn-privacy-joining-payment-instruments"></a></h3>
   <p>If a <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party④⑥">Relying Party</a> uses the same credentials for a given user across
multiple payment instruments, this might allow a merchant to join information
about payment instruments that might otherwise not be linked. That is, across
two different transactions that a user U performs with payment instruments P1
and P2 (either on the same merchant M, or two colluding merchants M1 and M2),
the merchant(s) may now be able to learn that P1 and P2 are for the same user.</p>
   <p>For many current online payment flows this may not be a significant
risk, as the user often provides sufficient information to do
this joining anyway (e.g., name, email address, shipping address).</p>
   <p>However, if payment methods that involve less identifying information
(e.g., tokenization) become commonplace, it is important that
ecosystem stakeholders take steps to preserve user privacy. For example:</p>
   <ul>
    <li data-md>
     <p>Payment systems might establish rules that place limits on storage of credential ID(s) by third parties.</p>
    <li data-md>
     <p>When a <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party④⑦">Relying Party</a> assigns multiple instruments to a single SPC credential, it might choose not to share that credential ID with other parties. In this case, the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party④⑧">Relying Party</a> could still use the SPC credential itself (in either a first-party or third-party context) to authenticate the user.</p>
    <li data-md>
     <p>A <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party④⑨">Relying Party</a> (e.g., a bank) might enable the user to register a distinct SPC credential per payment instrument. This would not prevent the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party⑤⓪">Relying Party</a> from joining those accounts internally.</p>
   </ul>
   <h3 class="heading settled" data-level="11.4" id="sctn-privacy-credential-id-tracking-vector"><span class="secno">11.4. </span><span class="content">Credential ID(s) as a tracking vector</span><a class="self-link" href="#sctn-privacy-credential-id-tracking-vector"></a></h3>
   <p>Even for a single payment instrument, the credential ID(s) returned by the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party⑤①">Relying Party</a> could be used by a malicious entity as a tracking vector, as
they are strong, cross-site identifiers. However in order to obtain them from
the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party⑤②">Relying Party</a>, the merchant already needs an as-strong identifier to
give to the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party⑤③">Relying Party</a> (e.g., the credit card number).</p>
   <h3 class="heading settled" data-level="11.5" id="sctn-user-opt-out"><span class="secno">11.5. </span><span class="content">User opt out</span><a class="self-link" href="#sctn-user-opt-out"></a></h3>
   <p>The API option <code class="idl"><a data-link-type="idl" href="#dom-securepaymentconfirmationrequest-showoptout" id="ref-for-dom-securepaymentconfirmationrequest-showoptout②">showOptOut</a></code> tells the
user agent to provide a way for the user to indicate they wish to opt out of the
relying party’s storage of information. When the user invokes this opt out, an <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#optouterror" id="ref-for-optouterror①">OptOutError</a></code> is returned to the caller to indicate the user’s intent to opt
out. It is then up to the caller to act on the opt out, e.g. by clearing payment
information stored for the user.</p>
   <p>Implementors must make sure that the return of an <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#optouterror" id="ref-for-optouterror②">OptOutError</a></code> does not
reveal that the user has credentials but did not complete an authentication.
This can be mitigated by similar means as <a href="#sctn-privacy-probing-credential-ids">§ 11.2 Probing for credential ids</a>, e.g. by also providing the user an
opportunity to opt out on the interstitial UX in the case where a credential
match is not found.</p>
   <p>This is not intended to be a mechanism to delete browser data or credentials -
it is for the developer to prompt for opt out via the user agent. The user agent
should make this clear to the user, for example with some clarifying text:
"This provider may have stored information about your payment method, which you
can request to be deleted."</p>
   <h2 class="heading settled" data-level="12" id="sctn-accessibility-considerations"><span class="secno">12. </span><span class="content">Accessibility Considerations</span><a class="self-link" href="#sctn-accessibility-considerations"></a></h2>
   <p>User agents render the <code class="idl"><a data-link-type="idl" href="#dom-paymentcredentialinstrument-icon" id="ref-for-dom-paymentcredentialinstrument-icon⑧">icon</a></code> and <code class="idl"><a data-link-type="idl" href="#dom-paymentcredentialinstrument-displayname" id="ref-for-dom-paymentcredentialinstrument-displayname④">displayName</a></code> together. Relying parties ensure the accessibility of the icon presentation by providing sufficient information via the <code class="idl"><a data-link-type="idl" href="#dom-paymentcredentialinstrument-displayname" id="ref-for-dom-paymentcredentialinstrument-displayname⑤">displayName</a></code> (e.g., if the icon represents a bank, by including the bank name in the <code class="idl"><a data-link-type="idl" href="#dom-paymentcredentialinstrument-displayname" id="ref-for-dom-paymentcredentialinstrument-displayname⑥">displayName</a></code>).</p>
   <p>User Agents implementing this specification should follow both <a href="https://w3c.github.io/webauthn/#sctn-accessiblility-considerations">WebAuthn’s Accessibility Considerations</a> and <a data-link-type="dfn" href="https://w3c.github.io/payment-request/#accessibility-considerations" id="ref-for-accessibility-considerations">PaymentRequest’s Accessibility Considerations</a>.</p>
   <h2 class="heading settled" data-level="13" id="sctn-i18n-considerations"><span class="secno">13. </span><span class="content">Internationalization Considerations</span><a class="self-link" href="#sctn-i18n-considerations"></a></h2>
   <p>Callers of the API should express the desired <a data-link-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-locale" id="ref-for-dfn-locale①">locale</a> of the
transaction dialog as well as the localization of any displayable
strings via the <code class="idl"><a data-link-type="idl" href="#dom-securepaymentconfirmationrequest-locale" id="ref-for-dom-securepaymentconfirmationrequest-locale③">locale</a></code> member. In
general this member should match the localization of the page where
the request originates (such as by querying the <code>lang</code> attribute of
the button triggering the request).</p>
   <p>This specification does not (yet) include mechanisms for callers to
associate language or direction metadata with the displayable strings
they provide as input to the API (e.g., <code class="idl"><a data-link-type="idl" href="#dom-paymentcredentialinstrument-displayname" id="ref-for-dom-paymentcredentialinstrument-displayname⑦">displayName</a></code>).</p>
   <p>In the meantime, callers of the API should:</p>
   <ul>
    <li data-md>
     <p>Aim for consistency between values of <code class="idl"><a data-link-type="idl" href="#dom-securepaymentconfirmationrequest-locale" id="ref-for-dom-securepaymentconfirmationrequest-locale④">locale</a></code> (when provided) and the language of displayable strings.</p>
    <li data-md>
     <p>Ensure that direction changes within a string will be correctly
rendered when the string is displayed (see <a href="https://www.w3.org/International/questions/qa-bidi-unicode-controls">How to use Unicode controls
for bidi text</a> and <a href="https://www.w3.org/TR/international-specs/#inline_changes">Inline changes to base direction</a> for more information).</p>
   </ul>
   <p>Implementations (and other processes attempting to display values)
should apply <a data-link-type="dfn" href="https://w3c.github.io/i18n-glossary/#dfn-bidi-isolation" id="ref-for-dfn-bidi-isolation">bidi isolation</a> around displayable string values
when inserting them into the user interface. They should set the
direction when it is known, or default to first-strong ("auto")
when it is not.</p>
   <h2 class="heading settled" data-level="14" id="sctn-iana-considerations"><span class="secno">14. </span><span class="content">IANA Considerations</span><a class="self-link" href="#sctn-iana-considerations"></a></h2>
   <p>This section adds the below-listed <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#extension-identifier" id="ref-for-extension-identifier">extension identifier</a> to the IANA "WebAuthn Extension Identifiers" registry <a data-link-type="biblio" href="#biblio-iana-webauthn-registries" title="Registries for Web Authentication (WebAuthn)">[IANA-WebAuthn-Registries]</a> established by <a data-link-type="biblio" href="#biblio-rfc8809" title="Registries for Web Authentication (WebAuthn)">[RFC8809]</a>.</p>
   <ul>
    <li data-md>
     <p>WebAuthn Extension Identifier: payment</p>
    <li data-md>
     <p>Description:  This extension supports the following functionality defined by the Secure Payment Confirmation API: (1) it allows credential creation in a cross-origin iframe (2) it allows a party other than the Relying Party to use the credential to perform an authentication ceremony on behalf of the Relying Party, and (3) it allows the browser to identify and cache Secure Payment Confirmation credentials. For discussion of important ways in which SPC differs from Web Authentication, see in particular <a href="#sctn-security-considerations">§ 10 Security Considerations</a> and <a href="#sctn-privacy-considerations">§ 11 Privacy Considerations</a></p>
    <li data-md>
     <p>Specification Document: Section <a href="#sctn-payment-extension-registration">§ 5 WebAuthn Extension - "payment"</a> of this specification</p>
    <li data-md>
     <p>Change Controller: <a href="https://www.w3.org/groups/wg/payments">W3C Web Payments Working Group</a></p>
    <li data-md>
     <p>Notes: Registration follows <a href="https://www.w3.org/2023/05/03-webauthn-minutes#t01">3 May 2023 discussion</a> with the Web Authentication Working Group.</p>
   </ul>
  </main>
  <div data-fill-with="conformance">
   <h2 class="no-ref no-num heading settled" id="w3c-conformance"><span class="content">Conformance</span><a class="self-link" href="#w3c-conformance"></a></h2>
   <h3 class="no-ref no-num heading settled" id="w3c-conventions"><span class="content">Document conventions</span><a class="self-link" href="#w3c-conventions"></a></h3>
   <p>Conformance requirements are expressed
    with a combination of descriptive assertions
    and RFC 2119 terminology.
    The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “MAY”, and “OPTIONAL”
    in the normative parts of this document
    are to be interpreted as described in RFC 2119.
    However, for readability,
    these words do not appear in all uppercase letters in this specification. </p>
   <p>All of the text of this specification is normative
    except sections explicitly marked as non-normative, examples, and notes. <a data-link-type="biblio" href="#biblio-rfc2119" title="Key words for use in RFCs to Indicate Requirement Levels">[RFC2119]</a> </p>
   <p>Examples in this specification are introduced with the words “for example”
    or are set apart from the normative text
    with <code>class="example"</code>,
    like this: </p>
   <div class="example" id="w3c-example">
    <a class="self-link" href="#w3c-example"></a> 
    <p>This is an example of an informative example. </p>
   </div>
   <p>Informative notes begin with the word “Note”
    and are set apart from the normative text
    with <code>class="note"</code>,
    like this: </p>
   <p class="note" role="note">Note, this is an informative note.</p>
   <details class="wpt-tests-block" dir="ltr" lang="en" open>
    <summary>Tests</summary>
    <p>Tests relating to the content of this specification
                     may be documented in “Tests” blocks like this one.
                     Any such block is non-normative.</p>
    <ul class="wpt-tests-list"></ul>
    <hr>
   </details>
   <section>
    <h3 class="no-ref no-num heading settled" id="w3c-conformant-algorithms"><span class="content">Conformant Algorithms</span><a class="self-link" href="#w3c-conformant-algorithms"></a></h3>
    <p>Requirements phrased in the imperative as part of algorithms
    (such as "strip any leading space characters"
    or "return false and abort these steps")
    are to be interpreted with the meaning of the key word
    ("must", "should", "may", etc)
    used in introducing the algorithm. </p>
    <p>Conformance requirements phrased as algorithms or specific steps
    can be implemented in any manner,
    so long as the end result is equivalent.
    In particular, the algorithms defined in this specification
    are intended to be easy to understand
    and are not intended to be performant.
    Implementers are encouraged to optimize. </p>
   </section>
  </div>
<script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#dictdef-authenticationextensionspaymentinputs">AuthenticationExtensionsPaymentInputs</a><span>, in § 5</span>
   <li><a href="#dom-securepaymentconfirmationrequest-challenge">challenge</a><span>, in § 4.1.5</span>
   <li><a href="#client-extension-processing-authentication">Client extension processing (authentication)</a><span>, in § 5</span>
   <li><a href="#client-extension-processing-registration">Client extension processing (registration)</a><span>, in § 5</span>
   <li><a href="#dictdef-collectedclientadditionalpaymentdata">CollectedClientAdditionalPaymentData</a><span>, in § 5.2</span>
   <li><a href="#dictdef-collectedclientpaymentdata">CollectedClientPaymentData</a><span>, in § 5.1</span>
   <li><a href="#dom-securepaymentconfirmationrequest-credentialids">credentialIds</a><span>, in § 4.1.5</span>
   <li><a href="#current-transaction-automation-mode">current transaction automation mode</a><span>, in § 9.1</span>
   <li><a href="#dom-paymentcredentialinstrument-displayname">displayName</a><span>, in § 6.1</span>
   <li><a href="#dom-securepaymentconfirmationrequest-extensions">extensions</a><span>, in § 4.1.5</span>
   <li><a href="#dom-paymentcredentialinstrument-icon">icon</a><span>, in § 6.1</span>
   <li><a href="#dom-paymentcredentialinstrument-iconmustbeshown">iconMustBeShown</a><span>, in § 6.1</span>
   <li>
    instrument
    <ul>
     <li><a href="#dom-authenticationextensionspaymentinputs-instrument">dict-member for AuthenticationExtensionsPaymentInputs</a><span>, in § 5</span>
     <li><a href="#dom-collectedclientadditionalpaymentdata-instrument">dict-member for CollectedClientAdditionalPaymentData</a><span>, in § 5.2</span>
     <li><a href="#dom-securepaymentconfirmationrequest-instrument">dict-member for SecurePaymentConfirmationRequest</a><span>, in § 4.1.5</span>
    </ul>
   <li><a href="#dom-authenticationextensionspaymentinputs-ispayment">isPayment</a><span>, in § 5</span>
   <li><a href="#dom-paymentrequest-issecurepaymentconfirmationavailable">isSecurePaymentConfirmationAvailable()</a><span>, in § 4.1.7</span>
   <li><a href="#dom-securepaymentconfirmationrequest-locale">locale</a><span>, in § 4.1.5</span>
   <li>
    payeeName
    <ul>
     <li><a href="#dom-authenticationextensionspaymentinputs-payeename">dict-member for AuthenticationExtensionsPaymentInputs</a><span>, in § 5</span>
     <li><a href="#dom-collectedclientadditionalpaymentdata-payeename">dict-member for CollectedClientAdditionalPaymentData</a><span>, in § 5.2</span>
     <li><a href="#dom-securepaymentconfirmationrequest-payeename">dict-member for SecurePaymentConfirmationRequest</a><span>, in § 4.1.5</span>
    </ul>
   <li>
    payeeOrigin
    <ul>
     <li><a href="#dom-authenticationextensionspaymentinputs-payeeorigin">dict-member for AuthenticationExtensionsPaymentInputs</a><span>, in § 5</span>
     <li><a href="#dom-collectedclientadditionalpaymentdata-payeeorigin">dict-member for CollectedClientAdditionalPaymentData</a><span>, in § 5.2</span>
     <li><a href="#dom-securepaymentconfirmationrequest-payeeorigin">dict-member for SecurePaymentConfirmationRequest</a><span>, in § 4.1.5</span>
    </ul>
   <li>
    payment
    <ul>
     <li><a href="#dom-authenticationextensionsclientinputs-payment">dict-member for AuthenticationExtensionsClientInputs</a><span>, in § 5</span>
     <li><a href="#dom-collectedclientpaymentdata-payment">dict-member for CollectedClientPaymentData</a><span>, in § 5.1</span>
    </ul>
   <li><a href="#dictdef-paymentcredentialinstrument">PaymentCredentialInstrument</a><span>, in § 6.1</span>
   <li>
    rpId
    <ul>
     <li><a href="#dom-authenticationextensionspaymentinputs-rpid">dict-member for AuthenticationExtensionsPaymentInputs</a><span>, in § 5</span>
     <li><a href="#dom-collectedclientadditionalpaymentdata-rpid">dict-member for CollectedClientAdditionalPaymentData</a><span>, in § 5.2</span>
     <li><a href="#dom-securepaymentconfirmationrequest-rpid">dict-member for SecurePaymentConfirmationRequest</a><span>, in § 4.1.5</span>
    </ul>
   <li><a href="#secure-payment-confirmation">secure-payment-confirmation</a><span>, in § 4.1.1</span>
   <li><a href="#secure-payment-confirmation-payment-handler">Secure Payment Confirmation payment handler</a><span>, in § 4.1</span>
   <li><a href="#dictdef-securepaymentconfirmationrequest">SecurePaymentConfirmationRequest</a><span>, in § 4.1.5</span>
   <li><a href="#set-spc-transaction-mode">Set SPC Transaction Mode</a><span>, in § 9.1</span>
   <li><a href="#dom-securepaymentconfirmationrequest-showoptout">showOptOut</a><span>, in § 4.1.5</span>
   <li><a href="#spc-credential">SPC Credential</a><span>, in § 2</span>
   <li><a href="#steps-to-silently-determine-if-a-credential-is-available-for-the-current-device">Steps to silently determine if a credential is available for the current device</a><span>, in § 2</span>
   <li><a href="#steps-to-silently-determine-if-a-credential-is-spc-enabled">Steps to silently determine if a credential is SPC-enabled</a><span>, in § 2</span>
   <li><a href="#dom-securepaymentconfirmationrequest-timeout">timeout</a><span>, in § 4.1.5</span>
   <li>
    topOrigin
    <ul>
     <li><a href="#dom-authenticationextensionspaymentinputs-toporigin">dict-member for AuthenticationExtensionsPaymentInputs</a><span>, in § 5</span>
     <li><a href="#dom-collectedclientadditionalpaymentdata-toporigin">dict-member for CollectedClientAdditionalPaymentData</a><span>, in § 5.2</span>
    </ul>
   <li>
    total
    <ul>
     <li><a href="#dom-authenticationextensionspaymentinputs-total">dict-member for AuthenticationExtensionsPaymentInputs</a><span>, in § 5</span>
     <li><a href="#dom-collectedclientadditionalpaymentdata-total">dict-member for CollectedClientAdditionalPaymentData</a><span>, in § 5.2</span>
    </ul>
  </ul>
  <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[CREDENTIAL-MANAGEMENT-1]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="b0f5bc03">create()</span>
     <li><span class="dfn-paneled" id="99134679">get()</span>
     <li><span class="dfn-paneled" id="cbdd0aff">id</span>
     <li><span class="dfn-paneled" id="fe4adbb9">request a credential</span>
    </ul>
   <li>
    <a data-link-type="biblio">[ECMASCRIPT]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="8841d736">internal method</span>
    </ul>
   <li>
    <a data-link-type="biblio">[FETCH]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="55213b5b">request</span>
    </ul>
   <li>
    <a data-link-type="biblio">[HTML]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="aca22383">consume user activation</span>
     <li><span class="dfn-paneled" id="12b8dfc0">current settings object</span>
     <li><span class="dfn-paneled" id="a72449dd">in parallel</span>
     <li><span class="dfn-paneled" id="086e3aff">origin</span>
     <li><span class="dfn-paneled" id="e99bd18e">relevant global object</span>
     <li><span class="dfn-paneled" id="9c4c1e66">relevant settings object</span>
     <li><span class="dfn-paneled" id="dae0bfde">serialization of an origin</span>
     <li><span class="dfn-paneled" id="c63519ed">top-level origin</span>
     <li><span class="dfn-paneled" id="47fe679e">transient activation</span>
    </ul>
   <li>
    <a data-link-type="biblio">[I18N-GLOSSARY]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="2ba936be">bidi isolation</span>
     <li><span class="dfn-paneled" id="6d26b819">language negotiation</span>
     <li><span class="dfn-paneled" id="30eadef0">language priority list</span>
     <li><span class="dfn-paneled" id="16ad0fd2">locale</span>
    </ul>
   <li>
    <a data-link-type="biblio">[IMAGE-RESOURCE]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="502ee54a">fetching an image resource</span>
     <li><span class="dfn-paneled" id="e8aa4aef">src</span>
    </ul>
   <li>
    <a data-link-type="biblio">[INFRA]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="53275e46">append</span>
    </ul>
   <li>
    <a data-link-type="biblio">[PAYMENT-METHOD-ID]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="1a0d3ec4">registry of standardized payment methods</span>
     <li><span class="dfn-paneled" id="7ab3c32e">standardized payment method identifier</span>
    </ul>
   <li>
    <a data-link-type="biblio">[PAYMENT-REQUEST]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="75f46ef4">payment method</span>
     <li><span class="dfn-paneled" id="87335f73">payment method additional data type</span>
     <li><span class="dfn-paneled" id="dc24f2fe">payment permission string</span>
     <li><span class="dfn-paneled" id="60fc1ac5">payment request accessibility considerations</span>
     <li><span class="dfn-paneled" id="b29c33d9">payment request details</span>
     <li><span class="dfn-paneled" id="02f7d0f9">steps to check if a payment can be made</span>
     <li><span class="dfn-paneled" id="559656f0">steps to respond to a payment request</span>
     <li><span class="dfn-paneled" id="ba4dacbc">steps to validate payment method data</span>
    </ul>
   <li>
    <a data-link-type="biblio">[PAYMENT-REQUEST-1.1]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="0d174a15">PaymentCurrencyAmount</span>
     <li><span class="dfn-paneled" id="f679a0bc">PaymentRequest</span>
     <li><span class="dfn-paneled" id="dd8fd6f0">canMakePayment()</span>
     <li><span class="dfn-paneled" id="999d5cb6">constructor()</span>
     <li><span class="dfn-paneled" id="df23dd0d">currency</span>
     <li><span class="dfn-paneled" id="22176f90">payment handler</span>
     <li><span class="dfn-paneled" id="ab86e0f1">show()</span>
     <li><span class="dfn-paneled" id="3230704c">total</span>
     <li><span class="dfn-paneled" id="5f695b8a">value</span>
    </ul>
   <li>
    <a data-link-type="biblio">[URL]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="959ad97b">origin</span>
     <li><span class="dfn-paneled" id="3a711be7">scheme</span>
     <li><span class="dfn-paneled" id="ca3ca4ae">url parser</span>
     <li><span class="dfn-paneled" id="79cad4dd">valid domain</span>
    </ul>
   <li>
    <a data-link-type="biblio">[WEB-AUTHN]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="8f3d2845">authentication ceremony</span>
     <li><span class="dfn-paneled" id="9c64cd22">authentication extension</span>
     <li><span class="dfn-paneled" id="88ae1d28">client extension</span>
     <li><span class="dfn-paneled" id="e4d7113a">credential id</span>
     <li><span class="dfn-paneled" id="3781d718">discoverable credential</span>
     <li><span class="dfn-paneled" id="b6a00a38">extension identifier</span>
     <li><span class="dfn-paneled" id="fe1cbc76">public key credential</span>
     <li><span class="dfn-paneled" id="5d6beb3a">registration extension</span>
     <li><span class="dfn-paneled" id="77a62788">relying party</span>
     <li><span class="dfn-paneled" id="c92c9b81">relying party identifier</span>
     <li><span class="dfn-paneled" id="c7e62ce0">user member</span>
     <li><span class="dfn-paneled" id="2e3d2880">webauthn extension</span>
    </ul>
   <li>
    <a data-link-type="biblio">[WEBAUTHN-3]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="b6db798e">AuthenticationExtensionsClientInputs</span>
     <li><span class="dfn-paneled" id="8e16d894">CollectedClientData</span>
     <li><span class="dfn-paneled" id="91d31374">PublicKeyCredential</span>
     <li><span class="dfn-paneled" id="dff7edfa">PublicKeyCredentialDescriptor</span>
     <li><span class="dfn-paneled" id="612eb719">PublicKeyCredentialRequestOptions</span>
     <li><span class="dfn-paneled" id="dd14e576">[[Create]](origin, options, sameOriginWithAncestors)</span>
     <li><span class="dfn-paneled" id="3146e9fe">[[DiscoverFromExternalSource]](origin, options, sameOriginWithAncestors)</span>
     <li><span class="dfn-paneled" id="6f6046b7">allowCredentials</span>
     <li><span class="dfn-paneled" id="57afee2f">authenticatorAttachment</span>
     <li><span class="dfn-paneled" id="5a486d64">authenticatorSelection</span>
     <li><span class="dfn-paneled" id="0624097e">challenge <small>(for CollectedClientData)</small></span>
     <li><span class="dfn-paneled" id="7a83f58e">challenge <small>(for PublicKeyCredentialRequestOptions)</small></span>
     <li><span class="dfn-paneled" id="853b63e3">displayName</span>
     <li><span class="dfn-paneled" id="af57cf45">extensions</span>
     <li><span class="dfn-paneled" id="82de8c4b">id</span>
     <li><span class="dfn-paneled" id="447b180f">internal</span>
     <li><span class="dfn-paneled" id="5f03b645">name</span>
     <li><span class="dfn-paneled" id="221df805">origin</span>
     <li><span class="dfn-paneled" id="2c8910a4">platform</span>
     <li><span class="dfn-paneled" id="a7e81336">preferred</span>
     <li><span class="dfn-paneled" id="9dd3f517">public-key</span>
     <li><span class="dfn-paneled" id="bd0c1062">publicKey</span>
     <li><span class="dfn-paneled" id="cc58e2fc">required <small>(for ResidentKeyRequirement)</small></span>
     <li><span class="dfn-paneled" id="b8c02d5c">required <small>(for UserVerificationRequirement)</small></span>
     <li><span class="dfn-paneled" id="3dd57d47">residentKey</span>
     <li><span class="dfn-paneled" id="dafe96b4">rpId</span>
     <li><span class="dfn-paneled" id="39e227ac">timeout</span>
     <li><span class="dfn-paneled" id="d826f552">transports</span>
     <li><span class="dfn-paneled" id="870a9cbb">type <small>(for CollectedClientData)</small></span>
     <li><span class="dfn-paneled" id="f580b6a5">type <small>(for PublicKeyCredentialDescriptor)</small></span>
     <li><span class="dfn-paneled" id="de38fdaf">userVerification <small>(for AuthenticatorSelectionCriteria)</small></span>
     <li><span class="dfn-paneled" id="38afc4f0">userVerification <small>(for PublicKeyCredentialRequestOptions)</small></span>
    </ul>
   <li>
    <a data-link-type="biblio">[WEBDRIVER1]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="cce1676e">extension command</span>
     <li><span class="dfn-paneled" id="5b668531">getting a property</span>
     <li><span class="dfn-paneled" id="8da4d1e3">invalid argument</span>
     <li><span class="dfn-paneled" id="82c23298">remote end steps</span>
     <li><span class="dfn-paneled" id="4be6272b">success</span>
     <li><span class="dfn-paneled" id="603c5d8f">undefined</span>
     <li><span class="dfn-paneled" id="5cf0e148">webdriver error</span>
     <li><span class="dfn-paneled" id="7482107b">webdriver error code</span>
    </ul>
   <li>
    <a data-link-type="biblio">[WEBIDL]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="3aff2fb3">BufferSource</span>
     <li><span class="dfn-paneled" id="dca2de17">DOMException</span>
     <li><span class="dfn-paneled" id="ba556545">NotAllowedError</span>
     <li><span class="dfn-paneled" id="b1c1965a">OptOutError</span>
     <li><span class="dfn-paneled" id="bdbd19d1">Promise</span>
     <li><span class="dfn-paneled" id="ec878a66">RangeError</span>
     <li><span class="dfn-paneled" id="c3e881ef">SecurityError</span>
     <li><span class="dfn-paneled" id="82ca3efc">TypeError</span>
     <li><span class="dfn-paneled" id="b0d7f3c3">USVString</span>
     <li><span class="dfn-paneled" id="d0b4a948">a promise rejected with</span>
     <li><span class="dfn-paneled" id="5372cca8">boolean</span>
     <li><span class="dfn-paneled" id="9cce47fd">sequence</span>
     <li><span class="dfn-paneled" id="e97a9688">unsigned long</span>
    </ul>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-credential-management-1">[CREDENTIAL-MANAGEMENT-1]
   <dd>Mike West. <a href="https://w3c.github.io/webappsec-credential-management/"><cite>Credential Management Level 1</cite></a>. URL: <a href="https://w3c.github.io/webappsec-credential-management/">https://w3c.github.io/webappsec-credential-management/</a>
   <dt id="biblio-ecmascript">[ECMASCRIPT]
   <dd><a href="https://tc39.es/ecma262/multipage/"><cite>ECMAScript Language Specification</cite></a>. URL: <a href="https://tc39.es/ecma262/multipage/">https://tc39.es/ecma262/multipage/</a>
   <dt id="biblio-fetch">[FETCH]
   <dd>Anne van Kesteren. <a href="https://fetch.spec.whatwg.org/"><cite>Fetch Standard</cite></a>. Living Standard. URL: <a href="https://fetch.spec.whatwg.org/">https://fetch.spec.whatwg.org/</a>
   <dt id="biblio-html">[HTML]
   <dd>Anne van Kesteren; et al. <a href="https://html.spec.whatwg.org/multipage/"><cite>HTML Standard</cite></a>. Living Standard. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
   <dt id="biblio-i18n-glossary">[I18N-GLOSSARY]
   <dd>Richard Ishida; Addison Phillips. <a href="https://w3c.github.io/i18n-glossary/"><cite>Internationalization Glossary</cite></a>. URL: <a href="https://w3c.github.io/i18n-glossary/">https://w3c.github.io/i18n-glossary/</a>
   <dt id="biblio-iana-webauthn-registries">[IANA-WebAuthn-Registries]
   <dd><a href="https://www.rfc-editor.org/rfc/rfc8809.html"><cite>Registries for Web Authentication (WebAuthn)</cite></a>. URL: <a href="https://www.rfc-editor.org/rfc/rfc8809.html">https://www.rfc-editor.org/rfc/rfc8809.html</a>
   <dt id="biblio-image-resource">[IMAGE-RESOURCE]
   <dd>Aaron Gustafson; Rayan Kanso; Marcos Caceres. <a href="https://w3c.github.io/image-resource/"><cite>Image Resource</cite></a>. URL: <a href="https://w3c.github.io/image-resource/">https://w3c.github.io/image-resource/</a>
   <dt id="biblio-infra">[INFRA]
   <dd>Anne van Kesteren; Domenic Denicola. <a href="https://infra.spec.whatwg.org/"><cite>Infra Standard</cite></a>. Living Standard. URL: <a href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a>
   <dt id="biblio-payment-method-id">[PAYMENT-METHOD-ID]
   <dd>Marcos Caceres. <a href="https://w3c.github.io/payment-method-id/"><cite>Payment Method Identifiers</cite></a>. URL: <a href="https://w3c.github.io/payment-method-id/">https://w3c.github.io/payment-method-id/</a>
   <dt id="biblio-payment-request">[PAYMENT-REQUEST]
   <dd>Marcos Caceres; Rouslan Solomakhin; Ian Jacobs. <a href="https://w3c.github.io/payment-request/"><cite>Payment Request API</cite></a>. URL: <a href="https://w3c.github.io/payment-request/">https://w3c.github.io/payment-request/</a>
   <dt id="biblio-payment-request-11">[PAYMENT-REQUEST-1.1]
   <dd>Marcos Caceres; Rouslan Solomakhin; Ian Jacobs. <a href="https://w3c.github.io/payment-request/"><cite>Payment Request API 1.1</cite></a>. URL: <a href="https://w3c.github.io/payment-request/">https://w3c.github.io/payment-request/</a>
   <dt id="biblio-rfc2119">[RFC2119]
   <dd>S. Bradner. <a href="https://datatracker.ietf.org/doc/html/rfc2119"><cite>Key words for use in RFCs to Indicate Requirement Levels</cite></a>. March 1997. Best Current Practice. URL: <a href="https://datatracker.ietf.org/doc/html/rfc2119">https://datatracker.ietf.org/doc/html/rfc2119</a>
   <dt id="biblio-rfc8809">[RFC8809]
   <dd>J. Hodges; G. Mandyam; M. Jones. <a href="https://www.rfc-editor.org/rfc/rfc8809"><cite>Registries for Web Authentication (WebAuthn)</cite></a>. August 2020. Informational. URL: <a href="https://www.rfc-editor.org/rfc/rfc8809">https://www.rfc-editor.org/rfc/rfc8809</a>
   <dt id="biblio-url">[URL]
   <dd>Anne van Kesteren. <a href="https://url.spec.whatwg.org/"><cite>URL Standard</cite></a>. Living Standard. URL: <a href="https://url.spec.whatwg.org/">https://url.spec.whatwg.org/</a>
   <dt id="biblio-webauthn-3">[WEBAUTHN-3]
   <dd>Michael Jones; Akshay Kumar; Emil Lundberg. <a href="https://w3c.github.io/webauthn/"><cite>Web Authentication: An API for accessing Public Key Credentials - Level 3</cite></a>. URL: <a href="https://w3c.github.io/webauthn/">https://w3c.github.io/webauthn/</a>
   <dt id="biblio-webdriver1">[WEBDRIVER1]
   <dd>Simon Stewart; David Burns. <a href="https://w3c.github.io/webdriver/"><cite>WebDriver</cite></a>. URL: <a href="https://w3c.github.io/webdriver/">https://w3c.github.io/webdriver/</a>
   <dt id="biblio-webdriver2">[WebDriver2]
   <dd>Simon Stewart; David Burns. <a href="https://w3c.github.io/webdriver/"><cite>WebDriver</cite></a>. URL: <a href="https://w3c.github.io/webdriver/">https://w3c.github.io/webdriver/</a>
   <dt id="biblio-webidl">[WEBIDL]
   <dd>Edgar Chen; Timothy Gu. <a href="https://webidl.spec.whatwg.org/"><cite>Web IDL Standard</cite></a>. Living Standard. URL: <a href="https://webidl.spec.whatwg.org/">https://webidl.spec.whatwg.org/</a>
  </dl>
  <h3 class="no-num no-ref heading settled" id="informative"><span class="content">Informative References</span><a class="self-link" href="#informative"></a></h3>
  <dl>
   <dt id="biblio-bcp47">[BCP47]
   <dd>A. Phillips, Ed.; M. Davis, Ed.. <a href="https://www.rfc-editor.org/rfc/rfc5646"><cite>Tags for Identifying Languages</cite></a>. September 2009. Best Current Practice. URL: <a href="https://www.rfc-editor.org/rfc/rfc5646">https://www.rfc-editor.org/rfc/rfc5646</a>
   <dt id="biblio-rfc2397">[RFC2397]
   <dd>L. Masinter. <a href="https://www.rfc-editor.org/rfc/rfc2397"><cite>The "data" URL scheme</cite></a>. August 1998. Proposed Standard. URL: <a href="https://www.rfc-editor.org/rfc/rfc2397">https://www.rfc-editor.org/rfc/rfc2397</a>
   <dt id="biblio-rfc4647">[RFC4647]
   <dd>A. Phillips, Ed.; M. Davis, Ed.. <a href="https://www.rfc-editor.org/rfc/rfc4647"><cite>Matching of Language Tags</cite></a>. September 2006. Best Current Practice. URL: <a href="https://www.rfc-editor.org/rfc/rfc4647">https://www.rfc-editor.org/rfc/rfc4647</a>
   <dt id="biblio-webauthn-conditional-ui">[WEBAUTHN-CONDITIONAL-UI]
   <dd><a href="https://github.com/w3c/webauthn/issues/1545"><cite>WebAuthn Conditional UI Proposal</cite></a>. URL: <a href="https://github.com/w3c/webauthn/issues/1545">https://github.com/w3c/webauthn/issues/1545</a>
  </dl>
  <h2 class="no-num no-ref heading settled" id="idl-index"><span class="content">IDL Index</span><a class="self-link" href="#idl-index"></a></h2>
<pre class="idl highlight def"><c- b>dictionary</c-> <a class="idl-code" data-link-type="dictionary" href="#dictdef-securepaymentconfirmationrequest"><c- g>SecurePaymentConfirmationRequest</c-></a> {
    <c- b>required</c-> <a data-link-type="idl-name" href="https://webidl.spec.whatwg.org/#BufferSource"><c- n>BufferSource</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="BufferSource " href="#dom-securepaymentconfirmationrequest-challenge"><c- g>challenge</c-></a>;
    <c- b>required</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString"><c- b>USVString</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="USVString " href="#dom-securepaymentconfirmationrequest-rpid"><c- g>rpId</c-></a>;
    <c- b>required</c-> <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-sequence"><c- b>sequence</c-></a>&lt;<a data-link-type="idl-name" href="https://webidl.spec.whatwg.org/#BufferSource"><c- n>BufferSource</c-></a>> <a class="idl-code" data-link-type="dict-member" data-type="sequence<BufferSource> " href="#dom-securepaymentconfirmationrequest-credentialids"><c- g>credentialIds</c-></a>;
    <c- b>required</c-> <a data-link-type="idl-name" href="#dictdef-paymentcredentialinstrument"><c- n>PaymentCredentialInstrument</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="PaymentCredentialInstrument " href="#dom-securepaymentconfirmationrequest-instrument"><c- g>instrument</c-></a>;
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long"><c- b>unsigned</c-> <c- b>long</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="unsigned long " href="#dom-securepaymentconfirmationrequest-timeout"><c- g>timeout</c-></a>;
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString"><c- b>USVString</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="USVString " href="#dom-securepaymentconfirmationrequest-payeename"><c- g>payeeName</c-></a>;
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString"><c- b>USVString</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="USVString " href="#dom-securepaymentconfirmationrequest-payeeorigin"><c- g>payeeOrigin</c-></a>;
    <a data-link-type="idl-name" href="https://w3c.github.io/webauthn/#dictdef-authenticationextensionsclientinputs"><c- n>AuthenticationExtensionsClientInputs</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="AuthenticationExtensionsClientInputs " href="#dom-securepaymentconfirmationrequest-extensions"><c- g>extensions</c-></a>;
    <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#idl-sequence"><c- b>sequence</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString"><c- b>USVString</c-></a>> <a class="idl-code" data-link-type="dict-member" data-type="sequence<USVString> " href="#dom-securepaymentconfirmationrequest-locale"><c- g>locale</c-></a>;
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean"><c- b>boolean</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="boolean " href="#dom-securepaymentconfirmationrequest-showoptout"><c- g>showOptOut</c-></a>;
};

<c- b>partial</c-> <c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="https://w3c.github.io/payment-request/#dom-paymentrequest"><c- g>PaymentRequest</c-></a> {
    <c- b>static</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean"><c- b>boolean</c-></a>> <a href="#dom-paymentrequest-issecurepaymentconfirmationavailable"><code><c- g>isSecurePaymentConfirmationAvailable</c-></code></a>();
};

<c- b>partial</c-> <c- b>dictionary</c-> <a class="idl-code" data-link-type="dictionary" href="https://w3c.github.io/webauthn/#dictdef-authenticationextensionsclientinputs"><c- g>AuthenticationExtensionsClientInputs</c-></a> {
  <a data-link-type="idl-name" href="#dictdef-authenticationextensionspaymentinputs"><c- n>AuthenticationExtensionsPaymentInputs</c-></a> <a data-type="AuthenticationExtensionsPaymentInputs " href="#dom-authenticationextensionsclientinputs-payment"><code><c- g>payment</c-></code></a>;
};

<c- b>dictionary</c-> <a href="#dictdef-authenticationextensionspaymentinputs"><code><c- g>AuthenticationExtensionsPaymentInputs</c-></code></a> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean"><c- b>boolean</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="boolean " href="#dom-authenticationextensionspaymentinputs-ispayment"><c- g>isPayment</c-></a>;

  // Only used for authentication.
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString"><c- b>USVString</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="USVString " href="#dom-authenticationextensionspaymentinputs-rpid"><c- g>rpId</c-></a>;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString"><c- b>USVString</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="USVString " href="#dom-authenticationextensionspaymentinputs-toporigin"><c- g>topOrigin</c-></a>;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString"><c- b>USVString</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="USVString " href="#dom-authenticationextensionspaymentinputs-payeename"><c- g>payeeName</c-></a>;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString"><c- b>USVString</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="USVString " href="#dom-authenticationextensionspaymentinputs-payeeorigin"><c- g>payeeOrigin</c-></a>;
  <a data-link-type="idl-name" href="https://w3c.github.io/payment-request/#dom-paymentcurrencyamount"><c- n>PaymentCurrencyAmount</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="PaymentCurrencyAmount " href="#dom-authenticationextensionspaymentinputs-total"><c- g>total</c-></a>;
  <a data-link-type="idl-name" href="#dictdef-paymentcredentialinstrument"><c- n>PaymentCredentialInstrument</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="PaymentCredentialInstrument " href="#dom-authenticationextensionspaymentinputs-instrument"><c- g>instrument</c-></a>;
};

<c- b>dictionary</c-> <a class="idl-code" data-link-type="dictionary" href="#dictdef-collectedclientpaymentdata"><c- g>CollectedClientPaymentData</c-></a> : <a data-link-type="idl-name" href="https://w3c.github.io/webauthn/#dictdef-collectedclientdata"><c- n>CollectedClientData</c-></a> {
    <c- b>required</c-> <a data-link-type="idl-name" href="#dictdef-collectedclientadditionalpaymentdata"><c- n>CollectedClientAdditionalPaymentData</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="CollectedClientAdditionalPaymentData " href="#dom-collectedclientpaymentdata-payment"><c- g>payment</c-></a>;
};

<c- b>dictionary</c-> <a class="idl-code" data-link-type="dictionary" href="#dictdef-collectedclientadditionalpaymentdata"><c- g>CollectedClientAdditionalPaymentData</c-></a> {
    <c- b>required</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString"><c- b>USVString</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="USVString " href="#dom-collectedclientadditionalpaymentdata-rpid"><c- g>rpId</c-></a>;
    <c- b>required</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString"><c- b>USVString</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="USVString " href="#dom-collectedclientadditionalpaymentdata-toporigin"><c- g>topOrigin</c-></a>;
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString"><c- b>USVString</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="USVString " href="#dom-collectedclientadditionalpaymentdata-payeename"><c- g>payeeName</c-></a>;
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString"><c- b>USVString</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="USVString " href="#dom-collectedclientadditionalpaymentdata-payeeorigin"><c- g>payeeOrigin</c-></a>;
    <c- b>required</c-> <a data-link-type="idl-name" href="https://w3c.github.io/payment-request/#dom-paymentcurrencyamount"><c- n>PaymentCurrencyAmount</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="PaymentCurrencyAmount " href="#dom-collectedclientadditionalpaymentdata-total"><c- g>total</c-></a>;
    <c- b>required</c-> <a data-link-type="idl-name" href="#dictdef-paymentcredentialinstrument"><c- n>PaymentCredentialInstrument</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="PaymentCredentialInstrument " href="#dom-collectedclientadditionalpaymentdata-instrument"><c- g>instrument</c-></a>;
};

<c- b>dictionary</c-> <a class="idl-code" data-link-type="dictionary" href="#dictdef-paymentcredentialinstrument"><c- g>PaymentCredentialInstrument</c-></a> {
    <c- b>required</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString"><c- b>USVString</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="USVString " href="#dom-paymentcredentialinstrument-displayname"><c- g>displayName</c-></a>;
    <c- b>required</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString"><c- b>USVString</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="USVString " href="#dom-paymentcredentialinstrument-icon"><c- g>icon</c-></a>;
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean"><c- b>boolean</c-></a> <a class="idl-code" data-default="true" data-link-type="dict-member" data-type="boolean " href="#dom-paymentcredentialinstrument-iconmustbeshown"><c- g>iconMustBeShown</c-></a> = <c- b>true</c->;
};

</pre>
<script>/* Boilerplate: script-dfn-panel */
"use strict";
{
    const dfnsJson = window.dfnsJson || {};

    function genDfnPanel({dfnID, url, dfnText, refSections, external}) {
        return mk.aside({
            class: "dfn-panel",
            id: `infopanel-for-${dfnID}`,
            "data-for": dfnID,
            "aria-labelled-by":`infopaneltitle-for-${dfnID}`,
            },
            mk.span({id:`infopaneltitle-for-${dfnID}`, style:"display:none"},
                `Info about the '${dfnText}' ${external?"external":""} reference.`),
            mk.a({href:url}, url),
            mk.b({}, "Referenced in:"),
            mk.ul({},
                ...refSections.map(section=>
                    mk.li({},
                        ...section.refs.map((ref, refI)=>
                            [
                                mk.a({
                                    href: `#${ref.id}`
                                    },
                                    (refI == 0) ? section.title : `(${refI + 1})`
                                ),
                                " ",
                            ]
                        ),
                    ),
                ),
            ),
        );
    }

    function genAllDfnPanels() {
        for(const panelData of Object.values(window.dfnpanelData)) {
            const dfnID = panelData.dfnID;
            const dfn = document.getElementById(dfnID);
            if(!dfn) {
                console.log(`Can't find dfn#${dfnID}.`, panelData);
            } else {
                const panel = genDfnPanel(panelData);
                append(document.body, panel);
                insertDfnPopupAction(dfn, panel)
            }
        }
    }

    document.addEventListener("DOMContentLoaded", ()=>{
        genAllDfnPanels();

        // Add popup behavior to all dfns to show the corresponding dfn-panel.
        var dfns = queryAll('.dfn-paneled');
        for(let dfn of dfns) { ; }

        document.body.addEventListener("click", (e) => {
            // If not handled already, just hide all dfn panels.
            hideAllDfnPanels();
        });
    })


    function hideAllDfnPanels() {
        // Turn off any currently "on" or "activated" panels.
        queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(el=>hideDfnPanel(el));
    }

    function showDfnPanel(dfnPanel, dfn) {
        hideAllDfnPanels(); // Only display one at this time.
        dfn.setAttribute("aria-expanded", "true");
        dfnPanel.classList.add("on");
        dfnPanel.style.left = "5px";
        dfnPanel.style.top = "0px";
        const panelRect = dfnPanel.getBoundingClientRect();
        const panelWidth = panelRect.right - panelRect.left;
        if (panelRect.right > document.body.scrollWidth) {
            // Panel's overflowing the screen.
            // Just drop it below the dfn and flip it rightward instead.
            // This still wont' fix things if the screen is *really* wide,
            // but fixing that's a lot harder without 'anchor()'.
            dfnPanel.style.top = "1.5em";
            dfnPanel.style.left = "auto";
            dfnPanel.style.right = "0px";
        }
    }

    function pinDfnPanel(dfnPanel) {
        // Switch it to "activated" state, which pins it.
        dfnPanel.classList.add("activated");
        dfnPanel.style.left = null;
        dfnPanel.style.top = null;
    }

    function hideDfnPanel(dfnPanel, dfn) {
        if(!dfn) {
            dfn = document.getElementById(dfnPanel.getAttribute("data-for"));
        }
        dfn.setAttribute("aria-expanded", "false")
        dfnPanel.classList.remove("on");
        dfnPanel.classList.remove("activated");
    }

    function toggleDfnPanel(dfnPanel, dfn) {
        if(dfnPanel.classList.contains("on")) {
            hideDfnPanel(dfnPanel, dfn);
        } else {
            showDfnPanel(dfnPanel, dfn);
        }
    }

    function insertDfnPopupAction(dfn, dfnPanel) {
        // Find dfn panel
        const panelWrapper = document.createElement('span');
        panelWrapper.appendChild(dfnPanel);
        panelWrapper.style.position = "relative";
        panelWrapper.style.height = "0px";
        dfn.insertAdjacentElement("afterend", panelWrapper);
        dfn.setAttribute('role', 'button');
        dfn.setAttribute('aria-expanded', 'false')
        dfn.tabIndex = 0;
        dfn.classList.add('has-dfn-panel');
        dfn.addEventListener('click', (event) => {
            showDfnPanel(dfnPanel, dfn);
            event.stopPropagation();
        });
        dfn.addEventListener('keypress', (event) => {
            const kc = event.keyCode;
            // 32->Space, 13->Enter
            if(kc == 32 || kc == 13) {
                toggleDfnPanel(dfnPanel, dfn);
                event.stopPropagation();
                event.preventDefault();
            }
        });

        dfnPanel.addEventListener('click', (event) => {
            if (event.target.nodeName == 'A') {
                pinDfnPanel(dfnPanel);
            }
            event.stopPropagation();
        });

        dfnPanel.addEventListener('keydown', (event) => {
            if(event.keyCode == 27) { // Escape key
                hideDfnPanel(dfnPanel, dfn);
                event.stopPropagation();
                event.preventDefault();
            }
        })
    }
}
</script>
<script>/* Boilerplate: script-dfn-panel */
"use strict";
{
    const dfnsJson = window.dfnsJson || {};

    function genDfnPanel({dfnID, url, dfnText, refSections, external}) {
        return mk.aside({
            class: "dfn-panel",
            id: `infopanel-for-${dfnID}`,
            "data-for": dfnID,
            "aria-labelled-by":`infopaneltitle-for-${dfnID}`,
            },
            mk.span({id:`infopaneltitle-for-${dfnID}`, style:"display:none"},
                `Info about the '${dfnText}' ${external?"external":""} reference.`),
            mk.a({href:url}, url),
            mk.b({}, "Referenced in:"),
            mk.ul({},
                ...refSections.map(section=>
                    mk.li({},
                        ...section.refs.map((ref, refI)=>
                            [
                                mk.a({
                                    href: `#${ref.id}`
                                    },
                                    (refI == 0) ? section.title : `(${refI + 1})`
                                ),
                                " ",
                            ]
                        ),
                    ),
                ),
            ),
        );
    }

    function genAllDfnPanels() {
        for(const panelData of Object.values(window.dfnpanelData)) {
            const dfnID = panelData.dfnID;
            const dfn = document.getElementById(dfnID);
            if(!dfn) {
                console.log(`Can't find dfn#${dfnID}.`, panelData);
            } else {
                const panel = genDfnPanel(panelData);
                append(document.body, panel);
                insertDfnPopupAction(dfn, panel)
            }
        }
    }

    document.addEventListener("DOMContentLoaded", ()=>{
        genAllDfnPanels();

        // Add popup behavior to all dfns to show the corresponding dfn-panel.
        var dfns = queryAll('.dfn-paneled');
        for(let dfn of dfns) { ; }

        document.body.addEventListener("click", (e) => {
            // If not handled already, just hide all dfn panels.
            hideAllDfnPanels();
        });
    })


    function hideAllDfnPanels() {
        // Turn off any currently "on" or "activated" panels.
        queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(el=>hideDfnPanel(el));
    }

    function showDfnPanel(dfnPanel, dfn) {
        hideAllDfnPanels(); // Only display one at this time.
        dfn.setAttribute("aria-expanded", "true");
        dfnPanel.classList.add("on");
        dfnPanel.style.left = "5px";
        dfnPanel.style.top = "0px";
        const panelRect = dfnPanel.getBoundingClientRect();
        const panelWidth = panelRect.right - panelRect.left;
        if (panelRect.right > document.body.scrollWidth) {
            // Panel's overflowing the screen.
            // Just drop it below the dfn and flip it rightward instead.
            // This still wont' fix things if the screen is *really* wide,
            // but fixing that's a lot harder without 'anchor()'.
            dfnPanel.style.top = "1.5em";
            dfnPanel.style.left = "auto";
            dfnPanel.style.right = "0px";
        }
    }

    function pinDfnPanel(dfnPanel) {
        // Switch it to "activated" state, which pins it.
        dfnPanel.classList.add("activated");
        dfnPanel.style.left = null;
        dfnPanel.style.top = null;
    }

    function hideDfnPanel(dfnPanel, dfn) {
        if(!dfn) {
            dfn = document.getElementById(dfnPanel.getAttribute("data-for"));
        }
        dfn.setAttribute("aria-expanded", "false")
        dfnPanel.classList.remove("on");
        dfnPanel.classList.remove("activated");
    }

    function toggleDfnPanel(dfnPanel, dfn) {
        if(dfnPanel.classList.contains("on")) {
            hideDfnPanel(dfnPanel, dfn);
        } else {
            showDfnPanel(dfnPanel, dfn);
        }
    }

    function insertDfnPopupAction(dfn, dfnPanel) {
        // Find dfn panel
        const panelWrapper = document.createElement('span');
        panelWrapper.appendChild(dfnPanel);
        panelWrapper.style.position = "relative";
        panelWrapper.style.height = "0px";
        dfn.insertAdjacentElement("afterend", panelWrapper);
        dfn.setAttribute('role', 'button');
        dfn.setAttribute('aria-expanded', 'false')
        dfn.tabIndex = 0;
        dfn.classList.add('has-dfn-panel');
        dfn.addEventListener('click', (event) => {
            showDfnPanel(dfnPanel, dfn);
            event.stopPropagation();
        });
        dfn.addEventListener('keypress', (event) => {
            const kc = event.keyCode;
            // 32->Space, 13->Enter
            if(kc == 32 || kc == 13) {
                toggleDfnPanel(dfnPanel, dfn);
                event.stopPropagation();
                event.preventDefault();
            }
        });

        dfnPanel.addEventListener('click', (event) => {
            if (event.target.nodeName == 'A') {
                pinDfnPanel(dfnPanel);
            }
            event.stopPropagation();
        });

        dfnPanel.addEventListener('keydown', (event) => {
            if(event.keyCode == 27) { // Escape key
                hideDfnPanel(dfnPanel, dfn);
                event.stopPropagation();
                event.preventDefault();
            }
        })
    }
}
</script>
<script>/* Boilerplate: script-dfn-panel-json */
window.dfnpanelData = {};
window.dfnpanelData['b0f5bc03'] = {"dfnID": "b0f5bc03", "url": "https://w3c.github.io/webappsec-credential-management/#dom-credentialscontainer-create", "dfnText": "create()", "refSections": [{"refs": [{"id": "ref-for-dom-credentialscontainer-create"}], "title": "3. Registration"}, {"refs": [{"id": "ref-for-dom-credentialscontainer-create\u2460"}], "title": "5. WebAuthn Extension - \"payment\""}, {"refs": [{"id": "ref-for-dom-credentialscontainer-create\u2461"}], "title": "11.1. Registration in a Cross-Origin iframe"}], "external": true};
window.dfnpanelData['99134679'] = {"dfnID": "99134679", "url": "https://w3c.github.io/webappsec-credential-management/#dom-credentialscontainer-get", "dfnText": "get()", "refSections": [{"refs": [{"id": "ref-for-dom-credentialscontainer-get"}], "title": "5. WebAuthn Extension - \"payment\""}], "external": true};
window.dfnpanelData['cbdd0aff'] = {"dfnID": "cbdd0aff", "url": "https://w3c.github.io/webappsec-credential-management/#dom-credential-id", "dfnText": "id", "refSections": [{"refs": [{"id": "ref-for-dom-credential-id"}], "title": "8.1. Verifying an Authentication Assertion"}], "external": true};
window.dfnpanelData['fe4adbb9'] = {"dfnID": "fe4adbb9", "url": "https://w3c.github.io/webappsec-credential-management/#abstract-opdef-request-a-credential", "dfnText": "request a credential", "refSections": [{"refs": [{"id": "ref-for-abstract-opdef-request-a-credential"}, {"id": "ref-for-abstract-opdef-request-a-credential\u2460"}], "title": "4.1.11. Steps to respond to a payment request"}], "external": true};
window.dfnpanelData['8841d736'] = {"dfnID": "8841d736", "url": "https://tc39.github.io/ecma262/#sec-object-internal-methods-and-internal-slots", "dfnText": "internal method", "refSections": [{"refs": [{"id": "ref-for-sec-object-internal-methods-and-internal-slots"}], "title": "7. Permissions Policy integration"}], "external": true};
window.dfnpanelData['55213b5b'] = {"dfnID": "55213b5b", "url": "https://fetch.spec.whatwg.org/#concept-request", "dfnText": "request", "refSections": [{"refs": [{"id": "ref-for-concept-request"}], "title": "4.1.4. Modification of user activation requirement"}], "external": true};
window.dfnpanelData['aca22383'] = {"dfnID": "aca22383", "url": "https://html.spec.whatwg.org/multipage/interaction.html#consume-user-activation", "dfnText": "consume user activation", "refSections": [{"refs": [{"id": "ref-for-consume-user-activation"}], "title": "4.1.4. Modification of user activation requirement"}, {"refs": [{"id": "ref-for-consume-user-activation\u2460"}], "title": "5. WebAuthn Extension - \"payment\""}], "external": true};
window.dfnpanelData['12b8dfc0'] = {"dfnID": "12b8dfc0", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#current-settings-object", "dfnText": "current settings object", "refSections": [{"refs": [{"id": "ref-for-current-settings-object"}], "title": "7. Permissions Policy integration"}], "external": true};
window.dfnpanelData['a72449dd'] = {"dfnID": "a72449dd", "url": "https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel", "dfnText": "in parallel", "refSections": [{"refs": [{"id": "ref-for-in-parallel"}], "title": "7. Permissions Policy integration"}], "external": true};
window.dfnpanelData['086e3aff'] = {"dfnID": "086e3aff", "url": "https://html.spec.whatwg.org/multipage/browsers.html#concept-origin", "dfnText": "origin", "refSections": [{"refs": [{"id": "ref-for-concept-origin"}], "title": "4.1.5. SecurePaymentConfirmationRequest Dictionary"}], "external": true};
window.dfnpanelData['e99bd18e'] = {"dfnID": "e99bd18e", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global", "dfnText": "relevant global object", "refSections": [{"refs": [{"id": "ref-for-concept-relevant-global"}, {"id": "ref-for-concept-relevant-global\u2460"}], "title": "4.1.4. Modification of user activation requirement"}, {"refs": [{"id": "ref-for-concept-relevant-global\u2461"}, {"id": "ref-for-concept-relevant-global\u2462"}], "title": "5. WebAuthn Extension - \"payment\""}], "external": true};
window.dfnpanelData['9c4c1e66'] = {"dfnID": "9c4c1e66", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object", "dfnText": "relevant settings object", "refSections": [{"refs": [{"id": "ref-for-relevant-settings-object"}], "title": "4.1.11. Steps to respond to a payment request"}], "external": true};
window.dfnpanelData['dae0bfde'] = {"dfnID": "dae0bfde", "url": "https://html.spec.whatwg.org/multipage/browsers.html#ascii-serialisation-of-an-origin", "dfnText": "serialization of an origin", "refSections": [{"refs": [{"id": "ref-for-ascii-serialisation-of-an-origin"}], "title": "4.1.9. Steps to check if a payment can be made"}], "external": true};
window.dfnpanelData['c63519ed'] = {"dfnID": "c63519ed", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-top-level-origin", "dfnText": "top-level origin", "refSections": [{"refs": [{"id": "ref-for-concept-environment-top-level-origin"}], "title": "4.1.11. Steps to respond to a payment request"}], "external": true};
window.dfnpanelData['47fe679e'] = {"dfnID": "47fe679e", "url": "https://html.spec.whatwg.org/multipage/interaction.html#transient-activation", "dfnText": "transient activation", "refSections": [{"refs": [{"id": "ref-for-transient-activation"}], "title": "4.1.4. Modification of user activation requirement"}, {"refs": [{"id": "ref-for-transient-activation\u2460"}, {"id": "ref-for-transient-activation\u2461"}], "title": "5. WebAuthn Extension - \"payment\""}, {"refs": [{"id": "ref-for-transient-activation\u2462"}], "title": "11.1. Registration in a Cross-Origin iframe"}], "external": true};
window.dfnpanelData['2ba936be'] = {"dfnID": "2ba936be", "url": "https://w3c.github.io/i18n-glossary/#dfn-bidi-isolation", "dfnText": "bidi isolation", "refSections": [{"refs": [{"id": "ref-for-dfn-bidi-isolation"}], "title": "13. Internationalization Considerations"}], "external": true};
window.dfnpanelData['6d26b819'] = {"dfnID": "6d26b819", "url": "https://w3c.github.io/i18n-glossary/#dfn-language-negotiation", "dfnText": "language negotiation", "refSections": [{"refs": [{"id": "ref-for-dfn-language-negotiation"}], "title": "4.1.5. SecurePaymentConfirmationRequest Dictionary"}], "external": true};
window.dfnpanelData['30eadef0'] = {"dfnID": "30eadef0", "url": "https://w3c.github.io/i18n-glossary/#dfn-language-priority-list", "dfnText": "language priority list", "refSections": [{"refs": [{"id": "ref-for-dfn-language-priority-list"}], "title": "4.1.5. SecurePaymentConfirmationRequest Dictionary"}], "external": true};
window.dfnpanelData['16ad0fd2'] = {"dfnID": "16ad0fd2", "url": "https://www.w3.org/TR/i18n-glossary/#dfn-locale", "dfnText": "locale", "refSections": [{"refs": [{"id": "ref-for-dfn-locale"}], "title": "4.1.5. SecurePaymentConfirmationRequest Dictionary"}, {"refs": [{"id": "ref-for-dfn-locale\u2460"}], "title": "13. Internationalization Considerations"}], "external": true};
window.dfnpanelData['502ee54a'] = {"dfnID": "502ee54a", "url": "https://w3c.github.io/image-resource/#dfn-fetching-an-image-resource", "dfnText": "fetching an image resource", "refSections": [{"refs": [{"id": "ref-for-dfn-fetching-an-image-resource"}], "title": "4.1.9. Steps to check if a payment can be made"}], "external": true};
window.dfnpanelData['e8aa4aef'] = {"dfnID": "e8aa4aef", "url": "https://w3c.github.io/image-resource/#dom-imageresource-src", "dfnText": "src", "refSections": [{"refs": [{"id": "ref-for-dom-imageresource-src"}], "title": "4.1.9. Steps to check if a payment can be made"}], "external": true};
window.dfnpanelData['53275e46'] = {"dfnID": "53275e46", "url": "https://infra.spec.whatwg.org/#list-append", "dfnText": "append", "refSections": [{"refs": [{"id": "ref-for-list-append"}], "title": "4.1.11. Steps to respond to a payment request"}], "external": true};
window.dfnpanelData['1a0d3ec4'] = {"dfnID": "1a0d3ec4", "url": "https://w3c.github.io/payment-method-id/#registry", "dfnText": "registry of standardized payment methods", "refSections": [{"refs": [{"id": "ref-for-registry"}], "title": "4.1.2. Registration in [payment-method-id]"}], "external": true};
window.dfnpanelData['7ab3c32e'] = {"dfnID": "7ab3c32e", "url": "https://w3c.github.io/payment-method-id/#dfn-standardized-payment-method-identifier", "dfnText": "standardized payment method identifier", "refSections": [{"refs": [{"id": "ref-for-dfn-standardized-payment-method-identifier"}], "title": "4.1.1. Payment Method Identifier"}], "external": true};
window.dfnpanelData['75f46ef4'] = {"dfnID": "75f46ef4", "url": "https://w3c.github.io/payment-request/#dfn-payment-method", "dfnText": "payment method", "refSections": [{"refs": [{"id": "ref-for-dfn-payment-method"}], "title": "1. Introduction"}, {"refs": [{"id": "ref-for-dfn-payment-method\u2460"}], "title": "4. Authentication"}], "external": true};
window.dfnpanelData['87335f73'] = {"dfnID": "87335f73", "url": "https://w3c.github.io/payment-request/#dfn-additional-data-type", "dfnText": "payment method additional data type", "refSections": [{"refs": [{"id": "ref-for-dfn-additional-data-type"}], "title": "4.1.6. Payment Method additional data type"}], "external": true};
window.dfnpanelData['dc24f2fe'] = {"dfnID": "dc24f2fe", "url": "https://w3c.github.io/payment-request/#dfn-payment", "dfnText": "payment permission string", "refSections": [{"refs": [{"id": "ref-for-dfn-payment"}], "title": "1.2.1. Registration during a checkout"}, {"refs": [{"id": "ref-for-dfn-payment\u2460"}], "title": "7. Permissions Policy integration"}, {"refs": [{"id": "ref-for-dfn-payment\u2461"}], "title": "11.1. Registration in a Cross-Origin iframe"}], "external": true};
window.dfnpanelData['60fc1ac5'] = {"dfnID": "60fc1ac5", "url": "https://w3c.github.io/payment-request/#accessibility-considerations", "dfnText": "payment request accessibility considerations", "refSections": [{"refs": [{"id": "ref-for-accessibility-considerations"}], "title": "12. Accessibility Considerations"}], "external": true};
window.dfnpanelData['b29c33d9'] = {"dfnID": "b29c33d9", "url": "https://w3c.github.io/payment-request/#dfn-details", "dfnText": "payment request details", "refSections": [{"refs": [{"id": "ref-for-dfn-details"}], "title": "4.1.11. Steps to respond to a payment request"}], "external": true};
window.dfnpanelData['02f7d0f9'] = {"dfnID": "02f7d0f9", "url": "https://w3c.github.io/payment-request/#dfn-steps-to-check-if-a-payment-can-be-made", "dfnText": "steps to check if a payment can be made", "refSections": [{"refs": [{"id": "ref-for-dfn-steps-to-check-if-a-payment-can-be-made"}], "title": "4.1.9. Steps to check if a payment can be made"}], "external": true};
window.dfnpanelData['559656f0'] = {"dfnID": "559656f0", "url": "https://w3c.github.io/payment-request/#dfn-steps-to-respond-to-a-payment-request", "dfnText": "steps to respond to a payment request", "refSections": [{"refs": [{"id": "ref-for-dfn-steps-to-respond-to-a-payment-request"}], "title": "4.1.11. Steps to respond to a payment request"}], "external": true};
window.dfnpanelData['ba4dacbc'] = {"dfnID": "ba4dacbc", "url": "https://w3c.github.io/payment-request/#dfn-steps-to-validate-payment-method-data", "dfnText": "steps to validate payment method data", "refSections": [{"refs": [{"id": "ref-for-dfn-steps-to-validate-payment-method-data"}], "title": "4.1.8. Steps to validate payment method data"}], "external": true};
window.dfnpanelData['0d174a15'] = {"dfnID": "0d174a15", "url": "https://w3c.github.io/payment-request/#dom-paymentcurrencyamount", "dfnText": "PaymentCurrencyAmount", "refSections": [{"refs": [{"id": "ref-for-dom-paymentcurrencyamount"}, {"id": "ref-for-dom-paymentcurrencyamount\u2460"}], "title": "5. WebAuthn Extension - \"payment\""}, {"refs": [{"id": "ref-for-dom-paymentcurrencyamount\u2461"}, {"id": "ref-for-dom-paymentcurrencyamount\u2462"}, {"id": "ref-for-dom-paymentcurrencyamount\u2463"}], "title": "5.2. CollectedClientAdditionalPaymentData Dictionary"}], "external": true};
window.dfnpanelData['f679a0bc'] = {"dfnID": "f679a0bc", "url": "https://w3c.github.io/payment-request/#dom-paymentrequest", "dfnText": "PaymentRequest", "refSections": [{"refs": [{"id": "ref-for-dom-paymentrequest"}], "title": "1. Introduction"}, {"refs": [{"id": "ref-for-dom-paymentrequest\u2460"}, {"id": "ref-for-dom-paymentrequest\u2461"}], "title": "4.1.7. Checking if Secure Payment Confirmation is available"}, {"refs": [{"id": "ref-for-dom-paymentrequest\u2462"}], "title": "4.1.11. Steps to respond to a payment request"}, {"refs": [{"id": "ref-for-dom-paymentrequest\u2463"}], "title": "5. WebAuthn Extension - \"payment\""}], "external": true};
window.dfnpanelData['dd8fd6f0'] = {"dfnID": "dd8fd6f0", "url": "https://w3c.github.io/payment-request/#dom-paymentrequest-canmakepayment", "dfnText": "canMakePayment()", "refSections": [{"refs": [{"id": "ref-for-dom-paymentrequest-canmakepayment"}], "title": "4.1.7. Checking if Secure Payment Confirmation is available"}], "external": true};
window.dfnpanelData['999d5cb6'] = {"dfnID": "999d5cb6", "url": "https://w3c.github.io/payment-request/#dom-paymentrequest-constructor", "dfnText": "constructor()", "refSections": [{"refs": [{"id": "ref-for-dom-paymentrequest-constructor"}], "title": "4.1.3. Modification of Payment Request constructor"}], "external": true};
window.dfnpanelData['df23dd0d'] = {"dfnID": "df23dd0d", "url": "https://w3c.github.io/payment-request/#dom-paymentcurrencyamount-currency", "dfnText": "currency", "refSections": [{"refs": [{"id": "ref-for-dom-paymentcurrencyamount-currency"}], "title": "4.1.10. Displaying a transaction confirmation UX"}], "external": true};
window.dfnpanelData['22176f90'] = {"dfnID": "22176f90", "url": "https://w3c.github.io/payment-request/#dfn-payment-handler", "dfnText": "payment handler", "refSections": [{"refs": [{"id": "ref-for-dfn-payment-handler"}], "title": "4.1. Payment Method: Secure Payment Confirmation"}], "external": true};
window.dfnpanelData['ab86e0f1'] = {"dfnID": "ab86e0f1", "url": "https://w3c.github.io/payment-request/#dom-paymentrequest-show", "dfnText": "show()", "refSections": [{"refs": [{"id": "ref-for-dom-paymentrequest-show"}], "title": "4.1.4. Modification of user activation requirement"}, {"refs": [{"id": "ref-for-dom-paymentrequest-show\u2460"}], "title": "4.1.9. Steps to check if a payment can be made"}, {"refs": [{"id": "ref-for-dom-paymentrequest-show\u2461"}, {"id": "ref-for-dom-paymentrequest-show\u2462"}], "title": "4.1.10. Displaying a transaction confirmation UX"}, {"refs": [{"id": "ref-for-dom-paymentrequest-show\u2463"}], "title": "10.3. Lack of user activation requirement"}], "external": true};
window.dfnpanelData['3230704c'] = {"dfnID": "3230704c", "url": "https://w3c.github.io/payment-request/#dom-paymentdetailsinit-total", "dfnText": "total", "refSections": [{"refs": [{"id": "ref-for-dom-paymentdetailsinit-total"}], "title": "4.1.11. Steps to respond to a payment request"}], "external": true};
window.dfnpanelData['5f695b8a'] = {"dfnID": "5f695b8a", "url": "https://w3c.github.io/payment-request/#dom-paymentcurrencyamount-value", "dfnText": "value", "refSections": [{"refs": [{"id": "ref-for-dom-paymentcurrencyamount-value"}], "title": "4.1.10. Displaying a transaction confirmation UX"}], "external": true};
window.dfnpanelData['959ad97b'] = {"dfnID": "959ad97b", "url": "https://url.spec.whatwg.org/#concept-url-origin", "dfnText": "origin", "refSections": [{"refs": [{"id": "ref-for-concept-url-origin"}], "title": "4.1.9. Steps to check if a payment can be made"}], "external": true};
window.dfnpanelData['3a711be7'] = {"dfnID": "3a711be7", "url": "https://url.spec.whatwg.org/#concept-url-scheme", "dfnText": "scheme", "refSections": [{"refs": [{"id": "ref-for-concept-url-scheme"}], "title": "4.1.8. Steps to validate payment method data"}, {"refs": [{"id": "ref-for-concept-url-scheme\u2460"}], "title": "4.1.9. Steps to check if a payment can be made"}], "external": true};
window.dfnpanelData['ca3ca4ae'] = {"dfnID": "ca3ca4ae", "url": "https://url.spec.whatwg.org/#concept-url-parser", "dfnText": "url parser", "refSections": [{"refs": [{"id": "ref-for-concept-url-parser"}], "title": "4.1.8. Steps to validate payment method data"}, {"refs": [{"id": "ref-for-concept-url-parser\u2460"}], "title": "4.1.9. Steps to check if a payment can be made"}], "external": true};
window.dfnpanelData['79cad4dd'] = {"dfnID": "79cad4dd", "url": "https://url.spec.whatwg.org/#valid-domain", "dfnText": "valid domain", "refSections": [{"refs": [{"id": "ref-for-valid-domain"}], "title": "4.1.8. Steps to validate payment method data"}], "external": true};
window.dfnpanelData['8f3d2845'] = {"dfnID": "8f3d2845", "url": "https://w3c.github.io/webauthn/#authentication-ceremony", "dfnText": "authentication ceremony", "refSections": [{"refs": [{"id": "ref-for-authentication-ceremony"}], "title": "4. Authentication"}, {"refs": [{"id": "ref-for-authentication-ceremony\u2460"}], "title": "8.1. Verifying an Authentication Assertion"}], "external": true};
window.dfnpanelData['9c64cd22'] = {"dfnID": "9c64cd22", "url": "https://w3c.github.io/webauthn/#authentication-extension", "dfnText": "authentication extension", "refSections": [{"refs": [{"id": "ref-for-authentication-extension"}, {"id": "ref-for-authentication-extension\u2460"}, {"id": "ref-for-authentication-extension\u2461"}], "title": "5. WebAuthn Extension - \"payment\""}], "external": true};
window.dfnpanelData['88ae1d28'] = {"dfnID": "88ae1d28", "url": "https://w3c.github.io/webauthn/#client-extension", "dfnText": "client extension", "refSections": [{"refs": [{"id": "ref-for-client-extension"}], "title": "5. WebAuthn Extension - \"payment\""}], "external": true};
window.dfnpanelData['e4d7113a'] = {"dfnID": "e4d7113a", "url": "https://w3c.github.io/webauthn/#credential-id", "dfnText": "credential id", "refSections": [{"refs": [{"id": "ref-for-credential-id"}, {"id": "ref-for-credential-id\u2460"}], "title": "2. Terminology"}], "external": true};
window.dfnpanelData['3781d718'] = {"dfnID": "3781d718", "url": "https://w3c.github.io/webauthn/#discoverable-credential", "dfnText": "discoverable credential", "refSections": [{"refs": [{"id": "ref-for-discoverable-credential"}], "title": "2. Terminology"}], "external": true};
window.dfnpanelData['b6a00a38'] = {"dfnID": "b6a00a38", "url": "https://w3c.github.io/webauthn/#extension-identifier", "dfnText": "extension identifier", "refSections": [{"refs": [{"id": "ref-for-extension-identifier"}], "title": "14. IANA Considerations"}], "external": true};
window.dfnpanelData['fe1cbc76'] = {"dfnID": "fe1cbc76", "url": "https://w3c.github.io/webauthn/#public-key-credential", "dfnText": "public key credential", "refSections": [{"refs": [{"id": "ref-for-public-key-credential"}, {"id": "ref-for-public-key-credential\u2460"}], "title": "2. Terminology"}, {"refs": [{"id": "ref-for-public-key-credential\u2461"}], "title": "11.2. Probing for credential ids"}], "external": true};
window.dfnpanelData['5d6beb3a'] = {"dfnID": "5d6beb3a", "url": "https://w3c.github.io/webauthn/#registration-extension", "dfnText": "registration extension", "refSections": [{"refs": [{"id": "ref-for-registration-extension"}, {"id": "ref-for-registration-extension\u2460"}, {"id": "ref-for-registration-extension\u2461"}], "title": "5. WebAuthn Extension - \"payment\""}], "external": true};
window.dfnpanelData['77a62788'] = {"dfnID": "77a62788", "url": "https://w3c.github.io/webauthn/#relying-party", "dfnText": "relying party", "refSections": [{"refs": [{"id": "ref-for-relying-party"}, {"id": "ref-for-relying-party\u2460"}, {"id": "ref-for-relying-party\u2461"}, {"id": "ref-for-relying-party\u2462"}, {"id": "ref-for-relying-party\u2463"}], "title": "1. Introduction"}, {"refs": [{"id": "ref-for-relying-party\u2464"}], "title": "1.1.1. Cryptographic evidence of transaction confirmation"}, {"refs": [{"id": "ref-for-relying-party\u2465"}], "title": "1.1.2. Registration in a third-party iframe"}, {"refs": [{"id": "ref-for-relying-party\u2466"}, {"id": "ref-for-relying-party\u2467"}, {"id": "ref-for-relying-party\u2468"}], "title": "1.1.3. Merchant control of authentication"}, {"refs": [{"id": "ref-for-relying-party\u2460\u24ea"}, {"id": "ref-for-relying-party\u2460\u2460"}, {"id": "ref-for-relying-party\u2460\u2461"}, {"id": "ref-for-relying-party\u2460\u2462"}, {"id": "ref-for-relying-party\u2460\u2463"}], "title": "2. Terminology"}, {"refs": [{"id": "ref-for-relying-party\u2460\u2464"}], "title": "4. Authentication"}, {"refs": [{"id": "ref-for-relying-party\u2460\u2465"}], "title": "4.1.10. Displaying a transaction confirmation UX"}, {"refs": [{"id": "ref-for-relying-party\u2460\u2466"}, {"id": "ref-for-relying-party\u2460\u2467"}], "title": "5. WebAuthn Extension - \"payment\""}, {"refs": [{"id": "ref-for-relying-party\u2460\u2468"}], "title": "5.2. CollectedClientAdditionalPaymentData Dictionary"}, {"refs": [{"id": "ref-for-relying-party\u2461\u24ea"}, {"id": "ref-for-relying-party\u2461\u2460"}], "title": "6.1. PaymentCredentialInstrument Dictionary"}, {"refs": [{"id": "ref-for-relying-party\u2461\u2461"}, {"id": "ref-for-relying-party\u2461\u2462"}, {"id": "ref-for-relying-party\u2461\u2463"}, {"id": "ref-for-relying-party\u2461\u2464"}, {"id": "ref-for-relying-party\u2461\u2465"}, {"id": "ref-for-relying-party\u2461\u2466"}, {"id": "ref-for-relying-party\u2461\u2467"}, {"id": "ref-for-relying-party\u2461\u2468"}], "title": "8.1. Verifying an Authentication Assertion"}, {"refs": [{"id": "ref-for-relying-party\u2462\u24ea"}, {"id": "ref-for-relying-party\u2462\u2460"}], "title": "10.1. Cross-origin authentication ceremony"}, {"refs": [{"id": "ref-for-relying-party\u2462\u2461"}, {"id": "ref-for-relying-party\u2462\u2462"}, {"id": "ref-for-relying-party\u2462\u2463"}, {"id": "ref-for-relying-party\u2462\u2464"}, {"id": "ref-for-relying-party\u2462\u2465"}, {"id": "ref-for-relying-party\u2462\u2466"}, {"id": "ref-for-relying-party\u2462\u2467"}], "title": "10.1.1. Login Attack"}, {"refs": [{"id": "ref-for-relying-party\u2462\u2468"}, {"id": "ref-for-relying-party\u2463\u24ea"}, {"id": "ref-for-relying-party\u2463\u2460"}], "title": "10.1.2. Payment Attack"}, {"refs": [{"id": "ref-for-relying-party\u2463\u2461"}, {"id": "ref-for-relying-party\u2463\u2462"}], "title": "10.2. Merchant-supplied authentication data"}, {"refs": [{"id": "ref-for-relying-party\u2463\u2463"}, {"id": "ref-for-relying-party\u2463\u2464"}], "title": "11.2. Probing for credential ids"}, {"refs": [{"id": "ref-for-relying-party\u2463\u2465"}, {"id": "ref-for-relying-party\u2463\u2466"}, {"id": "ref-for-relying-party\u2463\u2467"}, {"id": "ref-for-relying-party\u2463\u2468"}, {"id": "ref-for-relying-party\u2464\u24ea"}], "title": "11.3. Joining different payment instruments"}, {"refs": [{"id": "ref-for-relying-party\u2464\u2460"}, {"id": "ref-for-relying-party\u2464\u2461"}, {"id": "ref-for-relying-party\u2464\u2462"}], "title": "11.4. Credential ID(s) as a tracking vector"}], "external": true};
window.dfnpanelData['c92c9b81'] = {"dfnID": "c92c9b81", "url": "https://w3c.github.io/webauthn/#relying-party-identifier", "dfnText": "relying party identifier", "refSections": [{"refs": [{"id": "ref-for-relying-party-identifier"}, {"id": "ref-for-relying-party-identifier\u2460"}], "title": "2. Terminology"}, {"refs": [{"id": "ref-for-relying-party-identifier\u2461"}], "title": "4.1.5. SecurePaymentConfirmationRequest Dictionary"}], "external": true};
window.dfnpanelData['c7e62ce0'] = {"dfnID": "c7e62ce0", "url": "https://w3c.github.io/webauthn/#dom-publickeycredentialcreationoptions-user", "dfnText": "user member", "refSections": [{"refs": [{"id": "ref-for-dom-publickeycredentialcreationoptions-user"}], "title": "3. Registration"}], "external": true};
window.dfnpanelData['2e3d2880'] = {"dfnID": "2e3d2880", "url": "https://w3c.github.io/webauthn/#webauthn-extensions", "dfnText": "webauthn extension", "refSections": [{"refs": [{"id": "ref-for-webauthn-extensions"}], "title": "1. Introduction"}, {"refs": [{"id": "ref-for-webauthn-extensions\u2460"}], "title": "3. Registration"}, {"refs": [{"id": "ref-for-webauthn-extensions\u2461"}], "title": "4.1.5. SecurePaymentConfirmationRequest Dictionary"}], "external": true};
window.dfnpanelData['b6db798e'] = {"dfnID": "b6db798e", "url": "https://w3c.github.io/webauthn/#dictdef-authenticationextensionsclientinputs", "dfnText": "AuthenticationExtensionsClientInputs", "refSections": [{"refs": [{"id": "ref-for-dictdef-authenticationextensionsclientinputs"}, {"id": "ref-for-dictdef-authenticationextensionsclientinputs\u2460"}], "title": "4.1.5. SecurePaymentConfirmationRequest Dictionary"}, {"refs": [{"id": "ref-for-dictdef-authenticationextensionsclientinputs\u2461"}], "title": "4.1.11. Steps to respond to a payment request"}, {"refs": [{"id": "ref-for-dictdef-authenticationextensionsclientinputs\u2462"}], "title": "5. WebAuthn Extension - \"payment\""}], "external": true};
window.dfnpanelData['8e16d894'] = {"dfnID": "8e16d894", "url": "https://w3c.github.io/webauthn/#dictdef-collectedclientdata", "dfnText": "CollectedClientData", "refSections": [{"refs": [{"id": "ref-for-dictdef-collectedclientdata"}], "title": "1.1.1. Cryptographic evidence of transaction confirmation"}, {"refs": [{"id": "ref-for-dictdef-collectedclientdata\u2460"}], "title": "5. WebAuthn Extension - \"payment\""}, {"refs": [{"id": "ref-for-dictdef-collectedclientdata\u2461"}, {"id": "ref-for-dictdef-collectedclientdata\u2462"}], "title": "5.1. CollectedClientPaymentData Dictionary"}, {"refs": [{"id": "ref-for-dictdef-collectedclientdata\u2463"}], "title": "5.2. CollectedClientAdditionalPaymentData Dictionary"}, {"refs": [{"id": "ref-for-dictdef-collectedclientdata\u2464"}, {"id": "ref-for-dictdef-collectedclientdata\u2465"}, {"id": "ref-for-dictdef-collectedclientdata\u2466"}], "title": "10.1.1. Login Attack"}, {"refs": [{"id": "ref-for-dictdef-collectedclientdata\u2467"}, {"id": "ref-for-dictdef-collectedclientdata\u2468"}], "title": "10.1.2. Payment Attack"}], "external": true};
window.dfnpanelData['91d31374'] = {"dfnID": "91d31374", "url": "https://w3c.github.io/webauthn/#publickeycredential", "dfnText": "PublicKeyCredential", "refSections": [{"refs": [{"id": "ref-for-publickeycredential"}], "title": "8.1. Verifying an Authentication Assertion"}], "external": true};
window.dfnpanelData['dff7edfa'] = {"dfnID": "dff7edfa", "url": "https://w3c.github.io/webauthn/#dictdef-publickeycredentialdescriptor", "dfnText": "PublicKeyCredentialDescriptor", "refSections": [{"refs": [{"id": "ref-for-dictdef-publickeycredentialdescriptor"}], "title": "4.1.11. Steps to respond to a payment request"}], "external": true};
window.dfnpanelData['612eb719'] = {"dfnID": "612eb719", "url": "https://w3c.github.io/webauthn/#dictdef-publickeycredentialrequestoptions", "dfnText": "PublicKeyCredentialRequestOptions", "refSections": [{"refs": [{"id": "ref-for-dictdef-publickeycredentialrequestoptions"}], "title": "4.1.11. Steps to respond to a payment request"}], "external": true};
window.dfnpanelData['dd14e576'] = {"dfnID": "dd14e576", "url": "https://w3c.github.io/webauthn/#dom-publickeycredential-create-slot", "dfnText": "[[Create]](origin, options, sameOriginWithAncestors)", "refSections": [{"refs": [{"id": "ref-for-dom-publickeycredential-create-slot"}], "title": "7. Permissions Policy integration"}], "external": true};
window.dfnpanelData['3146e9fe'] = {"dfnID": "3146e9fe", "url": "https://w3c.github.io/webauthn/#dom-publickeycredential-discoverfromexternalsource-slot", "dfnText": "[[DiscoverFromExternalSource]](origin, options, sameOriginWithAncestors)", "refSections": [{"refs": [{"id": "ref-for-dom-publickeycredential-discoverfromexternalsource-slot"}], "title": "5. WebAuthn Extension - \"payment\""}, {"refs": [{"id": "ref-for-dom-publickeycredential-discoverfromexternalsource-slot\u2460"}], "title": "7. Permissions Policy integration"}], "external": true};
window.dfnpanelData['6f6046b7'] = {"dfnID": "6f6046b7", "url": "https://w3c.github.io/webauthn/#dom-publickeycredentialrequestoptions-allowcredentials", "dfnText": "allowCredentials", "refSections": [{"refs": [{"id": "ref-for-dom-publickeycredentialrequestoptions-allowcredentials"}], "title": "4.1.11. Steps to respond to a payment request"}], "external": true};
window.dfnpanelData['57afee2f'] = {"dfnID": "57afee2f", "url": "https://w3c.github.io/webauthn/#dom-authenticatorselectioncriteria-authenticatorattachment", "dfnText": "authenticatorAttachment", "refSections": [{"refs": [{"id": "ref-for-dom-authenticatorselectioncriteria-authenticatorattachment"}], "title": "5. WebAuthn Extension - \"payment\""}], "external": true};
window.dfnpanelData['5a486d64'] = {"dfnID": "5a486d64", "url": "https://w3c.github.io/webauthn/#dom-publickeycredentialcreationoptions-authenticatorselection", "dfnText": "authenticatorSelection", "refSections": [{"refs": [{"id": "ref-for-dom-publickeycredentialcreationoptions-authenticatorselection"}, {"id": "ref-for-dom-publickeycredentialcreationoptions-authenticatorselection\u2460"}, {"id": "ref-for-dom-publickeycredentialcreationoptions-authenticatorselection\u2461"}], "title": "5. WebAuthn Extension - \"payment\""}], "external": true};
window.dfnpanelData['0624097e'] = {"dfnID": "0624097e", "url": "https://w3c.github.io/webauthn/#dom-collectedclientdata-challenge", "dfnText": "challenge (for CollectedClientData)", "refSections": [{"refs": [{"id": "ref-for-dom-collectedclientdata-challenge"}], "title": "8.1. Verifying an Authentication Assertion"}, {"refs": [{"id": "ref-for-dom-collectedclientdata-challenge\u2460"}], "title": "10.1.1. Login Attack"}, {"refs": [{"id": "ref-for-dom-collectedclientdata-challenge\u2461"}], "title": "10.1.2. Payment Attack"}], "external": true};
window.dfnpanelData['7a83f58e'] = {"dfnID": "7a83f58e", "url": "https://w3c.github.io/webauthn/#dom-publickeycredentialrequestoptions-challenge", "dfnText": "challenge (for PublicKeyCredentialRequestOptions)", "refSections": [{"refs": [{"id": "ref-for-dom-publickeycredentialrequestoptions-challenge"}], "title": "1.1.1. Cryptographic evidence of transaction confirmation"}, {"refs": [{"id": "ref-for-dom-publickeycredentialrequestoptions-challenge\u2460"}], "title": "4.1.11. Steps to respond to a payment request"}], "external": true};
window.dfnpanelData['853b63e3'] = {"dfnID": "853b63e3", "url": "https://w3c.github.io/webauthn/#dom-publickeycredentialuserentity-displayname", "dfnText": "displayName", "refSections": [{"refs": [{"id": "ref-for-dom-publickeycredentialuserentity-displayname"}], "title": "3. Registration"}], "external": true};
window.dfnpanelData['af57cf45'] = {"dfnID": "af57cf45", "url": "https://w3c.github.io/webauthn/#dom-publickeycredentialrequestoptions-extensions", "dfnText": "extensions", "refSections": [{"refs": [{"id": "ref-for-dom-publickeycredentialrequestoptions-extensions"}], "title": "4.1.11. Steps to respond to a payment request"}], "external": true};
window.dfnpanelData['82de8c4b'] = {"dfnID": "82de8c4b", "url": "https://w3c.github.io/webauthn/#dom-publickeycredentialdescriptor-id", "dfnText": "id", "refSections": [{"refs": [{"id": "ref-for-dom-publickeycredentialdescriptor-id"}], "title": "4.1.11. Steps to respond to a payment request"}], "external": true};
window.dfnpanelData['447b180f'] = {"dfnID": "447b180f", "url": "https://w3c.github.io/webauthn/#dom-authenticatortransport-internal", "dfnText": "internal", "refSections": [{"refs": [{"id": "ref-for-dom-authenticatortransport-internal"}], "title": "4.1.11. Steps to respond to a payment request"}], "external": true};
window.dfnpanelData['5f03b645'] = {"dfnID": "5f03b645", "url": "https://w3c.github.io/webauthn/#dom-publickeycredentialentity-name", "dfnText": "name", "refSections": [{"refs": [{"id": "ref-for-dom-publickeycredentialentity-name"}, {"id": "ref-for-dom-publickeycredentialentity-name\u2460"}], "title": "3. Registration"}], "external": true};
window.dfnpanelData['221df805'] = {"dfnID": "221df805", "url": "https://w3c.github.io/webauthn/#dom-collectedclientdata-origin", "dfnText": "origin", "refSections": [{"refs": [{"id": "ref-for-dom-collectedclientdata-origin"}], "title": "8.1. Verifying an Authentication Assertion"}, {"refs": [{"id": "ref-for-dom-collectedclientdata-origin\u2460"}], "title": "10.1.1. Login Attack"}, {"refs": [{"id": "ref-for-dom-collectedclientdata-origin\u2461"}], "title": "10.1.2. Payment Attack"}], "external": true};
window.dfnpanelData['2c8910a4'] = {"dfnID": "2c8910a4", "url": "https://w3c.github.io/webauthn/#dom-authenticatorattachment-platform", "dfnText": "platform", "refSections": [{"refs": [{"id": "ref-for-dom-authenticatorattachment-platform"}], "title": "5. WebAuthn Extension - \"payment\""}], "external": true};
window.dfnpanelData['a7e81336'] = {"dfnID": "a7e81336", "url": "https://w3c.github.io/webauthn/#dom-residentkeyrequirement-preferred", "dfnText": "preferred", "refSections": [{"refs": [{"id": "ref-for-dom-residentkeyrequirement-preferred"}], "title": "5. WebAuthn Extension - \"payment\""}], "external": true};
window.dfnpanelData['9dd3f517'] = {"dfnID": "9dd3f517", "url": "https://w3c.github.io/webauthn/#dom-publickeycredentialtype-public-key", "dfnText": "public-key", "refSections": [{"refs": [{"id": "ref-for-dom-publickeycredentialtype-public-key"}], "title": "4.1.11. Steps to respond to a payment request"}], "external": true};
window.dfnpanelData['bd0c1062'] = {"dfnID": "bd0c1062", "url": "https://w3c.github.io/webauthn/#dom-credentialrequestoptions-publickey", "dfnText": "publicKey", "refSections": [{"refs": [{"id": "ref-for-dom-credentialrequestoptions-publickey"}], "title": "4.1.11. Steps to respond to a payment request"}], "external": true};
window.dfnpanelData['cc58e2fc'] = {"dfnID": "cc58e2fc", "url": "https://w3c.github.io/webauthn/#dom-residentkeyrequirement-required", "dfnText": "required (for ResidentKeyRequirement)", "refSections": [{"refs": [{"id": "ref-for-dom-residentkeyrequirement-required"}], "title": "5. WebAuthn Extension - \"payment\""}], "external": true};
window.dfnpanelData['b8c02d5c'] = {"dfnID": "b8c02d5c", "url": "https://w3c.github.io/webauthn/#dom-userverificationrequirement-required", "dfnText": "required (for UserVerificationRequirement)", "refSections": [{"refs": [{"id": "ref-for-dom-userverificationrequirement-required"}], "title": "4.1.11. Steps to respond to a payment request"}, {"refs": [{"id": "ref-for-dom-userverificationrequirement-required\u2460"}], "title": "5. WebAuthn Extension - \"payment\""}], "external": true};
window.dfnpanelData['3dd57d47'] = {"dfnID": "3dd57d47", "url": "https://w3c.github.io/webauthn/#dom-authenticatorselectioncriteria-residentkey", "dfnText": "residentKey", "refSections": [{"refs": [{"id": "ref-for-dom-authenticatorselectioncriteria-residentkey"}], "title": "5. WebAuthn Extension - \"payment\""}], "external": true};
window.dfnpanelData['dafe96b4'] = {"dfnID": "dafe96b4", "url": "https://w3c.github.io/webauthn/#dom-publickeycredentialrequestoptions-rpid", "dfnText": "rpId", "refSections": [{"refs": [{"id": "ref-for-dom-publickeycredentialrequestoptions-rpid"}], "title": "4.1.11. Steps to respond to a payment request"}], "external": true};
window.dfnpanelData['39e227ac'] = {"dfnID": "39e227ac", "url": "https://w3c.github.io/webauthn/#dom-publickeycredentialrequestoptions-timeout", "dfnText": "timeout", "refSections": [{"refs": [{"id": "ref-for-dom-publickeycredentialrequestoptions-timeout"}], "title": "4.1.11. Steps to respond to a payment request"}], "external": true};
window.dfnpanelData['d826f552'] = {"dfnID": "d826f552", "url": "https://w3c.github.io/webauthn/#dom-publickeycredentialdescriptor-transports", "dfnText": "transports", "refSections": [{"refs": [{"id": "ref-for-dom-publickeycredentialdescriptor-transports"}], "title": "4.1.11. Steps to respond to a payment request"}], "external": true};
window.dfnpanelData['870a9cbb'] = {"dfnID": "870a9cbb", "url": "https://w3c.github.io/webauthn/#dom-collectedclientdata-type", "dfnText": "type (for CollectedClientData)", "refSections": [{"refs": [{"id": "ref-for-dom-collectedclientdata-type"}], "title": "5. WebAuthn Extension - \"payment\""}, {"refs": [{"id": "ref-for-dom-collectedclientdata-type\u2460"}], "title": "8.1. Verifying an Authentication Assertion"}, {"refs": [{"id": "ref-for-dom-collectedclientdata-type\u2461"}], "title": "10.1.1. Login Attack"}], "external": true};
window.dfnpanelData['f580b6a5'] = {"dfnID": "f580b6a5", "url": "https://w3c.github.io/webauthn/#dom-publickeycredentialdescriptor-type", "dfnText": "type (for PublicKeyCredentialDescriptor)", "refSections": [{"refs": [{"id": "ref-for-dom-publickeycredentialdescriptor-type"}], "title": "4.1.11. Steps to respond to a payment request"}], "external": true};
window.dfnpanelData['de38fdaf'] = {"dfnID": "de38fdaf", "url": "https://w3c.github.io/webauthn/#dom-authenticatorselectioncriteria-userverification", "dfnText": "userVerification (for AuthenticatorSelectionCriteria)", "refSections": [{"refs": [{"id": "ref-for-dom-authenticatorselectioncriteria-userverification"}], "title": "5. WebAuthn Extension - \"payment\""}], "external": true};
window.dfnpanelData['38afc4f0'] = {"dfnID": "38afc4f0", "url": "https://w3c.github.io/webauthn/#dom-publickeycredentialrequestoptions-userverification", "dfnText": "userVerification (for PublicKeyCredentialRequestOptions)", "refSections": [{"refs": [{"id": "ref-for-dom-publickeycredentialrequestoptions-userverification"}, {"id": "ref-for-dom-publickeycredentialrequestoptions-userverification\u2460"}], "title": "4.1.11. Steps to respond to a payment request"}], "external": true};
window.dfnpanelData['cce1676e'] = {"dfnID": "cce1676e", "url": "https://w3c.github.io/webdriver/#dfn-extension-commands", "dfnText": "extension command", "refSections": [{"refs": [{"id": "ref-for-dfn-extension-commands"}], "title": "9. User Agent Automation"}, {"refs": [{"id": "ref-for-dfn-extension-commands\u2460"}], "title": "9.1. Set SPC Transaction Mode"}], "external": true};
window.dfnpanelData['5b668531'] = {"dfnID": "5b668531", "url": "https://w3c.github.io/webdriver/#dfn-getting-properties", "dfnText": "getting a property", "refSections": [{"refs": [{"id": "ref-for-dfn-getting-properties"}], "title": "9.1. Set SPC Transaction Mode"}], "external": true};
window.dfnpanelData['8da4d1e3'] = {"dfnID": "8da4d1e3", "url": "https://w3c.github.io/webdriver/#dfn-invalid-argument", "dfnText": "invalid argument", "refSections": [{"refs": [{"id": "ref-for-dfn-invalid-argument"}, {"id": "ref-for-dfn-invalid-argument\u2460"}], "title": "9.1. Set SPC Transaction Mode"}], "external": true};
window.dfnpanelData['82c23298'] = {"dfnID": "82c23298", "url": "https://w3c.github.io/webdriver/#dfn-remote-end-steps", "dfnText": "remote end steps", "refSections": [{"refs": [{"id": "ref-for-dfn-remote-end-steps"}], "title": "9.1. Set SPC Transaction Mode"}], "external": true};
window.dfnpanelData['4be6272b'] = {"dfnID": "4be6272b", "url": "https://w3c.github.io/webdriver/#dfn-success", "dfnText": "success", "refSections": [{"refs": [{"id": "ref-for-dfn-success"}], "title": "9.1. Set SPC Transaction Mode"}], "external": true};
window.dfnpanelData['603c5d8f'] = {"dfnID": "603c5d8f", "url": "https://w3c.github.io/webdriver/#dfn-undefined", "dfnText": "undefined", "refSections": [{"refs": [{"id": "ref-for-dfn-undefined"}], "title": "9.1. Set SPC Transaction Mode"}], "external": true};
window.dfnpanelData['5cf0e148'] = {"dfnID": "5cf0e148", "url": "https://w3c.github.io/webdriver/#dfn-error", "dfnText": "webdriver error", "refSections": [{"refs": [{"id": "ref-for-dfn-error"}, {"id": "ref-for-dfn-error\u2460"}], "title": "9.1. Set SPC Transaction Mode"}], "external": true};
window.dfnpanelData['7482107b'] = {"dfnID": "7482107b", "url": "https://w3c.github.io/webdriver/#dfn-error-code", "dfnText": "webdriver error code", "refSections": [{"refs": [{"id": "ref-for-dfn-error-code"}, {"id": "ref-for-dfn-error-code\u2460"}], "title": "9.1. Set SPC Transaction Mode"}], "external": true};
window.dfnpanelData['3aff2fb3'] = {"dfnID": "3aff2fb3", "url": "https://webidl.spec.whatwg.org/#BufferSource", "dfnText": "BufferSource", "refSections": [{"refs": [{"id": "ref-for-BufferSource"}, {"id": "ref-for-BufferSource\u2460"}, {"id": "ref-for-BufferSource\u2461"}, {"id": "ref-for-BufferSource\u2462"}], "title": "4.1.5. SecurePaymentConfirmationRequest Dictionary"}], "external": true};
window.dfnpanelData['dca2de17'] = {"dfnID": "dca2de17", "url": "https://webidl.spec.whatwg.org/#idl-DOMException", "dfnText": "DOMException", "refSections": [{"refs": [{"id": "ref-for-idl-DOMException"}], "title": "4.1.4. Modification of user activation requirement"}, {"refs": [{"id": "ref-for-idl-DOMException\u2460"}], "title": "4.1.9. Steps to check if a payment can be made"}, {"refs": [{"id": "ref-for-idl-DOMException\u2461"}], "title": "4.1.10. Displaying a transaction confirmation UX"}, {"refs": [{"id": "ref-for-idl-DOMException\u2462"}, {"id": "ref-for-idl-DOMException\u2463"}], "title": "5. WebAuthn Extension - \"payment\""}], "external": true};
window.dfnpanelData['ba556545'] = {"dfnID": "ba556545", "url": "https://webidl.spec.whatwg.org/#notallowederror", "dfnText": "NotAllowedError", "refSections": [{"refs": [{"id": "ref-for-notallowederror"}], "title": "4.1.9. Steps to check if a payment can be made"}, {"refs": [{"id": "ref-for-notallowederror\u2460"}], "title": "5. WebAuthn Extension - \"payment\""}], "external": true};
window.dfnpanelData['b1c1965a'] = {"dfnID": "b1c1965a", "url": "https://webidl.spec.whatwg.org/#optouterror", "dfnText": "OptOutError", "refSections": [{"refs": [{"id": "ref-for-optouterror"}], "title": "4.1.10. Displaying a transaction confirmation UX"}, {"refs": [{"id": "ref-for-optouterror\u2460"}, {"id": "ref-for-optouterror\u2461"}], "title": "11.5. User opt out"}], "external": true};
window.dfnpanelData['bdbd19d1'] = {"dfnID": "bdbd19d1", "url": "https://webidl.spec.whatwg.org/#idl-promise", "dfnText": "Promise", "refSections": [{"refs": [{"id": "ref-for-idl-promise"}], "title": "4.1.7. Checking if Secure Payment Confirmation is available"}], "external": true};
window.dfnpanelData['ec878a66'] = {"dfnID": "ec878a66", "url": "https://webidl.spec.whatwg.org/#exceptiondef-rangeerror", "dfnText": "RangeError", "refSections": [{"refs": [{"id": "ref-for-exceptiondef-rangeerror"}], "title": "4.1.3. Modification of Payment Request constructor"}, {"refs": [{"id": "ref-for-exceptiondef-rangeerror\u2460"}, {"id": "ref-for-exceptiondef-rangeerror\u2461"}], "title": "4.1.8. Steps to validate payment method data"}], "external": true};
window.dfnpanelData['c3e881ef'] = {"dfnID": "c3e881ef", "url": "https://webidl.spec.whatwg.org/#securityerror", "dfnText": "SecurityError", "refSections": [{"refs": [{"id": "ref-for-securityerror"}], "title": "4.1.4. Modification of user activation requirement"}, {"refs": [{"id": "ref-for-securityerror\u2460"}], "title": "5. WebAuthn Extension - \"payment\""}], "external": true};
window.dfnpanelData['82ca3efc'] = {"dfnID": "82ca3efc", "url": "https://webidl.spec.whatwg.org/#exceptiondef-typeerror", "dfnText": "TypeError", "refSections": [{"refs": [{"id": "ref-for-exceptiondef-typeerror"}, {"id": "ref-for-exceptiondef-typeerror\u2460"}, {"id": "ref-for-exceptiondef-typeerror\u2461"}, {"id": "ref-for-exceptiondef-typeerror\u2462"}, {"id": "ref-for-exceptiondef-typeerror\u2463"}, {"id": "ref-for-exceptiondef-typeerror\u2464"}, {"id": "ref-for-exceptiondef-typeerror\u2465"}, {"id": "ref-for-exceptiondef-typeerror\u2466"}, {"id": "ref-for-exceptiondef-typeerror\u2467"}], "title": "4.1.8. Steps to validate payment method data"}, {"refs": [{"id": "ref-for-exceptiondef-typeerror\u2468"}], "title": "5. WebAuthn Extension - \"payment\""}], "external": true};
window.dfnpanelData['b0d7f3c3'] = {"dfnID": "b0d7f3c3", "url": "https://webidl.spec.whatwg.org/#idl-USVString", "dfnText": "USVString", "refSections": [{"refs": [{"id": "ref-for-idl-USVString"}, {"id": "ref-for-idl-USVString\u2460"}, {"id": "ref-for-idl-USVString\u2461"}, {"id": "ref-for-idl-USVString\u2462"}, {"id": "ref-for-idl-USVString\u2463"}, {"id": "ref-for-idl-USVString\u2464"}, {"id": "ref-for-idl-USVString\u2465"}, {"id": "ref-for-idl-USVString\u2466"}], "title": "4.1.5. SecurePaymentConfirmationRequest Dictionary"}, {"refs": [{"id": "ref-for-idl-USVString\u2467"}, {"id": "ref-for-idl-USVString\u2468"}, {"id": "ref-for-idl-USVString\u2460\u24ea"}, {"id": "ref-for-idl-USVString\u2460\u2460"}, {"id": "ref-for-idl-USVString\u2460\u2461"}, {"id": "ref-for-idl-USVString\u2460\u2462"}, {"id": "ref-for-idl-USVString\u2460\u2463"}, {"id": "ref-for-idl-USVString\u2460\u2464"}], "title": "5. WebAuthn Extension - \"payment\""}, {"refs": [{"id": "ref-for-idl-USVString\u2460\u2465"}, {"id": "ref-for-idl-USVString\u2460\u2466"}, {"id": "ref-for-idl-USVString\u2460\u2467"}, {"id": "ref-for-idl-USVString\u2460\u2468"}, {"id": "ref-for-idl-USVString\u2461\u24ea"}, {"id": "ref-for-idl-USVString\u2461\u2460"}, {"id": "ref-for-idl-USVString\u2461\u2461"}, {"id": "ref-for-idl-USVString\u2461\u2462"}], "title": "5.2. CollectedClientAdditionalPaymentData Dictionary"}, {"refs": [{"id": "ref-for-idl-USVString\u2461\u2463"}, {"id": "ref-for-idl-USVString\u2461\u2464"}, {"id": "ref-for-idl-USVString\u2461\u2465"}, {"id": "ref-for-idl-USVString\u2461\u2466"}], "title": "6.1. PaymentCredentialInstrument Dictionary"}], "external": true};
window.dfnpanelData['d0b4a948'] = {"dfnID": "d0b4a948", "url": "https://webidl.spec.whatwg.org/#a-promise-rejected-with", "dfnText": "a promise rejected with", "refSections": [{"refs": [{"id": "ref-for-a-promise-rejected-with"}], "title": "4.1.4. Modification of user activation requirement"}], "external": true};
window.dfnpanelData['5372cca8'] = {"dfnID": "5372cca8", "url": "https://webidl.spec.whatwg.org/#idl-boolean", "dfnText": "boolean", "refSections": [{"refs": [{"id": "ref-for-idl-boolean"}, {"id": "ref-for-idl-boolean\u2460"}], "title": "4.1.5. SecurePaymentConfirmationRequest Dictionary"}, {"refs": [{"id": "ref-for-idl-boolean\u2461"}], "title": "4.1.7. Checking if Secure Payment Confirmation is available"}, {"refs": [{"id": "ref-for-idl-boolean\u2462"}, {"id": "ref-for-idl-boolean\u2463"}], "title": "5. WebAuthn Extension - \"payment\""}, {"refs": [{"id": "ref-for-idl-boolean\u2464"}, {"id": "ref-for-idl-boolean\u2465"}], "title": "6.1. PaymentCredentialInstrument Dictionary"}], "external": true};
window.dfnpanelData['9cce47fd'] = {"dfnID": "9cce47fd", "url": "https://webidl.spec.whatwg.org/#idl-sequence", "dfnText": "sequence", "refSections": [{"refs": [{"id": "ref-for-idl-sequence"}, {"id": "ref-for-idl-sequence\u2460"}], "title": "4.1.5. SecurePaymentConfirmationRequest Dictionary"}], "external": true};
window.dfnpanelData['e97a9688'] = {"dfnID": "e97a9688", "url": "https://webidl.spec.whatwg.org/#idl-unsigned-long", "dfnText": "unsigned long", "refSections": [{"refs": [{"id": "ref-for-idl-unsigned-long"}, {"id": "ref-for-idl-unsigned-long\u2460"}], "title": "4.1.5. SecurePaymentConfirmationRequest Dictionary"}], "external": true};
window.dfnpanelData['spc-credential'] = {"dfnID": "spc-credential", "url": "#spc-credential", "dfnText": "SPC Credential", "refSections": [{"refs": [{"id": "ref-for-spc-credential"}, {"id": "ref-for-spc-credential\u2460"}], "title": "2. Terminology"}], "external": false};
window.dfnpanelData['steps-to-silently-determine-if-a-credential-is-spc-enabled'] = {"dfnID": "steps-to-silently-determine-if-a-credential-is-spc-enabled", "url": "#steps-to-silently-determine-if-a-credential-is-spc-enabled", "dfnText": "Steps to silently determine if a credential is SPC-enabled", "refSections": [{"refs": [{"id": "ref-for-steps-to-silently-determine-if-a-credential-is-spc-enabled"}], "title": "4.1.9. Steps to check if a payment can be made"}], "external": false};
window.dfnpanelData['steps-to-silently-determine-if-a-credential-is-available-for-the-current-device'] = {"dfnID": "steps-to-silently-determine-if-a-credential-is-available-for-the-current-device", "url": "#steps-to-silently-determine-if-a-credential-is-available-for-the-current-device", "dfnText": "Steps to silently determine if a credential is available for the current device", "refSections": [{"refs": [{"id": "ref-for-steps-to-silently-determine-if-a-credential-is-available-for-the-current-device"}], "title": "4.1.9. Steps to check if a payment can be made"}], "external": false};
window.dfnpanelData['secure-payment-confirmation-payment-handler'] = {"dfnID": "secure-payment-confirmation-payment-handler", "url": "#secure-payment-confirmation-payment-handler", "dfnText": "Secure Payment\nConfirmation payment handler", "refSections": [{"refs": [{"id": "ref-for-secure-payment-confirmation-payment-handler"}], "title": "4.1.1. Payment Method Identifier"}, {"refs": [{"id": "ref-for-secure-payment-confirmation-payment-handler\u2460"}], "title": "4.1.10. Displaying a transaction confirmation UX"}, {"refs": [{"id": "ref-for-secure-payment-confirmation-payment-handler\u2461"}], "title": "8.1. Verifying an Authentication Assertion"}], "external": false};
window.dfnpanelData['secure-payment-confirmation'] = {"dfnID": "secure-payment-confirmation", "url": "#secure-payment-confirmation", "dfnText": "secure-payment-confirmation", "refSections": [{"refs": [{"id": "ref-for-secure-payment-confirmation"}], "title": "4. Authentication"}, {"refs": [{"id": "ref-for-secure-payment-confirmation\u2460"}], "title": "4.1.2. Registration in [payment-method-id]"}, {"refs": [{"id": "ref-for-secure-payment-confirmation\u2461"}], "title": "4.1.3. Modification of Payment Request constructor"}, {"refs": [{"id": "ref-for-secure-payment-confirmation\u2462"}, {"id": "ref-for-secure-payment-confirmation\u2463"}], "title": "5. WebAuthn Extension - \"payment\""}], "external": false};
window.dfnpanelData['dictdef-securepaymentconfirmationrequest'] = {"dfnID": "dictdef-securepaymentconfirmationrequest", "url": "#dictdef-securepaymentconfirmationrequest", "dfnText": "SecurePaymentConfirmationRequest", "refSections": [{"refs": [{"id": "ref-for-dictdef-securepaymentconfirmationrequest"}, {"id": "ref-for-dictdef-securepaymentconfirmationrequest\u2460"}], "title": "4.1.5. SecurePaymentConfirmationRequest Dictionary"}, {"refs": [{"id": "ref-for-dictdef-securepaymentconfirmationrequest\u2461"}], "title": "4.1.6. Payment Method additional data type"}, {"refs": [{"id": "ref-for-dictdef-securepaymentconfirmationrequest\u2462"}], "title": "4.1.8. Steps to validate payment method data"}, {"refs": [{"id": "ref-for-dictdef-securepaymentconfirmationrequest\u2463"}], "title": "4.1.9. Steps to check if a payment can be made"}, {"refs": [{"id": "ref-for-dictdef-securepaymentconfirmationrequest\u2464"}], "title": "4.1.11. Steps to respond to a payment request"}], "external": false};
window.dfnpanelData['dom-securepaymentconfirmationrequest-challenge'] = {"dfnID": "dom-securepaymentconfirmationrequest-challenge", "url": "#dom-securepaymentconfirmationrequest-challenge", "dfnText": "challenge", "refSections": [{"refs": [{"id": "ref-for-dom-securepaymentconfirmationrequest-challenge"}], "title": "4.1.5. SecurePaymentConfirmationRequest Dictionary"}, {"refs": [{"id": "ref-for-dom-securepaymentconfirmationrequest-challenge\u2460"}], "title": "4.1.8. Steps to validate payment method data"}, {"refs": [{"id": "ref-for-dom-securepaymentconfirmationrequest-challenge\u2461"}], "title": "4.1.11. Steps to respond to a payment request"}], "external": false};
window.dfnpanelData['dom-securepaymentconfirmationrequest-rpid'] = {"dfnID": "dom-securepaymentconfirmationrequest-rpid", "url": "#dom-securepaymentconfirmationrequest-rpid", "dfnText": "rpId", "refSections": [{"refs": [{"id": "ref-for-dom-securepaymentconfirmationrequest-rpid"}], "title": "4.1.5. SecurePaymentConfirmationRequest Dictionary"}, {"refs": [{"id": "ref-for-dom-securepaymentconfirmationrequest-rpid\u2460"}], "title": "4.1.8. Steps to validate payment method data"}, {"refs": [{"id": "ref-for-dom-securepaymentconfirmationrequest-rpid\u2461"}], "title": "4.1.9. Steps to check if a payment can be made"}, {"refs": [{"id": "ref-for-dom-securepaymentconfirmationrequest-rpid\u2462"}], "title": "4.1.10. Displaying a transaction confirmation UX"}, {"refs": [{"id": "ref-for-dom-securepaymentconfirmationrequest-rpid\u2463"}, {"id": "ref-for-dom-securepaymentconfirmationrequest-rpid\u2464"}], "title": "4.1.11. Steps to respond to a payment request"}], "external": false};
window.dfnpanelData['dom-securepaymentconfirmationrequest-credentialids'] = {"dfnID": "dom-securepaymentconfirmationrequest-credentialids", "url": "#dom-securepaymentconfirmationrequest-credentialids", "dfnText": "credentialIds", "refSections": [{"refs": [{"id": "ref-for-dom-securepaymentconfirmationrequest-credentialids"}], "title": "4.1.5. SecurePaymentConfirmationRequest Dictionary"}, {"refs": [{"id": "ref-for-dom-securepaymentconfirmationrequest-credentialids\u2460"}, {"id": "ref-for-dom-securepaymentconfirmationrequest-credentialids\u2461"}], "title": "4.1.8. Steps to validate payment method data"}, {"refs": [{"id": "ref-for-dom-securepaymentconfirmationrequest-credentialids\u2462"}, {"id": "ref-for-dom-securepaymentconfirmationrequest-credentialids\u2463"}, {"id": "ref-for-dom-securepaymentconfirmationrequest-credentialids\u2464"}], "title": "4.1.9. Steps to check if a payment can be made"}, {"refs": [{"id": "ref-for-dom-securepaymentconfirmationrequest-credentialids\u2465"}], "title": "4.1.11. Steps to respond to a payment request"}], "external": false};
window.dfnpanelData['dom-securepaymentconfirmationrequest-instrument'] = {"dfnID": "dom-securepaymentconfirmationrequest-instrument", "url": "#dom-securepaymentconfirmationrequest-instrument", "dfnText": "instrument", "refSections": [{"refs": [{"id": "ref-for-dom-securepaymentconfirmationrequest-instrument"}], "title": "4.1.5. SecurePaymentConfirmationRequest Dictionary"}, {"refs": [{"id": "ref-for-dom-securepaymentconfirmationrequest-instrument\u2460"}, {"id": "ref-for-dom-securepaymentconfirmationrequest-instrument\u2461"}, {"id": "ref-for-dom-securepaymentconfirmationrequest-instrument\u2462"}], "title": "4.1.8. Steps to validate payment method data"}, {"refs": [{"id": "ref-for-dom-securepaymentconfirmationrequest-instrument\u2463"}, {"id": "ref-for-dom-securepaymentconfirmationrequest-instrument\u2464"}, {"id": "ref-for-dom-securepaymentconfirmationrequest-instrument\u2465"}], "title": "4.1.9. Steps to check if a payment can be made"}, {"refs": [{"id": "ref-for-dom-securepaymentconfirmationrequest-instrument\u2466"}], "title": "4.1.11. Steps to respond to a payment request"}], "external": false};
window.dfnpanelData['dom-securepaymentconfirmationrequest-timeout'] = {"dfnID": "dom-securepaymentconfirmationrequest-timeout", "url": "#dom-securepaymentconfirmationrequest-timeout", "dfnText": "timeout", "refSections": [{"refs": [{"id": "ref-for-dom-securepaymentconfirmationrequest-timeout"}], "title": "4.1.5. SecurePaymentConfirmationRequest Dictionary"}, {"refs": [{"id": "ref-for-dom-securepaymentconfirmationrequest-timeout\u2460"}], "title": "4.1.11. Steps to respond to a payment request"}], "external": false};
window.dfnpanelData['dom-securepaymentconfirmationrequest-payeename'] = {"dfnID": "dom-securepaymentconfirmationrequest-payeename", "url": "#dom-securepaymentconfirmationrequest-payeename", "dfnText": "payeeName", "refSections": [{"refs": [{"id": "ref-for-dom-securepaymentconfirmationrequest-payeename"}, {"id": "ref-for-dom-securepaymentconfirmationrequest-payeename\u2460"}], "title": "4.1.5. SecurePaymentConfirmationRequest Dictionary"}, {"refs": [{"id": "ref-for-dom-securepaymentconfirmationrequest-payeename\u2461"}, {"id": "ref-for-dom-securepaymentconfirmationrequest-payeename\u2462"}], "title": "4.1.8. Steps to validate payment method data"}, {"refs": [{"id": "ref-for-dom-securepaymentconfirmationrequest-payeename\u2463"}], "title": "4.1.11. Steps to respond to a payment request"}], "external": false};
window.dfnpanelData['dom-securepaymentconfirmationrequest-payeeorigin'] = {"dfnID": "dom-securepaymentconfirmationrequest-payeeorigin", "url": "#dom-securepaymentconfirmationrequest-payeeorigin", "dfnText": "payeeOrigin", "refSections": [{"refs": [{"id": "ref-for-dom-securepaymentconfirmationrequest-payeeorigin"}, {"id": "ref-for-dom-securepaymentconfirmationrequest-payeeorigin\u2460"}], "title": "4.1.5. SecurePaymentConfirmationRequest Dictionary"}, {"refs": [{"id": "ref-for-dom-securepaymentconfirmationrequest-payeeorigin\u2461"}, {"id": "ref-for-dom-securepaymentconfirmationrequest-payeeorigin\u2462"}, {"id": "ref-for-dom-securepaymentconfirmationrequest-payeeorigin\u2463"}, {"id": "ref-for-dom-securepaymentconfirmationrequest-payeeorigin\u2464"}], "title": "4.1.8. Steps to validate payment method data"}, {"refs": [{"id": "ref-for-dom-securepaymentconfirmationrequest-payeeorigin\u2465"}, {"id": "ref-for-dom-securepaymentconfirmationrequest-payeeorigin\u2466"}, {"id": "ref-for-dom-securepaymentconfirmationrequest-payeeorigin\u2467"}], "title": "4.1.9. Steps to check if a payment can be made"}, {"refs": [{"id": "ref-for-dom-securepaymentconfirmationrequest-payeeorigin\u2468"}], "title": "4.1.11. Steps to respond to a payment request"}], "external": false};
window.dfnpanelData['dom-securepaymentconfirmationrequest-extensions'] = {"dfnID": "dom-securepaymentconfirmationrequest-extensions", "url": "#dom-securepaymentconfirmationrequest-extensions", "dfnText": "extensions", "refSections": [{"refs": [{"id": "ref-for-dom-securepaymentconfirmationrequest-extensions"}], "title": "4.1.5. SecurePaymentConfirmationRequest Dictionary"}, {"refs": [{"id": "ref-for-dom-securepaymentconfirmationrequest-extensions\u2460"}], "title": "4.1.11. Steps to respond to a payment request"}], "external": false};
window.dfnpanelData['dom-securepaymentconfirmationrequest-locale'] = {"dfnID": "dom-securepaymentconfirmationrequest-locale", "url": "#dom-securepaymentconfirmationrequest-locale", "dfnText": "locale", "refSections": [{"refs": [{"id": "ref-for-dom-securepaymentconfirmationrequest-locale"}, {"id": "ref-for-dom-securepaymentconfirmationrequest-locale\u2460"}], "title": "4.1.5. SecurePaymentConfirmationRequest Dictionary"}, {"refs": [{"id": "ref-for-dom-securepaymentconfirmationrequest-locale\u2461"}], "title": "4.1.10. Displaying a transaction confirmation UX"}, {"refs": [{"id": "ref-for-dom-securepaymentconfirmationrequest-locale\u2462"}, {"id": "ref-for-dom-securepaymentconfirmationrequest-locale\u2463"}], "title": "13. Internationalization Considerations"}], "external": false};
window.dfnpanelData['dom-securepaymentconfirmationrequest-showoptout'] = {"dfnID": "dom-securepaymentconfirmationrequest-showoptout", "url": "#dom-securepaymentconfirmationrequest-showoptout", "dfnText": "showOptOut", "refSections": [{"refs": [{"id": "ref-for-dom-securepaymentconfirmationrequest-showoptout"}], "title": "4.1.5. SecurePaymentConfirmationRequest Dictionary"}, {"refs": [{"id": "ref-for-dom-securepaymentconfirmationrequest-showoptout\u2460"}], "title": "4.1.10. Displaying a transaction confirmation UX"}, {"refs": [{"id": "ref-for-dom-securepaymentconfirmationrequest-showoptout\u2461"}], "title": "11.5. User opt out"}], "external": false};
window.dfnpanelData['dom-paymentrequest-issecurepaymentconfirmationavailable'] = {"dfnID": "dom-paymentrequest-issecurepaymentconfirmationavailable", "url": "#dom-paymentrequest-issecurepaymentconfirmationavailable", "dfnText": "isSecurePaymentConfirmationAvailable", "refSections": [{"refs": [{"id": "ref-for-dom-paymentrequest-issecurepaymentconfirmationavailable"}, {"id": "ref-for-dom-paymentrequest-issecurepaymentconfirmationavailable\u2460"}], "title": "4.1.7. Checking if Secure Payment Confirmation is available"}], "external": false};
window.dfnpanelData['dom-authenticationextensionsclientinputs-payment'] = {"dfnID": "dom-authenticationextensionsclientinputs-payment", "url": "#dom-authenticationextensionsclientinputs-payment", "dfnText": "payment", "refSections": [{"refs": [{"id": "ref-for-dom-authenticationextensionsclientinputs-payment"}], "title": "3. Registration"}, {"refs": [{"id": "ref-for-dom-authenticationextensionsclientinputs-payment\u2460"}], "title": "4.1.11. Steps to respond to a payment request"}, {"refs": [{"id": "ref-for-dom-authenticationextensionsclientinputs-payment\u2461"}, {"id": "ref-for-dom-authenticationextensionsclientinputs-payment\u2462"}], "title": "10.1.1. Login Attack"}], "external": false};
window.dfnpanelData['dictdef-authenticationextensionspaymentinputs'] = {"dfnID": "dictdef-authenticationextensionspaymentinputs", "url": "#dictdef-authenticationextensionspaymentinputs", "dfnText": "AuthenticationExtensionsPaymentInputs", "refSections": [{"refs": [{"id": "ref-for-dictdef-authenticationextensionspaymentinputs"}], "title": "4.1.11. Steps to respond to a payment request"}, {"refs": [{"id": "ref-for-dictdef-authenticationextensionspaymentinputs\u2460"}, {"id": "ref-for-dictdef-authenticationextensionspaymentinputs\u2461"}], "title": "5. WebAuthn Extension - \"payment\""}], "external": false};
window.dfnpanelData['dom-authenticationextensionspaymentinputs-ispayment'] = {"dfnID": "dom-authenticationextensionspaymentinputs-ispayment", "url": "#dom-authenticationextensionspaymentinputs-ispayment", "dfnText": "isPayment", "refSections": [{"refs": [{"id": "ref-for-dom-authenticationextensionspaymentinputs-ispayment"}], "title": "4.1.11. Steps to respond to a payment request"}, {"refs": [{"id": "ref-for-dom-authenticationextensionspaymentinputs-ispayment\u2460"}], "title": "5. WebAuthn Extension - \"payment\""}], "external": false};
window.dfnpanelData['dom-authenticationextensionspaymentinputs-rpid'] = {"dfnID": "dom-authenticationextensionspaymentinputs-rpid", "url": "#dom-authenticationextensionspaymentinputs-rpid", "dfnText": "rpId", "refSections": [{"refs": [{"id": "ref-for-dom-authenticationextensionspaymentinputs-rpid"}], "title": "4.1.11. Steps to respond to a payment request"}, {"refs": [{"id": "ref-for-dom-authenticationextensionspaymentinputs-rpid\u2460"}, {"id": "ref-for-dom-authenticationextensionspaymentinputs-rpid\u2461"}], "title": "5. WebAuthn Extension - \"payment\""}], "external": false};
window.dfnpanelData['dom-authenticationextensionspaymentinputs-toporigin'] = {"dfnID": "dom-authenticationextensionspaymentinputs-toporigin", "url": "#dom-authenticationextensionspaymentinputs-toporigin", "dfnText": "topOrigin", "refSections": [{"refs": [{"id": "ref-for-dom-authenticationextensionspaymentinputs-toporigin"}], "title": "4.1.11. Steps to respond to a payment request"}, {"refs": [{"id": "ref-for-dom-authenticationextensionspaymentinputs-toporigin\u2460"}, {"id": "ref-for-dom-authenticationextensionspaymentinputs-toporigin\u2461"}], "title": "5. WebAuthn Extension - \"payment\""}], "external": false};
window.dfnpanelData['dom-authenticationextensionspaymentinputs-payeename'] = {"dfnID": "dom-authenticationextensionspaymentinputs-payeename", "url": "#dom-authenticationextensionspaymentinputs-payeename", "dfnText": "payeeName", "refSections": [{"refs": [{"id": "ref-for-dom-authenticationextensionspaymentinputs-payeename"}], "title": "4.1.11. Steps to respond to a payment request"}, {"refs": [{"id": "ref-for-dom-authenticationextensionspaymentinputs-payeename\u2460"}, {"id": "ref-for-dom-authenticationextensionspaymentinputs-payeename\u2461"}], "title": "5. WebAuthn Extension - \"payment\""}], "external": false};
window.dfnpanelData['dom-authenticationextensionspaymentinputs-payeeorigin'] = {"dfnID": "dom-authenticationextensionspaymentinputs-payeeorigin", "url": "#dom-authenticationextensionspaymentinputs-payeeorigin", "dfnText": "payeeOrigin", "refSections": [{"refs": [{"id": "ref-for-dom-authenticationextensionspaymentinputs-payeeorigin"}], "title": "4.1.11. Steps to respond to a payment request"}, {"refs": [{"id": "ref-for-dom-authenticationextensionspaymentinputs-payeeorigin\u2460"}, {"id": "ref-for-dom-authenticationextensionspaymentinputs-payeeorigin\u2461"}], "title": "5. WebAuthn Extension - \"payment\""}], "external": false};
window.dfnpanelData['dom-authenticationextensionspaymentinputs-total'] = {"dfnID": "dom-authenticationextensionspaymentinputs-total", "url": "#dom-authenticationextensionspaymentinputs-total", "dfnText": "total", "refSections": [{"refs": [{"id": "ref-for-dom-authenticationextensionspaymentinputs-total"}], "title": "4.1.11. Steps to respond to a payment request"}, {"refs": [{"id": "ref-for-dom-authenticationextensionspaymentinputs-total\u2460"}, {"id": "ref-for-dom-authenticationextensionspaymentinputs-total\u2461"}], "title": "5. WebAuthn Extension - \"payment\""}], "external": false};
window.dfnpanelData['dom-authenticationextensionspaymentinputs-instrument'] = {"dfnID": "dom-authenticationextensionspaymentinputs-instrument", "url": "#dom-authenticationextensionspaymentinputs-instrument", "dfnText": "instrument", "refSections": [{"refs": [{"id": "ref-for-dom-authenticationextensionspaymentinputs-instrument"}], "title": "4.1.11. Steps to respond to a payment request"}, {"refs": [{"id": "ref-for-dom-authenticationextensionspaymentinputs-instrument\u2460"}, {"id": "ref-for-dom-authenticationextensionspaymentinputs-instrument\u2461"}], "title": "5. WebAuthn Extension - \"payment\""}], "external": false};
window.dfnpanelData['dictdef-collectedclientpaymentdata'] = {"dfnID": "dictdef-collectedclientpaymentdata", "url": "#dictdef-collectedclientpaymentdata", "dfnText": "CollectedClientPaymentData", "refSections": [{"refs": [{"id": "ref-for-dictdef-collectedclientpaymentdata"}], "title": "4.1.10. Displaying a transaction confirmation UX"}, {"refs": [{"id": "ref-for-dictdef-collectedclientpaymentdata\u2460"}], "title": "5. WebAuthn Extension - \"payment\""}, {"refs": [{"id": "ref-for-dictdef-collectedclientpaymentdata\u2461"}, {"id": "ref-for-dictdef-collectedclientpaymentdata\u2462"}], "title": "5.1. CollectedClientPaymentData Dictionary"}], "external": false};
window.dfnpanelData['dom-collectedclientpaymentdata-payment'] = {"dfnID": "dom-collectedclientpaymentdata-payment", "url": "#dom-collectedclientpaymentdata-payment", "dfnText": "payment", "refSections": [{"refs": [{"id": "ref-for-dom-collectedclientpaymentdata-payment"}], "title": "5. WebAuthn Extension - \"payment\""}, {"refs": [{"id": "ref-for-dom-collectedclientpaymentdata-payment\u2460"}], "title": "5.1. CollectedClientPaymentData Dictionary"}, {"refs": [{"id": "ref-for-dom-collectedclientpaymentdata-payment\u2461"}, {"id": "ref-for-dom-collectedclientpaymentdata-payment\u2462"}, {"id": "ref-for-dom-collectedclientpaymentdata-payment\u2463"}, {"id": "ref-for-dom-collectedclientpaymentdata-payment\u2464"}, {"id": "ref-for-dom-collectedclientpaymentdata-payment\u2465"}, {"id": "ref-for-dom-collectedclientpaymentdata-payment\u2466"}], "title": "8.1. Verifying an Authentication Assertion"}], "external": false};
window.dfnpanelData['dictdef-collectedclientadditionalpaymentdata'] = {"dfnID": "dictdef-collectedclientadditionalpaymentdata", "url": "#dictdef-collectedclientadditionalpaymentdata", "dfnText": "CollectedClientAdditionalPaymentData", "refSections": [{"refs": [{"id": "ref-for-dictdef-collectedclientadditionalpaymentdata"}], "title": "5. WebAuthn Extension - \"payment\""}, {"refs": [{"id": "ref-for-dictdef-collectedclientadditionalpaymentdata\u2460"}, {"id": "ref-for-dictdef-collectedclientadditionalpaymentdata\u2461"}], "title": "5.1. CollectedClientPaymentData Dictionary"}, {"refs": [{"id": "ref-for-dictdef-collectedclientadditionalpaymentdata\u2462"}, {"id": "ref-for-dictdef-collectedclientadditionalpaymentdata\u2463"}, {"id": "ref-for-dictdef-collectedclientadditionalpaymentdata\u2464"}], "title": "5.2. CollectedClientAdditionalPaymentData Dictionary"}, {"refs": [{"id": "ref-for-dictdef-collectedclientadditionalpaymentdata\u2465"}], "title": "6.1. PaymentCredentialInstrument Dictionary"}], "external": false};
window.dfnpanelData['dom-collectedclientadditionalpaymentdata-rpid'] = {"dfnID": "dom-collectedclientadditionalpaymentdata-rpid", "url": "#dom-collectedclientadditionalpaymentdata-rpid", "dfnText": "rpId", "refSections": [{"refs": [{"id": "ref-for-dom-collectedclientadditionalpaymentdata-rpid"}], "title": "5. WebAuthn Extension - \"payment\""}, {"refs": [{"id": "ref-for-dom-collectedclientadditionalpaymentdata-rpid\u2460"}], "title": "5.2. CollectedClientAdditionalPaymentData Dictionary"}, {"refs": [{"id": "ref-for-dom-collectedclientadditionalpaymentdata-rpid\u2461"}], "title": "8.1. Verifying an Authentication Assertion"}], "external": false};
window.dfnpanelData['dom-collectedclientadditionalpaymentdata-toporigin'] = {"dfnID": "dom-collectedclientadditionalpaymentdata-toporigin", "url": "#dom-collectedclientadditionalpaymentdata-toporigin", "dfnText": "topOrigin", "refSections": [{"refs": [{"id": "ref-for-dom-collectedclientadditionalpaymentdata-toporigin"}], "title": "5. WebAuthn Extension - \"payment\""}, {"refs": [{"id": "ref-for-dom-collectedclientadditionalpaymentdata-toporigin\u2460"}], "title": "5.2. CollectedClientAdditionalPaymentData Dictionary"}, {"refs": [{"id": "ref-for-dom-collectedclientadditionalpaymentdata-toporigin\u2461"}], "title": "8.1. Verifying an Authentication Assertion"}], "external": false};
window.dfnpanelData['dom-collectedclientadditionalpaymentdata-payeename'] = {"dfnID": "dom-collectedclientadditionalpaymentdata-payeename", "url": "#dom-collectedclientadditionalpaymentdata-payeename", "dfnText": "payeeName", "refSections": [{"refs": [{"id": "ref-for-dom-collectedclientadditionalpaymentdata-payeename"}], "title": "4.1.10. Displaying a transaction confirmation UX"}, {"refs": [{"id": "ref-for-dom-collectedclientadditionalpaymentdata-payeename\u2460"}], "title": "5. WebAuthn Extension - \"payment\""}, {"refs": [{"id": "ref-for-dom-collectedclientadditionalpaymentdata-payeename\u2461"}], "title": "5.2. CollectedClientAdditionalPaymentData Dictionary"}, {"refs": [{"id": "ref-for-dom-collectedclientadditionalpaymentdata-payeename\u2462"}], "title": "8.1. Verifying an Authentication Assertion"}], "external": false};
window.dfnpanelData['dom-collectedclientadditionalpaymentdata-payeeorigin'] = {"dfnID": "dom-collectedclientadditionalpaymentdata-payeeorigin", "url": "#dom-collectedclientadditionalpaymentdata-payeeorigin", "dfnText": "payeeOrigin", "refSections": [{"refs": [{"id": "ref-for-dom-collectedclientadditionalpaymentdata-payeeorigin"}], "title": "4.1.10. Displaying a transaction confirmation UX"}, {"refs": [{"id": "ref-for-dom-collectedclientadditionalpaymentdata-payeeorigin\u2460"}], "title": "5. WebAuthn Extension - \"payment\""}, {"refs": [{"id": "ref-for-dom-collectedclientadditionalpaymentdata-payeeorigin\u2461"}], "title": "5.2. CollectedClientAdditionalPaymentData Dictionary"}, {"refs": [{"id": "ref-for-dom-collectedclientadditionalpaymentdata-payeeorigin\u2462"}], "title": "8.1. Verifying an Authentication Assertion"}], "external": false};
window.dfnpanelData['dom-collectedclientadditionalpaymentdata-total'] = {"dfnID": "dom-collectedclientadditionalpaymentdata-total", "url": "#dom-collectedclientadditionalpaymentdata-total", "dfnText": "total", "refSections": [{"refs": [{"id": "ref-for-dom-collectedclientadditionalpaymentdata-total"}], "title": "4.1.10. Displaying a transaction confirmation UX"}, {"refs": [{"id": "ref-for-dom-collectedclientadditionalpaymentdata-total\u2460"}], "title": "5. WebAuthn Extension - \"payment\""}, {"refs": [{"id": "ref-for-dom-collectedclientadditionalpaymentdata-total\u2461"}], "title": "5.2. CollectedClientAdditionalPaymentData Dictionary"}, {"refs": [{"id": "ref-for-dom-collectedclientadditionalpaymentdata-total\u2462"}], "title": "8.1. Verifying an Authentication Assertion"}], "external": false};
window.dfnpanelData['dom-collectedclientadditionalpaymentdata-instrument'] = {"dfnID": "dom-collectedclientadditionalpaymentdata-instrument", "url": "#dom-collectedclientadditionalpaymentdata-instrument", "dfnText": "instrument", "refSections": [{"refs": [{"id": "ref-for-dom-collectedclientadditionalpaymentdata-instrument"}], "title": "4.1.9. Steps to check if a payment can be made"}, {"refs": [{"id": "ref-for-dom-collectedclientadditionalpaymentdata-instrument\u2460"}], "title": "4.1.10. Displaying a transaction confirmation UX"}, {"refs": [{"id": "ref-for-dom-collectedclientadditionalpaymentdata-instrument\u2461"}], "title": "5. WebAuthn Extension - \"payment\""}, {"refs": [{"id": "ref-for-dom-collectedclientadditionalpaymentdata-instrument\u2462"}], "title": "5.2. CollectedClientAdditionalPaymentData Dictionary"}, {"refs": [{"id": "ref-for-dom-collectedclientadditionalpaymentdata-instrument\u2463"}], "title": "8.1. Verifying an Authentication Assertion"}], "external": false};
window.dfnpanelData['dictdef-paymentcredentialinstrument'] = {"dfnID": "dictdef-paymentcredentialinstrument", "url": "#dictdef-paymentcredentialinstrument", "dfnText": "PaymentCredentialInstrument", "refSections": [{"refs": [{"id": "ref-for-dictdef-paymentcredentialinstrument"}, {"id": "ref-for-dictdef-paymentcredentialinstrument\u2460"}], "title": "4.1.5. SecurePaymentConfirmationRequest Dictionary"}, {"refs": [{"id": "ref-for-dictdef-paymentcredentialinstrument\u2461"}, {"id": "ref-for-dictdef-paymentcredentialinstrument\u2462"}], "title": "5. WebAuthn Extension - \"payment\""}, {"refs": [{"id": "ref-for-dictdef-paymentcredentialinstrument\u2463"}, {"id": "ref-for-dictdef-paymentcredentialinstrument\u2464"}], "title": "5.2. CollectedClientAdditionalPaymentData Dictionary"}, {"refs": [{"id": "ref-for-dictdef-paymentcredentialinstrument\u2465"}, {"id": "ref-for-dictdef-paymentcredentialinstrument\u2466"}], "title": "6.1. PaymentCredentialInstrument Dictionary"}], "external": false};
window.dfnpanelData['dom-paymentcredentialinstrument-displayname'] = {"dfnID": "dom-paymentcredentialinstrument-displayname", "url": "#dom-paymentcredentialinstrument-displayname", "dfnText": "displayName", "refSections": [{"refs": [{"id": "ref-for-dom-paymentcredentialinstrument-displayname"}], "title": "4.1.8. Steps to validate payment method data"}, {"refs": [{"id": "ref-for-dom-paymentcredentialinstrument-displayname\u2460"}], "title": "4.1.10. Displaying a transaction confirmation UX"}, {"refs": [{"id": "ref-for-dom-paymentcredentialinstrument-displayname\u2461"}, {"id": "ref-for-dom-paymentcredentialinstrument-displayname\u2462"}], "title": "6.1. PaymentCredentialInstrument Dictionary"}, {"refs": [{"id": "ref-for-dom-paymentcredentialinstrument-displayname\u2463"}, {"id": "ref-for-dom-paymentcredentialinstrument-displayname\u2464"}, {"id": "ref-for-dom-paymentcredentialinstrument-displayname\u2465"}], "title": "12. Accessibility Considerations"}, {"refs": [{"id": "ref-for-dom-paymentcredentialinstrument-displayname\u2466"}], "title": "13. Internationalization Considerations"}], "external": false};
window.dfnpanelData['dom-paymentcredentialinstrument-icon'] = {"dfnID": "dom-paymentcredentialinstrument-icon", "url": "#dom-paymentcredentialinstrument-icon", "dfnText": "icon", "refSections": [{"refs": [{"id": "ref-for-dom-paymentcredentialinstrument-icon"}, {"id": "ref-for-dom-paymentcredentialinstrument-icon\u2460"}], "title": "4.1.8. Steps to validate payment method data"}, {"refs": [{"id": "ref-for-dom-paymentcredentialinstrument-icon\u2461"}, {"id": "ref-for-dom-paymentcredentialinstrument-icon\u2462"}], "title": "4.1.9. Steps to check if a payment can be made"}, {"refs": [{"id": "ref-for-dom-paymentcredentialinstrument-icon\u2463"}, {"id": "ref-for-dom-paymentcredentialinstrument-icon\u2464"}], "title": "4.1.10. Displaying a transaction confirmation UX"}, {"refs": [{"id": "ref-for-dom-paymentcredentialinstrument-icon\u2465"}, {"id": "ref-for-dom-paymentcredentialinstrument-icon\u2466"}], "title": "6.1. PaymentCredentialInstrument Dictionary"}, {"refs": [{"id": "ref-for-dom-paymentcredentialinstrument-icon\u2467"}], "title": "12. Accessibility Considerations"}], "external": false};
window.dfnpanelData['dom-paymentcredentialinstrument-iconmustbeshown'] = {"dfnID": "dom-paymentcredentialinstrument-iconmustbeshown", "url": "#dom-paymentcredentialinstrument-iconmustbeshown", "dfnText": "iconMustBeShown", "refSections": [{"refs": [{"id": "ref-for-dom-paymentcredentialinstrument-iconmustbeshown"}], "title": "4.1.9. Steps to check if a payment can be made"}, {"refs": [{"id": "ref-for-dom-paymentcredentialinstrument-iconmustbeshown\u2460"}], "title": "4.1.10. Displaying a transaction confirmation UX"}, {"refs": [{"id": "ref-for-dom-paymentcredentialinstrument-iconmustbeshown\u2461"}], "title": "6.1. PaymentCredentialInstrument Dictionary"}], "external": false};
window.dfnpanelData['set-spc-transaction-mode'] = {"dfnID": "set-spc-transaction-mode", "url": "#set-spc-transaction-mode", "dfnText": "Set SPC Transaction Mode", "refSections": [{"refs": [{"id": "ref-for-set-spc-transaction-mode"}], "title": "9.1. Set SPC Transaction Mode"}], "external": false};
window.dfnpanelData['current-transaction-automation-mode'] = {"dfnID": "current-transaction-automation-mode", "url": "#current-transaction-automation-mode", "dfnText": "current transaction automation mode", "refSections": [{"refs": [{"id": "ref-for-current-transaction-automation-mode"}, {"id": "ref-for-current-transaction-automation-mode\u2460"}], "title": "4.1.10. Displaying a transaction confirmation UX"}, {"refs": [{"id": "ref-for-current-transaction-automation-mode\u2461"}], "title": "9.1. Set SPC Transaction Mode"}], "external": false};
</script>
<script>/* Boilerplate: script-dom-helper */
function query(sel) { return document.querySelector(sel); }

function queryAll(sel) { return [...document.querySelectorAll(sel)]; }

function iter(obj) {
	if(!obj) return [];
	var it = obj[Symbol.iterator];
	if(it) return it;
	return Object.entries(obj);
}

function mk(tagname, attrs, ...children) {
	const el = document.createElement(tagname);
	for(const [k,v] of iter(attrs)) {
		if(k.slice(0,3) == "_on") {
			const eventName = k.slice(3);
			el.addEventListener(eventName, v);
		} else if(k[0] == "_") {
			// property, not attribute
			el[k.slice(1)] = v;
		} else {
			if(v === false || v == null) {
        continue;
      } else if(v === true) {
        el.setAttribute(k, "");
        continue;
      } else {
  			el.setAttribute(k, v);
      }
		}
	}
	append(el, children);
	return el;
}

/* Create shortcuts for every known HTML element */
[
  "a",
  "abbr",
  "acronym",
  "address",
  "applet",
  "area",
  "article",
  "aside",
  "audio",
  "b",
  "base",
  "basefont",
  "bdo",
  "big",
  "blockquote",
  "body",
  "br",
  "button",
  "canvas",
  "caption",
  "center",
  "cite",
  "code",
  "col",
  "colgroup",
  "datalist",
  "dd",
  "del",
  "details",
  "dfn",
  "dialog",
  "div",
  "dl",
  "dt",
  "em",
  "embed",
  "fieldset",
  "figcaption",
  "figure",
  "font",
  "footer",
  "form",
  "frame",
  "frameset",
  "head",
  "header",
  "h1",
  "h2",
  "h3",
  "h4",
  "h5",
  "h6",
  "hr",
  "html",
  "i",
  "iframe",
  "img",
  "input",
  "ins",
  "kbd",
  "label",
  "legend",
  "li",
  "link",
  "main",
  "map",
  "mark",
  "meta",
  "meter",
  "nav",
  "nobr",
  "noscript",
  "object",
  "ol",
  "optgroup",
  "option",
  "output",
  "p",
  "param",
  "pre",
  "progress",
  "q",
  "s",
  "samp",
  "script",
  "section",
  "select",
  "small",
  "source",
  "span",
  "strike",
  "strong",
  "style",
  "sub",
  "summary",
  "sup",
  "table",
  "tbody",
  "td",
  "template",
  "textarea",
  "tfoot",
  "th",
  "thead",
  "time",
  "title",
  "tr",
  "u",
  "ul",
  "var",
  "video",
  "wbr",
  "xmp",
].forEach(tagname=>{
	mk[tagname] = (...args) => mk(tagname, ...args);
});

function* nodesFromChildList(children) {
	for(const child of children.flat(Infinity)) {
		if(child instanceof Node) {
			yield child;
		} else {
			yield new Text(child);
		}
	}
}
function append(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		if(el instanceof Node) el.appendChild(child);
		else el.push(child);
	}
	return el;
}

function insertAfter(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		el.parentNode.insertBefore(child, el.nextSibling);
	}
	return el;
}

function clearContents(el) {
	el.innerHTML = "";
	return el;
}

function parseHTML(markup) {
	if(markup.toLowerCase().trim().indexOf('<!doctype') === 0) {
		const doc = document.implementation.createHTMLDocument("");
		doc.documentElement.innerHTML = markup;
		return doc;
	} else {
		const el = mk.template({});
		el.innerHTML = markup;
		return el.content;
	}
}
</script>
<script>/* Boilerplate: script-wpt */
let wptPath = "/secure-payment-confirmation/";
"use strict";

document.addEventListener("DOMContentLoaded", async ()=>{
    if(wptPath == "/") return;

    const runsUrl = "https://wpt.fyi/api/runs?label=master&label=stable&max-count=1&product=chrome&product=firefox&product=safari&product=edge";
    const runs = await (await fetch(runsUrl)).json();

    const testResults = await (await fetch("https://wpt.fyi/api/search", {
        method:"POST",
        headers:{
            "Content-Type":"application/json",
        },
        body: JSON.stringify({
            "run_ids": runs.map(x=>x.id),
            "query": {"path": wptPath},
        })
    })).json();

    const browsers = runs.map(x=>({name:x.browser_name, version:x.browser_version, passes:0, total: 0}));
    const resultsFromPath = new Map(testResults.results.map(result=>{
        const testPath = result.test;
        const passes = result.legacy_status.map(x=>[x.passes, x.total]);
        return [testPath, passes];
    }));
    const seenTests = new Set();
    document.querySelectorAll(".wpt-name").forEach(nameEl=>{
        const passData = resultsFromPath.get("/" + nameEl.getAttribute("title"));
        if(!passData) {
            console.log("Couldn't find test in results:", nameEl);
            return
        }
        const numTests = passData[0][1];
        if(numTests > 1) {
            nameEl.insertAdjacentElement("beforeend",
                el("small", {}, ` (${numTests} tests)`));
        }
        if(passData == undefined) return;
        const resultsEl = el("span",{"class":"wpt-results"},
            ...passData.map((p,i) => el("span",
            {
                "title": `${browsers[i].name} ${p[0]}/${p[1]}`,
                "class": "wpt-result",
                "style": `background: conic-gradient(forestgreen ${p[0]/p[1]*360}deg, darkred 0deg);`,
            })),
        );
        nameEl.insertAdjacentElement("afterend", resultsEl);

        // Only update the summary pass/total count if we haven't seen this
        // test before, to support authors listing the same test multiple times
        // in a spec.
        if (!seenTests.has(nameEl.getAttribute("title"))) {
            seenTests.add(nameEl.getAttribute("title"));
            passData.forEach((p,i) => {
                browsers[i].passes += p[0];
                browsers[i].total += p[1];
            });
        }
    });
    const overview = document.querySelector(".wpt-overview");
    if(overview) {
        overview.appendChild(el('ul',{}, ...browsers.map(formatWptResult)));
        document.head.appendChild(el('style', {},
            `.wpt-overview ul { display: flex; flex-flow: row wrap; gap: .2em; justify-content: start; list-style: none; padding: 0; margin: 0;}
             .wpt-overview li { padding: .25em 1em; color: black; text-align: center; }
             .wpt-overview img { height: 1.5em; height: max(1.5em, 32px); background: transparent; }
             .wpt-overview .browser { font-weight: bold; }
             .wpt-overview .passes-none { background: #e57373; }
             .wpt-overview .passes-hardly { background: #ffb74d; }
             .wpt-overview .passes-a-few { background: #ffd54f; }
             .wpt-overview .passes-half { background: #fff176; }
             .wpt-overview .passes-lots { background: #dce775; }
             .wpt-overview .passes-most { background: #aed581; }
             .wpt-overview .passes-all { background: #81c784; }`));
    }
});
function el(name, attrs, ...content) {
    const x = document.createElement(name);
    for(const [k,v] of Object.entries(attrs)) {
        x.setAttribute(k, v);
    }
    for(let child of content) {
        if(typeof child == "string") child = document.createTextNode(child);
        try {
        x.appendChild(child);
        } catch(e) { console.log({x, child}); }
    }
    return x;
}
function formatWptResult({name, version, passes, total}) {
    const passRate = passes/total;
    let passClass = "";
    if(passRate == 0)      passClass = "passes-none";
    else if(passRate < .2) passClass = "passes-hardly";
    else if(passRate < .4) passClass = "passes-a-few";
    else if(passRate < .6) passClass = "passes-half";
    else if(passRate < .8) passClass = "passes-lots";
    else if(passRate < 1)  passClass = "passes-most";
    else                   passClass = "passes-all";

    name = name[0].toUpperCase() + name.slice(1);
    const shortVersion = /^\d+/.exec(version);
    const icon = []

    if(name == "Chrome") icon.push(el('img', {alt:"", src:"https://wpt.fyi/static/chrome_64x64.png"}));
    if(name == "Edge") icon.push(el('img', {alt:"", src:"https://wpt.fyi/static/edge_64x64.png"}));
    if(name == "Safari") icon.push(el('img', {alt:"", src:"https://wpt.fyi/static/safari_64x64.png"}));
    if(name == "Firefox") icon.push(el('img', {alt:"", src:"https://wpt.fyi/static/firefox_64x64.png"}));

    return el('li', {"class":passClass},
        el('nobr', {'class':'browser'}, ...icon, ` ${name} ${shortVersion}`),
        el('br', {}),
        el('nobr', {'class':'pass-rate'}, `${passes}/${total}`)
    );
}
</script>